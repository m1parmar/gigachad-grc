import{aS as z,k as K,u as Q,r as c,b as B,c as F,j as e,L as A,aO as H,y as _,B as j,aJ as $,aQ as G,N as W,a4 as J,aa as q,w as O,m as P,aC as Y,aF as Z,a$ as X,h as ee,aD as m}from"./vendor-CWk44mA8.js";import{b as se,B as p,p as v,e as ae}from"./index-CiJwl-Bo.js";import{E as te}from"./EntityAuditHistory-C0v1gX0U.js";import{b as le,c as L}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const g={draft:{label:"Draft",color:"badge-neutral",next:["in_review"]},in_review:{label:"In Review",color:"badge-warning",next:["approved","draft"]},approved:{label:"Approved",color:"badge-success",next:["published","in_review"]},published:{label:"Published",color:"badge-info",next:["retired"]},retired:{label:"Retired",color:"badge-danger",next:[]}},ie=[{value:"information_security",label:"Information Security"},{value:"acceptable_use",label:"Acceptable Use"},{value:"data_privacy",label:"Data Privacy"},{value:"incident_response",label:"Incident Response"},{value:"access_control",label:"Access Control"},{value:"business_continuity",label:"Business Continuity"},{value:"change_management",label:"Change Management"},{value:"risk_management",label:"Risk Management"},{value:"vendor_management",label:"Vendor Management"},{value:"other",label:"Other"}];function je(){const{id:a}=z(),o=K(),{hasPermission:d}=se(),n=Q(),[h,N]=c.useState(!1),[x,y]=c.useState(!1),[w,f]=c.useState(!1),[b,r]=c.useState(!1),[l,u]=c.useState({isOpen:!1,targetStatus:null}),[D,C]=c.useState(""),[i,E]=c.useState("status"),{data:t,isLoading:U}=B({queryKey:["policy",a],queryFn:()=>v.get(a).then(s=>s.data),enabled:!!a}),M=F({mutationFn:({status:s,notes:S})=>v.updateStatus(a,s,S),onSuccess:()=>{n.invalidateQueries({queryKey:["policy",a]}),n.invalidateQueries({queryKey:["policies"]}),m.success("Status updated"),u({isOpen:!1,targetStatus:null}),C("")},onError:()=>{m.error("Failed to update status")}}),I=F({mutationFn:()=>v.delete(a),onSuccess:()=>{m.success("Policy deleted"),o("/policies")},onError:()=>{m.error("Failed to delete policy")}}),V=F({mutationFn:s=>v.unlinkFromControl(a,s),onSuccess:()=>{n.invalidateQueries({queryKey:["policy",a]}),m.success("Control unlinked")},onError:()=>{m.error("Failed to unlink control")}}),T=async()=>{try{const{data:s}=await v.getDownloadUrl(a);window.open(s.url,"_blank")}catch{m.error("Failed to get download URL")}};if(U)return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx(le,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(L,{title:!0}),e.jsx(L,{title:!0})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{title:!0}),e.jsx(L,{title:!0})]})]})]});if(!t)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-surface-400",children:"Policy not found"})});const k=g[t.status]||g.draft,R=d("policies:write");return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs(A,{to:"/policies",className:"inline-flex items-center text-sm text-surface-400 hover:text-surface-100 mb-4",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Back to Policies"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-surface-800 rounded-xl",children:e.jsx(_,{className:"w-8 h-8 text-brand-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:t.title}),e.jsx("p",{className:"text-surface-400 mt-1",children:t.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx("span",{className:j("badge",k.color),children:k.label}),e.jsx("span",{className:"text-surface-500",children:"•"}),e.jsxs("span",{className:"font-mono text-surface-400",children:["v",t.version]}),e.jsx("span",{className:"text-surface-500",children:"•"}),e.jsx("span",{className:"text-surface-400 capitalize",children:t.category?.replace(/_/g," ")})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",onClick:T,leftIcon:e.jsx($,{className:"w-4 h-4"}),children:"Download"}),R&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"outline",onClick:()=>f(!0),leftIcon:e.jsx(G,{className:"w-4 h-4"}),children:"Edit"}),e.jsx(p,{variant:"outline",onClick:()=>N(!0),leftIcon:e.jsx(W,{className:"w-4 h-4"}),children:"New Version"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Preview"}),e.jsx("div",{className:"border border-surface-800 rounded-lg overflow-hidden bg-surface-950",children:t.mimeType==="application/pdf"?e.jsx("iframe",{src:v.getPreviewUrl(a),className:"w-full h-[800px]",title:t.title}):t.mimeType?.startsWith("image/")?e.jsx("img",{src:v.getPreviewUrl(a),alt:t.title,className:"max-w-full h-auto mx-auto"}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-surface-500",children:[e.jsx(_,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Preview not available for this file type"}),e.jsxs("button",{onClick:T,className:"btn-outline mt-4",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Download to View"]})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Version History"}),(t?.versions?.length??0)>0?e.jsx("div",{className:"space-y-3",children:t?.versions?.map((s,S)=>e.jsx("div",{className:j("flex items-center justify-between p-3 rounded-lg",S===0?"bg-brand-500/10 border border-brand-500/30":"bg-surface-800"),children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-mono text-surface-200",children:["v",s.version]}),S===0&&e.jsx("span",{className:"badge badge-info text-xs",children:"Current"})]}),s.changeNotes&&e.jsx("p",{className:"text-sm text-surface-400 mt-1",children:s.changeNotes}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:new Date(s.createdAt).toLocaleString()})]})},s.id))}):e.jsx("p",{className:"text-surface-500",children:"No version history"})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"border-b border-surface-700 px-4",children:e.jsxs("nav",{className:"flex gap-6","aria-label":"History Tabs",children:[e.jsxs("button",{onClick:()=>E("status"),className:j("py-3 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",i==="status"?"border-brand-500 text-brand-400":"border-transparent text-surface-400 hover:text-surface-200 hover:border-surface-600"),children:[e.jsx(J,{className:"w-4 h-4"}),"Status History"]}),e.jsxs("button",{onClick:()=>E("history"),className:j("py-3 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",i==="history"?"border-brand-500 text-brand-400":"border-transparent text-surface-400 hover:text-surface-200 hover:border-surface-600"),children:[e.jsx(q,{className:"w-4 h-4"}),"Change History"]})]})}),e.jsxs("div",{className:"p-6",children:[i==="status"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-surface-500 mb-4",children:"Audit trail showing who moved this policy through workflow stages"}),(t?.statusHistory?.length??0)>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-2 bottom-2 w-0.5 bg-surface-700"}),e.jsx("div",{className:"space-y-4",children:t?.statusHistory?.map((s,S)=>e.jsxs("div",{className:"relative flex gap-4 pl-10",children:[e.jsx("div",{className:j("absolute left-2.5 w-3 h-3 rounded-full border-2 border-surface-900",S===0?"bg-brand-500":"bg-surface-600")}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.fromStatus?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:j("badge text-xs",g[s.fromStatus]?.color||"badge-neutral"),children:g[s.fromStatus]?.label||s.fromStatus}),e.jsx("span",{className:"text-surface-500",children:"→"})]}):null,e.jsx("span",{className:j("badge text-xs",g[s.toStatus]?.color||"badge-neutral"),children:g[s.toStatus]?.label||s.toStatus})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-surface-200 font-medium",children:s.changedByName||s.changedBy?.displayName||"Unknown"}),e.jsx("span",{className:"text-surface-500 ml-2",children:new Date(s.createdAt).toLocaleString()})]}),s.notes&&e.jsxs("p",{className:"mt-1 text-sm text-surface-400 italic",children:['"',s.notes,'"']})]})]},s.id))})]}):e.jsx("p",{className:"text-surface-500",children:"No status history available"})]}),i==="history"&&e.jsx(te,{entityType:"policy",entityId:a})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Linked Controls"}),R&&e.jsxs("button",{onClick:()=>r(!0),className:"btn-outline text-sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Link to Control"]})]}),e.jsx("p",{className:"text-xs text-surface-500 mb-3",children:"This policy serves as evidence for the following controls:"}),(t?.controlLinks?.length??0)>0?e.jsx("div",{className:"space-y-2",children:t?.controlLinks?.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-800 rounded-lg group",children:[e.jsxs(A,{to:`/controls/${s.control?.id}`,className:"flex items-center gap-3 flex-1 hover:text-brand-400",children:[e.jsx(O,{className:"w-4 h-4 text-brand-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm text-brand-400",children:s.control?.controlId}),e.jsx("p",{className:"text-sm text-surface-200",children:s.control?.title})]})]}),R&&e.jsx("button",{onClick:()=>V.mutate(s.control?.id),className:"p-1 text-surface-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Unlink",children:e.jsx(P,{className:"w-4 h-4"})})]},s.id))}):e.jsx("p",{className:"text-surface-500",children:"No controls linked to this policy"})]})]}),e.jsxs("div",{className:"space-y-6",children:[R&&k.next&&k.next.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-100 mb-4",children:"Workflow Actions"}),e.jsx("div",{className:"space-y-2",children:k.next.map(s=>{const S=g[s];return e.jsxs("button",{onClick:()=>u({isOpen:!0,targetStatus:s}),disabled:M.isPending,className:"btn-outline w-full justify-center",children:["Move to ",S.label]},s)})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-100 mb-4",children:"Details"}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-surface-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-surface-500",children:"Owner"}),e.jsx("dd",{className:"text-sm text-surface-200",children:t.owner?.displayName||"Unassigned"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-surface-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-surface-500",children:"Effective Date"}),e.jsx("dd",{className:"text-sm text-surface-200",children:t.effectiveDate?new Date(t.effectiveDate).toLocaleDateString():"Not set"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{className:"w-5 h-5 text-surface-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-surface-500",children:"Next Review Due"}),e.jsx("dd",{className:j("text-sm",t.nextReviewDue&&new Date(t.nextReviewDue)<new Date?"text-red-400":"text-surface-200"),children:t.nextReviewDue?new Date(t.nextReviewDue).toLocaleDateString():"Not set"})]})]}),(t?.tags?.length??0)>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-surface-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-surface-500",children:"Tags"}),e.jsx("dd",{className:"flex flex-wrap gap-1 mt-1",children:t?.tags?.map(s=>e.jsx("span",{className:"badge badge-neutral text-xs",children:s},s))})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-100 mb-4",children:"File Information"}),e.jsxs("dl",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-surface-500",children:"Filename"}),e.jsx("dd",{className:"text-surface-200 truncate ml-2",children:t.filename})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-surface-500",children:"Type"}),e.jsx("dd",{className:"text-surface-200",children:t.mimeType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-surface-500",children:"Size"}),e.jsx("dd",{className:"text-surface-200",children:oe(t.size)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-surface-500",children:"Uploaded"}),e.jsx("dd",{className:"text-surface-200",children:new Date(t.createdAt).toLocaleDateString()})]})]})]}),R&&e.jsxs("div",{className:"card p-6 border-red-500/30",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-400 mb-4",children:"Danger Zone"}),e.jsxs("button",{onClick:()=>{confirm("Are you sure you want to delete this policy?")&&I.mutate()},disabled:I.isPending,className:"btn-outline w-full text-red-400 border-red-400/50 hover:bg-red-400/10",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Delete Policy"]})]})]})]}),h&&e.jsx(re,{policyId:a,currentVersion:t.version,onClose:()=>N(!1),onSuccess:()=>{n.invalidateQueries({queryKey:["policy",a]}),N(!1)}}),w&&e.jsx(ce,{policy:t,onClose:()=>f(!1),onSuccess:()=>{n.invalidateQueries({queryKey:["policy",a]}),n.invalidateQueries({queryKey:["policies"]}),f(!1)}}),b&&e.jsx(ne,{policyId:a,existingControlIds:t.controlLinks?.map(s=>s.control?.id)||[],onClose:()=>r(!1),onSuccess:()=>{n.invalidateQueries({queryKey:["policy",a]}),r(!1)}}),l.isOpen&&l.targetStatus&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{u({isOpen:!1,targetStatus:null}),C("")}}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-800 rounded-xl w-full max-w-md mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Change Status"}),e.jsx("button",{onClick:()=>{u({isOpen:!1,targetStatus:null}),C("")},className:"text-surface-400 hover:text-surface-100",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-surface-300",children:["Move this policy from"," ",e.jsx("span",{className:j("badge",k.color),children:k.label})," ","to"," ",e.jsx("span",{className:j("badge",g[l.targetStatus]?.color),children:g[l.targetStatus]?.label})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"label",children:"Notes (optional)"}),e.jsx("textarea",{value:D,onChange:s=>C(s.target.value),className:"input mt-1",rows:3,placeholder:"Add notes about this status change..."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(p,{variant:"secondary",onClick:()=>{u({isOpen:!1,targetStatus:null}),C("")},children:"Cancel"}),e.jsx(p,{onClick:()=>M.mutate({status:l.targetStatus,notes:D||void 0}),isLoading:M.isPending,children:"Confirm"})]})]})]})]})}function re({policyId:a,currentVersion:o,onClose:d,onSuccess:n}){const[h,N]=c.useState(null),[x,y]=c.useState(()=>{const r=o.split("."),l=parseInt(r[1]||"0")+1;return`${r[0]}.${l}`}),[w,f]=c.useState(""),b=F({mutationFn:()=>{if(!h)throw new Error("No file selected");return v.uploadNewVersion(a,h,x,w)},onSuccess:()=>{m.success("New version uploaded!"),n()},onError:r=>{m.error(r.message||"Failed to upload new version")}});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:d}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-800 rounded-xl w-full max-w-md mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Upload New Version"}),e.jsx("button",{onClick:d,className:"text-surface-400 hover:text-surface-100",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"File *"}),e.jsx("input",{type:"file",onChange:r=>N(r.target.files?.[0]||null),className:"input mt-1",accept:".pdf,.doc,.docx,.txt"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Version Number *"}),e.jsx("input",{type:"text",value:x,onChange:r=>y(r.target.value),className:"input mt-1",placeholder:"e.g., 2.0"}),e.jsxs("p",{className:"text-xs text-surface-500 mt-1",children:["Current: v",o]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Change Notes"}),e.jsx("textarea",{value:w,onChange:r=>f(r.target.value),className:"input mt-1",rows:3,placeholder:"What changed in this version?"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(p,{variant:"secondary",onClick:d,children:"Cancel"}),e.jsx(p,{onClick:()=>b.mutate(),disabled:!h||!x,isLoading:b.isPending,children:"Upload Version"})]})]})]})}function ne({policyId:a,existingControlIds:o,onClose:d,onSuccess:n}){const[h,N]=c.useState(""),[x,y]=c.useState([]),{data:w}=B({queryKey:["controls-for-linking",h],queryFn:()=>ae.list({search:h||void 0,limit:50}).then(l=>l.data)}),f=F({mutationFn:()=>v.linkToControls(a,x),onSuccess:()=>{m.success("Policy linked to controls!"),n()},onError:l=>{m.error(l.message||"Failed to link controls")}}),b=(w?.data||[]).filter(l=>!o.includes(l.id)),r=l=>{y(u=>u.includes(l)?u.filter(D=>D!==l):[...u,l])};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:d}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-800 rounded-xl w-full max-w-lg mx-4 p-6 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Link Policy to Controls"}),e.jsx("button",{onClick:d,className:"text-surface-400 hover:text-surface-100",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm text-surface-400 mb-4",children:"Select controls to link this policy as evidence:"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search controls...",value:h,onChange:l=>N(l.target.value),className:"input pl-10"}),e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 min-h-[200px] max-h-[300px]",children:b.length===0?e.jsx("p",{className:"text-surface-500 text-center py-8",children:h?"No controls found":"All controls are already linked"}):b.map(l=>e.jsxs("label",{className:j("flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors",x.includes(l.id)?"bg-brand-500/20 border border-brand-500/50":"bg-surface-800 hover:bg-surface-700"),children:[e.jsx("input",{type:"checkbox",checked:x.includes(l.id),onChange:()=>r(l.id),className:"rounded border-surface-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm text-brand-400",children:l.controlId}),e.jsx("p",{className:"text-sm text-surface-200",children:l.title})]})]},l.id))}),x.length>0&&e.jsxs("p",{className:"text-sm text-surface-400 mt-3",children:[x.length," control(s) selected"]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4 pt-4 border-t border-surface-800",children:[e.jsx(p,{variant:"secondary",onClick:d,children:"Cancel"}),e.jsx(p,{onClick:()=>f.mutate(),disabled:x.length===0,isLoading:f.isPending,children:"Link to Controls"})]})]})]})}function ce({policy:a,onClose:o,onSuccess:d}){const[n,h]=c.useState(a.title),[N,x]=c.useState(a.description||""),[y,w]=c.useState(a.category),[f,b]=c.useState(a.effectiveDate?new Date(a.effectiveDate).toISOString().split("T")[0]:""),[r,l]=c.useState(a.nextReviewDue?new Date(a.nextReviewDue).toISOString().split("T")[0]:""),[u,D]=c.useState((a.tags||[]).join(", ")),C=F({mutationFn:()=>v.update(a.id,{title:n,description:N||void 0,type:y,effectiveDate:f||void 0,reviewDate:r||void 0,tags:u?u.split(",").map(i=>i.trim()).filter(Boolean):[]}),onSuccess:()=>{m.success("Policy updated!"),d()},onError:i=>{m.error(i.message||"Failed to update policy")}});return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:o}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-800 rounded-xl w-full max-w-lg mx-4 p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Edit Policy"}),e.jsx("button",{onClick:o,className:"text-surface-400 hover:text-surface-100",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Title *"}),e.jsx("input",{type:"text",value:n,onChange:i=>h(i.target.value),className:"input mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:N,onChange:i=>x(i.target.value),className:"input mt-1",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category *"}),e.jsx("select",{value:y,onChange:i=>w(i.target.value),className:"input mt-1",children:ie.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Effective Date"}),e.jsx("input",{type:"date",value:f,onChange:i=>b(i.target.value),className:"input mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Next Review Due"}),e.jsx("input",{type:"date",value:r,onChange:i=>l(i.target.value),className:"input mt-1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:u,onChange:i=>D(i.target.value),className:"input mt-1",placeholder:"e.g., security, compliance, annual"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(p,{variant:"secondary",onClick:o,children:"Cancel"}),e.jsx(p,{onClick:()=>C.mutate(),disabled:!n||!y,isLoading:C.isPending,children:"Save Changes"})]})]})]})}function oe(a){if(a===0)return"0 Bytes";const o=1024,d=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(a)/Math.log(o));return parseFloat((a/Math.pow(o,n)).toFixed(2))+" "+d[n]}export{je as default};
