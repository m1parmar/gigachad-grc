import{aS as D,k as P,u as q,r as o,b as F,c as y,j as e,aO as A,aQ as T,h as I,m as K,aD as c}from"./vendor-CWk44mA8.js";import{B as i,G as m}from"./index-CiJwl-Bo.js";import{b as Q,c as R}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const z=["security","privacy","compliance","technical","operational"],B=["draft","pending","approved","archived"];function H(){const{id:n}=D(),u=P(),x=q(),[d,g]=o.useState(n==="new"),[k,w]=o.useState(!1),[r,l]=o.useState({title:"",category:"security",question:"",answer:"",tags:[],framework:"",status:"draft",isPublic:!1}),[f,v]=o.useState(""),{data:a,isLoading:C}=F({queryKey:["knowledge-base",n],queryFn:async()=>(await m.get(n)).data,enabled:n!=="new"});o.useEffect(()=>{a&&!d&&l(a)},[a,d]);const p=y({mutationFn:async s=>{const t=localStorage.getItem("organizationId")||"8924f0c1-7bb1-4be8-84ee-ad8725c712bf",j={...s,organizationId:t};return(await m.create(j)).data},onSuccess:s=>{x.invalidateQueries({queryKey:["knowledge-base"]}),c.success("Entry created successfully"),u(`/knowledge-base/${s.id}`)},onError:()=>{c.error("Failed to create entry")}}),b=y({mutationFn:async s=>(await m.update(n,s)).data,onSuccess:()=>{x.invalidateQueries({queryKey:["knowledge-base"]}),x.invalidateQueries({queryKey:["knowledge-base",n]}),c.success("Entry updated successfully"),g(!1)},onError:()=>{c.error("Failed to update entry")}}),h=y({mutationFn:async()=>{await m.delete(n)},onSuccess:()=>{x.invalidateQueries({queryKey:["knowledge-base"]}),c.success("Entry deleted successfully"),u("/knowledge-base")},onError:()=>{c.error("Failed to delete entry")}}),E=async()=>{if(!r.title||!r.answer||!r.category){c.error("Please fill in all required fields");return}n==="new"?p.mutate(r):b.mutate(r)},N=()=>{f.trim()&&!r.tags?.includes(f.trim())&&(l(s=>({...s,tags:[...s.tags||[],f.trim()]})),v(""))},S=s=>{l(t=>({...t,tags:t.tags?.filter(j=>j!==s)||[]}))};return C&&n!=="new"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{}),e.jsx(R,{title:!0})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>u("/knowledge-base"),className:"p-2 text-surface-400 hover:text-surface-100 hover:bg-surface-800 rounded-lg transition-colors",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-3xl font-bold text-surface-100",children:n==="new"?"New Knowledge Base Entry":d?"Edit Entry":a?.title||"Entry"})]}),!d&&n!=="new"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>g(!0),leftIcon:e.jsx(T,{className:"w-5 h-5"}),children:"Edit"}),e.jsx(i,{variant:"danger",onClick:()=>w(!0),leftIcon:e.jsx(I,{className:"w-5 h-5"}),children:"Delete"})]})]}),d?e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Title ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:r.title,onChange:s=>l(t=>({...t,title:s.target.value})),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"e.g., Data Encryption at Rest"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Category ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("select",{value:r.category,onChange:s=>l(t=>({...t,category:s.target.value})),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",children:z.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Framework"}),e.jsx("input",{type:"text",value:r.framework||"",onChange:s=>l(t=>({...t,framework:s.target.value})),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"e.g., SOC2, ISO 27001"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Question"}),e.jsx("input",{type:"text",value:r.question||"",onChange:s=>l(t=>({...t,question:s.target.value})),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"e.g., Does your platform encrypt data at rest?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Answer ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:r.answer,onChange:s=>l(t=>({...t,answer:s.target.value})),rows:6,className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"Provide a detailed answer..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:f,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),N())},className:"flex-1 px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"Add a tag and press Enter"}),e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 transition-colors",children:"Add"})]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map((s,t)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded",children:[s,e.jsx("button",{type:"button",onClick:()=>S(s),className:"hover:text-red-400 transition-colors",children:e.jsx(K,{className:"w-3 h-3"})})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Status"}),e.jsx("select",{value:r.status,onChange:s=>l(t=>({...t,status:s.target.value})),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",children:B.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.isPublic,onChange:s=>l(t=>({...t,isPublic:s.target.checked})),className:"w-4 h-4 rounded border-surface-700 bg-surface-800 text-brand-600 focus:ring-brand-500"}),e.jsx("span",{className:"text-sm text-surface-300",children:"Make publicly visible"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-surface-800",children:[e.jsx(i,{variant:"secondary",onClick:()=>{n==="new"?u("/knowledge-base"):(g(!1),l(a||{}))},disabled:p.isPending||b.isPending,children:"Cancel"}),e.jsx(i,{onClick:E,isLoading:p.isPending||b.isPending,children:"Save"})]})]}):a?e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded capitalize",children:a.category}),a.framework&&e.jsx("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded",children:typeof a.framework=="string"?a.framework:a.framework.name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded capitalize ${a.status==="approved"?"bg-green-500/20 text-green-400":a.status==="pending"?"bg-yellow-500/20 text-yellow-400":a.status==="archived"?"bg-surface-500/20 text-surface-400":"bg-blue-500/20 text-blue-400"}`,children:a.status}),a.isPublic&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-500/20 text-blue-400 rounded",children:"Public"}),a.usageCount!==void 0&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-400 rounded",children:["Used ",a.usageCount," times"]})]}),a.question&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Question"}),e.jsx("p",{className:"text-surface-100",children:a.question})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Answer"}),e.jsx("div",{className:"text-surface-100 whitespace-pre-wrap",children:a.answer})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map((s,t)=>e.jsx("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded",children:s},t))})]})]}):null,k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-2",children:"Delete Knowledge Base Entry"}),e.jsxs("p",{className:"text-surface-400 mb-6",children:['Are you sure you want to delete "',a?.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"secondary",onClick:()=>w(!1),disabled:h.isPending,children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:()=>h.mutate(),isLoading:h.isPending,children:"Delete"})]})]})})]})}export{H as default};
