import{aK as g,u as k,r as F,b as R,c as p,j as e,M as S,aM as h,S as o,aa as C,y as f,B as x,aY as T}from"./vendor-CWk44mA8.js";import{B as r}from"./index-CiJwl-Bo.js";import{u as $}from"./useToast-oJzujiun.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const u={draft:{icon:f,color:"text-surface-400",label:"Draft"},pending_review:{icon:C,color:"text-yellow-400",label:"Pending Review"},reviewed:{icon:o,color:"text-blue-400",label:"Reviewed"},approved:{icon:o,color:"text-green-400",label:"Approved"},rejected:{icon:h,color:"text-red-400",label:"Rejected"}};function z(){const[j]=g(),c=j.get("auditId")||"",n=k(),l=$(),[A,P]=F.useState(null),{data:d=[],isLoading:w}=R({queryKey:["workpapers",c],queryFn:async()=>{const s=new URLSearchParams;c&&s.set("auditId",c);const t=await fetch(`/api/audit/workpapers?${s}`);if(!t.ok)throw new Error("Failed to fetch workpapers");return t.json()}}),N=p({mutationFn:async s=>{const t=await fetch(`/api/audit/workpapers/${s}/submit`,{method:"POST"});if(!t.ok)throw new Error("Failed to submit workpaper");return t.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["workpapers"]}),l.success("Workpaper submitted for review")}}),y=p({mutationFn:async({id:s,approved:t,notes:a})=>{const i=await fetch(`/api/audit/workpapers/${s}/review`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({approved:t,notes:a})});if(!i.ok)throw new Error("Failed to review workpaper");return i.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["workpapers"]}),l.success("Review completed")}}),v=p({mutationFn:async({id:s,notes:t})=>{const a=await fetch(`/api/audit/workpapers/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:t})});if(!a.ok)throw new Error("Failed to approve workpaper");return a.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["workpapers"]}),l.success("Workpaper approved")}}),m=(s,t)=>{const a=prompt(t?"Review notes (optional):":"Rejection reason:");a!==null&&y.mutate({id:s,approved:t,notes:a})},b=s=>{const t=prompt("Approval notes (optional):");t!==null&&v.mutate({id:s,notes:t})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Audit Workpapers"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Formal documentation with version control and review workflow"})]}),e.jsxs(r,{children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"New Workpaper"]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-4",children:Object.entries(u).map(([s,t])=>{const a=d.filter(i=>i.status===s).length;return e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:x("h-5 w-5",t.color)}),e.jsx("span",{className:"text-surface-400 text-sm",children:t.label})]}),e.jsx("p",{className:"text-2xl font-bold text-white mt-2",children:a})]},s)})}),w?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"bg-surface-800 rounded-lg h-20"},s))}):e.jsxs("div",{className:"bg-surface-800 rounded-lg border border-surface-700 overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Number"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Title"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Type"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Prepared By"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Version"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-medium text-surface-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-700",children:d.map(s=>{const t=u[s.status];return e.jsxs("tr",{className:"hover:bg-surface-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm text-brand-400",children:s.workpaperNumber})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-white",children:s.title})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-surface-400 capitalize",children:s.workpaperType})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:x("flex items-center gap-2",t.color),children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label]})}),e.jsx("td",{className:"px-4 py-3 text-surface-400",children:s.preparedByUser?.displayName||"Unknown"}),e.jsxs("td",{className:"px-4 py-3 text-surface-400",children:["v",s.version]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.status==="draft"&&e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>N.mutate(s.id),children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Submit"]}),s.status==="pending_review"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>m(s.id,!0),children:[e.jsx(o,{className:"h-4 w-4 mr-1 text-green-400"}),"Approve"]}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>m(s.id,!1),children:[e.jsx(h,{className:"h-4 w-4 mr-1 text-red-400"}),"Reject"]})]}),s.status==="reviewed"&&e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>b(s.id),children:[e.jsx(o,{className:"h-4 w-4 mr-1 text-green-400"}),"Final Approve"]})]})})]},s.id)})})]}),d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-surface-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"No workpapers yet"}),e.jsx("p",{className:"text-surface-400 mt-2",children:"Create your first workpaper to document audit procedures."})]})]})]})}export{z as default};
