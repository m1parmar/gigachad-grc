import{r as f,j as e,ba as de,bb as ue,bc as U,bd as k,b6 as C,be as I,bf as E,bg as K,bh as R,bi as Q,b5 as L,bj as W,b3 as xe,bk as me,bl as H,bm as G,bn as ee,c as N,b7 as y,b as _,aS as be,k as he,u as pe,bo as fe,bp as B,bq as ge,br as ve,bs as D,b4 as X,bt as je,b2 as T,aD as j}from"./vendor-CWk44mA8.js";import{x as v,e as Ne,y as ye}from"./index-CiJwl-Bo.js";import{E as we}from"./EntityAuditHistory-C0v1gX0U.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";function ke({risk:a,onUpdate:l}){const[o,u]=f.useState(!0),[s,t]=f.useState(null),i=a.status==="not_a_risk"?"closed":["risk_identified","actual_risk"].includes(a.status)?"intake":a.status==="risk_analysis_in_progress"||a.assessment&&a.assessment.status!=="done"?"assessment":a.treatment?"treatment":"intake",r=p=>({risk_identified:{label:"Risk Identified",color:"text-purple-400 bg-purple-500/20",icon:xe},not_a_risk:{label:"Not a Risk",color:"text-surface-400 bg-surface-500/20",icon:W},actual_risk:{label:"Validated Risk",color:"text-blue-400 bg-blue-500/20",icon:k},risk_analysis_in_progress:{label:"Analysis In Progress",color:"text-cyan-400 bg-cyan-500/20",icon:L},risk_analyzed:{label:"Risk Analyzed",color:"text-indigo-400 bg-indigo-500/20",icon:Q},risk_assessor_analysis:{label:"Awaiting Assessment",color:"text-amber-400 bg-amber-500/20",icon:R},grc_approval:{label:"GRC Approval",color:"text-orange-400 bg-orange-500/20",icon:K},grc_revision:{label:"GRC Revision",color:"text-yellow-400 bg-yellow-500/20",icon:Q},done:{label:"Assessment Complete",color:"text-emerald-400 bg-emerald-500/20",icon:k},treatment_decision_review:{label:"Treatment Decision",color:"text-amber-400 bg-amber-500/20",icon:C},identify_executive_approver:{label:"Assign Approver",color:"text-orange-400 bg-orange-500/20",icon:R},executive_approval:{label:"Executive Approval",color:"text-purple-400 bg-purple-500/20",icon:K},risk_mitigation_in_progress:{label:"Mitigation In Progress",color:"text-blue-400 bg-blue-500/20",icon:E},risk_mitigation_complete:{label:"Mitigation Complete",color:"text-emerald-400 bg-emerald-500/20",icon:k},risk_accept:{label:"Risk Accepted",color:"text-blue-400 bg-blue-500/20",icon:I},risk_transfer:{label:"Risk Transferred",color:"text-cyan-400 bg-cyan-500/20",icon:U},risk_avoid:{label:"Risk Avoided",color:"text-emerald-400 bg-emerald-500/20",icon:C},risk_auto_accept:{label:"Auto Accepted",color:"text-surface-400 bg-surface-500/20",icon:k}})[p]||{label:p.replace(/_/g," "),color:"text-surface-400 bg-surface-500/20",icon:L},m=a.treatment?.status||a.assessment?.status||a.status,x=r(m),b=(()=>{const p=[];switch(a.status){case"risk_identified":p.push({key:"validate",label:"Validate Risk",icon:k,color:"bg-brand-500 hover:bg-brand-600",description:"GRC SME validates this is a real risk"}),p.push({key:"reject",label:"Not a Risk",icon:W,color:"bg-surface-600 hover:bg-surface-500",description:"Mark as not a valid risk"});break;case"actual_risk":p.push({key:"start_assessment",label:"Start Assessment",icon:me,color:"bg-brand-500 hover:bg-brand-600",description:"Assign a Risk Assessor and begin analysis"});break}if(a.assessment)switch(a.assessment.status){case"risk_assessor_analysis":p.push({key:"submit_assessment",label:"Submit Assessment",icon:H,color:"bg-brand-500 hover:bg-brand-600",description:"Complete and submit the risk assessment form"});break;case"grc_approval":p.push({key:"approve_assessment",label:"Approve Assessment",icon:I,color:"bg-emerald-500 hover:bg-emerald-600",description:"Approve the assessment and proceed to treatment"}),p.push({key:"request_revision",label:"Request Revision",icon:G,color:"bg-amber-500 hover:bg-amber-600",description:"Send back to assessor for changes"});break;case"grc_revision":p.push({key:"complete_revision",label:"Complete Revision",icon:H,color:"bg-brand-500 hover:bg-brand-600",description:"Submit revised assessment"});break}if(a.treatment)switch(a.treatment.status){case"treatment_decision_review":p.push({key:"submit_treatment",label:"Submit Treatment Decision",icon:C,color:"bg-brand-500 hover:bg-brand-600",description:"Choose how to treat this risk"});break;case"identify_executive_approver":p.push({key:"assign_approver",label:"Assign Executive Approver",icon:R,color:"bg-brand-500 hover:bg-brand-600",description:"Identify the executive who will approve this decision"});break;case"executive_approval":p.push({key:"executive_approve",label:"Approve",icon:I,color:"bg-emerald-500 hover:bg-emerald-600",description:"Approve the treatment decision"}),p.push({key:"executive_deny",label:"Deny",icon:G,color:"bg-red-500 hover:bg-red-600",description:"Deny and return to Risk Owner"});break;case"risk_mitigation_in_progress":p.push({key:"update_mitigation",label:"Update Progress",icon:E,color:"bg-brand-500 hover:bg-brand-600",description:"Update mitigation status and progress"});break}return p})();return e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>u(!o),className:"w-full p-4 flex items-center justify-between hover:bg-surface-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${x.color}`,children:e.jsx(x.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-white font-medium",children:"Workflow Status"}),e.jsx("p",{className:"text-sm text-surface-400",children:x.label})]})]}),o?e.jsx(de,{className:"w-5 h-5 text-surface-400"}):e.jsx(ue,{className:"w-5 h-5 text-surface-400"})]}),o&&e.jsxs("div",{className:"border-t border-surface-700",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-400 mb-3",children:"Workflow Progress"}),e.jsx(Ce,{stage:i,intakeStatus:a.status,assessmentStatus:a.assessment?.status,treatmentStatus:a.treatment?.status})]}),b.length>0&&e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-400 mb-3",children:"Available Actions"}),e.jsx("div",{className:"space-y-2",children:b.map(p=>e.jsxs("button",{onClick:()=>t(p.key),className:`w-full p-3 rounded-lg text-white flex items-center gap-3 transition-colors ${p.color}`,children:[e.jsx(p.icon,{className:"w-5 h-5"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-medium",children:p.label}),e.jsx("p",{className:"text-sm opacity-80",children:p.description})]}),e.jsx(U,{className:"w-4 h-4"})]},p.key))})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-400 mb-3",children:"Assigned Roles"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(S,{label:"Reporter",userId:a.reporterId,onEdit:()=>t("assign_reporter"),editable:!0}),e.jsx(S,{label:"GRC SME",userId:a.grcSmeId,onEdit:()=>t("assign_grc_sme"),editable:!0}),e.jsx(S,{label:"Risk Assessor",userId:a.riskAssessorId||a.assessment?.riskAssessorId,onEdit:()=>t("assign_assessor"),editable:a.status==="actual_risk"||a.status==="risk_identified"}),e.jsx(S,{label:"Risk Owner",userId:a.riskOwnerId||a.treatment?.riskOwnerId,onEdit:()=>t("assign_owner"),editable:!!a.assessment}),a.treatment&&e.jsx(S,{label:"Executive Approver",userId:a.treatment.executiveApproverId,onEdit:()=>t("assign_approver"),editable:a.treatment?.status==="identify_executive_approver"})]})]})]}),s==="validate"&&e.jsx(J,{riskId:a.id,onClose:()=>t(null),onSuccess:l,approve:!0}),s==="reject"&&e.jsx(J,{riskId:a.id,onClose:()=>t(null),onSuccess:l,approve:!1}),s==="start_assessment"&&e.jsx(Se,{riskId:a.id,onClose:()=>t(null),onSuccess:l}),s==="submit_assessment"&&e.jsx(Ae,{riskId:a.id,assessment:a.assessment,onClose:()=>t(null),onSuccess:l}),s==="approve_assessment"&&e.jsx(Y,{riskId:a.id,approve:!0,onClose:()=>t(null),onSuccess:l}),s==="request_revision"&&e.jsx(Y,{riskId:a.id,approve:!1,onClose:()=>t(null),onSuccess:l}),s==="complete_revision"&&e.jsx(Re,{riskId:a.id,assessment:a.assessment,onClose:()=>t(null),onSuccess:l}),s==="submit_treatment"&&e.jsx(_e,{riskId:a.id,inherentRisk:a.inherentRisk,onClose:()=>t(null),onSuccess:l}),s==="assign_approver"&&e.jsx(Ie,{riskId:a.id,onClose:()=>t(null),onSuccess:l}),s==="executive_approve"&&e.jsx(Z,{riskId:a.id,approve:!0,onClose:()=>t(null),onSuccess:l}),s==="executive_deny"&&e.jsx(Z,{riskId:a.id,approve:!1,onClose:()=>t(null),onSuccess:l}),s==="update_mitigation"&&e.jsx(De,{riskId:a.id,treatment:a.treatment,onClose:()=>t(null),onSuccess:l}),s==="assign_reporter"&&e.jsx(A,{riskId:a.id,roleType:"reporter",roleLabel:"Reporter",currentUserId:a.reporterId,onClose:()=>t(null),onSuccess:l}),s==="assign_grc_sme"&&e.jsx(A,{riskId:a.id,roleType:"grcSme",roleLabel:"GRC SME",currentUserId:a.grcSmeId,onClose:()=>t(null),onSuccess:l}),s==="assign_assessor"&&e.jsx(A,{riskId:a.id,roleType:"riskAssessor",roleLabel:"Risk Assessor",currentUserId:a.riskAssessorId||a.assessment?.riskAssessorId,onClose:()=>t(null),onSuccess:l}),s==="assign_owner"&&e.jsx(A,{riskId:a.id,roleType:"riskOwner",roleLabel:"Risk Owner",currentUserId:a.riskOwnerId||a.treatment?.riskOwnerId,onClose:()=>t(null),onSuccess:l})]})}function Ce({stage:a,intakeStatus:l,assessmentStatus:o,treatmentStatus:u}){const s=[{key:"intake",label:"Intake",statuses:["risk_identified","actual_risk"]},{key:"assessment",label:"Assessment",statuses:["risk_analysis_in_progress","risk_analyzed"]},{key:"treatment",label:"Treatment",statuses:[]},{key:"complete",label:"Complete",statuses:[]}],t=n=>{if(l==="not_a_risk")return n==="intake"?"complete":"inactive";const i=s.findIndex(m=>m.key===n),r=s.findIndex(m=>m.key===a);return n==="complete"?["risk_mitigation_complete","risk_accept","risk_transfer","risk_avoid","risk_auto_accept"].includes(u||"")?"complete":"inactive":i<r?"complete":i===r?"active":"inactive"};return e.jsx("div",{className:"flex items-center w-full",children:s.map((n,i)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium shrink-0 ${t(n.key)==="complete"?"bg-emerald-500 text-white":t(n.key)==="active"?"bg-brand-500 text-white":"bg-surface-700 text-surface-400"}`,children:t(n.key)==="complete"?e.jsx(k,{className:"w-4 h-4"}):i+1}),e.jsx("span",{className:`text-xs mt-1 whitespace-nowrap ${t(n.key)==="active"?"text-white":"text-surface-400"}`,children:n.label})]}),i<s.length-1&&e.jsx("div",{className:`h-0.5 flex-1 mx-3 min-w-[40px] ${t(s[i+1].key)!=="inactive"?"bg-emerald-500":"bg-surface-600"}`,style:{marginTop:"-20px"}})]},n.key))})}function S({label:a,userId:l,onEdit:o,editable:u=!1}){return e.jsxs("div",{className:`p-2 bg-surface-700/50 rounded-lg flex items-center justify-between ${u?"hover:bg-surface-700 cursor-pointer":""}`,onClick:u?o:void 0,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-surface-400",children:a}),e.jsx("p",{className:"text-sm text-white truncate",children:l?l.substring(0,8)+"...":"Not assigned"})]}),u&&e.jsx(ee,{className:"w-3.5 h-3.5 text-surface-500 hover:text-surface-300 shrink-0 ml-2"})]})}function J({riskId:a,approve:l,onClose:o,onSuccess:u}){const[s,t]=f.useState(""),[n,i]=f.useState(""),r=N({mutationFn:async()=>{await v.validateRisk(a,{approved:l,reason:s||void 0,riskAssessorId:l&&n||void 0})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:l?"Validate Risk":"Reject Risk"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Risk Assessor ID (optional)"}),e.jsx("input",{type:"text",value:n,onChange:m=>i(m.target.value),placeholder:"Enter assessor user ID",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:l?"Notes (optional)":"Reason for rejection *"}),e.jsx("textarea",{value:s,onChange:m=>t(m.target.value),required:!l,rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:l?"Add any notes...":"Explain why this is not a valid risk..."})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>r.mutate(),disabled:r.isPending||!l&&!s,className:`px-4 py-2 text-white rounded-lg disabled:opacity-50 ${l?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"}`,children:r.isPending?"Processing...":l?"Validate":"Reject"})]})]})})}function Se({riskId:a,onClose:l,onSuccess:o}){const[u,s]=f.useState(""),t=N({mutationFn:async()=>{await v.startAssessment(a,u)},onSuccess:()=>{o(),l()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Start Risk Assessment"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Risk Assessor ID *"}),e.jsx("input",{type:"text",value:u,onChange:n=>s(n.target.value),required:!0,placeholder:"Enter the user ID of the risk assessor",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"The SME who will analyze and assess this risk"})]})}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>t.mutate(),disabled:t.isPending||!u,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:t.isPending?"Starting...":"Start Assessment"})]})]})})}function Ae({riskId:a,assessment:l,onClose:o,onSuccess:u}){const[s,t]=f.useState({threatDescription:l?.threatDescription||"",affectedAssets:l?.affectedAssets?.join(", ")||"",existingControls:l?.existingControls?.join(", ")||"",vulnerabilities:l?.vulnerabilities||"",likelihoodScore:l?.likelihoodScore||"possible",likelihoodRationale:l?.likelihoodRationale||"",impactScore:l?.impactScore||"moderate",impactRationale:l?.impactRationale||"",recommendedOwnerId:l?.recommendedOwnerId||"",assessmentNotes:l?.assessmentNotes||"",treatmentRecommendation:l?.treatmentRecommendation||""}),n=N({mutationFn:async()=>{await v.submitAssessment(a,{...s,affectedAssets:s.affectedAssets?s.affectedAssets.split(",").map(i=>i.trim()):[],existingControls:s.existingControls?s.existingControls.split(",").map(i=>i.trim()):[]})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center sticky top-0 bg-surface-800",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Risk Assessment Form"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Threat Description *"}),e.jsx("textarea",{value:s.threatDescription,onChange:i=>t(r=>({...r,threatDescription:i.target.value})),required:!0,rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Describe the threat scenario..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Affected Assets"}),e.jsx("input",{type:"text",value:s.affectedAssets,onChange:i=>t(r=>({...r,affectedAssets:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Comma-separated list"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Existing Controls"}),e.jsx("input",{type:"text",value:s.existingControls,onChange:i=>t(r=>({...r,existingControls:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Comma-separated list"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Vulnerabilities"}),e.jsx("textarea",{value:s.vulnerabilities,onChange:i=>t(r=>({...r,vulnerabilities:i.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Describe any vulnerabilities..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Likelihood Score *"}),e.jsxs("select",{value:s.likelihoodScore,onChange:i=>t(r=>({...r,likelihoodScore:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"rare",children:"Rare"}),e.jsx("option",{value:"unlikely",children:"Unlikely"}),e.jsx("option",{value:"possible",children:"Possible"}),e.jsx("option",{value:"likely",children:"Likely"}),e.jsx("option",{value:"almost_certain",children:"Almost Certain"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Impact Score *"}),e.jsxs("select",{value:s.impactScore,onChange:i=>t(r=>({...r,impactScore:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"negligible",children:"Negligible"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"severe",children:"Severe"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Likelihood Rationale *"}),e.jsx("textarea",{value:s.likelihoodRationale,onChange:i=>t(r=>({...r,likelihoodRationale:i.target.value})),required:!0,rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Why this likelihood score?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Impact Rationale *"}),e.jsx("textarea",{value:s.impactRationale,onChange:i=>t(r=>({...r,impactRationale:i.target.value})),required:!0,rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Why this impact score?"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Recommended Risk Owner *"}),e.jsx("input",{type:"text",value:s.recommendedOwnerId,onChange:i=>t(r=>({...r,recommendedOwnerId:i.target.value})),required:!0,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"User ID of recommended owner"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Treatment Recommendation"}),e.jsxs("select",{value:s.treatmentRecommendation,onChange:i=>t(r=>({...r,treatmentRecommendation:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"mitigate",children:"Mitigate"}),e.jsx("option",{value:"accept",children:"Accept"}),e.jsx("option",{value:"transfer",children:"Transfer"}),e.jsx("option",{value:"avoid",children:"Avoid"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Assessment Notes"}),e.jsx("textarea",{value:s.assessmentNotes,onChange:i=>t(r=>({...r,assessmentNotes:i.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Any additional notes..."})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3 sticky bottom-0 bg-surface-800",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>n.mutate(),disabled:n.isPending||!s.threatDescription||!s.likelihoodRationale||!s.impactRationale||!s.recommendedOwnerId,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:n.isPending?"Submitting...":"Submit Assessment"})]})]})})}function Y({riskId:a,approve:l,onClose:o,onSuccess:u}){const[s,t]=f.useState(""),[n,i]=f.useState(""),r=N({mutationFn:async()=>{await v.reviewAssessment(a,{approved:l,notes:s||void 0,declinedReason:l?void 0:n})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:l?"Approve Assessment":"Request Revision"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsx("div",{className:"p-4 space-y-4",children:l?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:s,onChange:m=>t(m.target.value),rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Add any notes..."})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Reason for Revision *"}),e.jsx("textarea",{value:n,onChange:m=>i(m.target.value),required:!0,rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Explain what needs to be revised..."})]})}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>r.mutate(),disabled:r.isPending||!l&&!n,className:`px-4 py-2 text-white rounded-lg disabled:opacity-50 ${l?"bg-emerald-500 hover:bg-emerald-600":"bg-amber-500 hover:bg-amber-600"}`,children:r.isPending?"Processing...":l?"Approve":"Request Revision"})]})]})})}function Re({riskId:a,assessment:l,onClose:o,onSuccess:u}){const[s,t]=f.useState({likelihoodScore:l?.likelihoodScore||"",likelihoodRationale:l?.likelihoodRationale||"",impactScore:l?.impactScore||"",impactRationale:l?.impactRationale||"",recommendedOwnerId:l?.recommendedOwnerId||"",assessmentNotes:l?.assessmentNotes||""}),n=N({mutationFn:async()=>{await v.completeRevision(a,s)},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Complete Revision"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Update the fields that need revision. Leave blank to keep existing values."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Likelihood Score"}),e.jsxs("select",{value:s.likelihoodScore,onChange:i=>t(r=>({...r,likelihoodScore:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Keep existing"}),e.jsx("option",{value:"rare",children:"Rare"}),e.jsx("option",{value:"unlikely",children:"Unlikely"}),e.jsx("option",{value:"possible",children:"Possible"}),e.jsx("option",{value:"likely",children:"Likely"}),e.jsx("option",{value:"almost_certain",children:"Almost Certain"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Impact Score"}),e.jsxs("select",{value:s.impactScore,onChange:i=>t(r=>({...r,impactScore:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Keep existing"}),e.jsx("option",{value:"negligible",children:"Negligible"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"severe",children:"Severe"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Assessment Notes"}),e.jsx("textarea",{value:s.assessmentNotes,onChange:i=>t(r=>({...r,assessmentNotes:i.target.value})),rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Updated notes..."})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>n.mutate(),disabled:n.isPending,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:n.isPending?"Submitting...":"Complete Revision"})]})]})})}function _e({riskId:a,inherentRisk:l,onClose:o,onSuccess:u}){const[s,t]=f.useState({decision:"mitigate",justification:"",mitigationDescription:"",mitigationTargetDate:"",transferTo:"",transferCost:"",avoidStrategy:"",acceptanceRationale:"",acceptanceExpiresAt:""}),n=["very_high","high"].includes(l||"")&&s.decision!=="mitigate",i=N({mutationFn:async()=>{await v.submitTreatmentDecision(a,{decision:s.decision,justification:s.justification,mitigationDescription:s.mitigationDescription||void 0,mitigationTargetDate:s.mitigationTargetDate||void 0,transferTo:s.transferTo||void 0,transferCost:s.transferCost?parseFloat(s.transferCost):void 0,avoidStrategy:s.avoidStrategy||void 0,acceptanceRationale:s.acceptanceRationale||void 0,acceptanceExpiresAt:s.acceptanceExpiresAt||void 0})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Treatment Decision"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Treatment Strategy *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"mitigate",label:"Mitigate",desc:"Implement controls"},{value:"accept",label:"Accept",desc:"Accept the risk"},{value:"transfer",label:"Transfer",desc:"Insurance/3rd party"},{value:"avoid",label:"Avoid",desc:"Eliminate risk"}].map(r=>e.jsxs("button",{type:"button",onClick:()=>t(m=>({...m,decision:r.value})),className:`p-3 rounded-lg text-left ${s.decision===r.value?"bg-brand-500/20 border border-brand-500":"bg-surface-700 border border-surface-600"}`,children:[e.jsx("p",{className:"text-white font-medium",children:r.label}),e.jsx("p",{className:"text-surface-400 text-xs",children:r.desc})]},r.value))})]}),n&&e.jsx("div",{className:"p-3 bg-amber-500/20 rounded-lg border border-amber-500/30",children:e.jsx("p",{className:"text-amber-400 text-sm",children:"⚠️ This decision requires Executive Approval due to the risk level."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Justification *"}),e.jsx("textarea",{value:s.justification,onChange:r=>t(m=>({...m,justification:r.target.value})),required:!0,rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Explain why this treatment strategy..."})]}),s.decision==="mitigate"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Mitigation Description"}),e.jsx("textarea",{value:s.mitigationDescription,onChange:r=>t(m=>({...m,mitigationDescription:r.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Describe the mitigation plan..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Target Date"}),e.jsx("input",{type:"date",value:s.mitigationTargetDate,onChange:r=>t(m=>({...m,mitigationTargetDate:r.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]})]}),s.decision==="transfer"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Transfer To"}),e.jsx("input",{type:"text",value:s.transferTo,onChange:r=>t(m=>({...m,transferTo:r.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Insurance provider..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Cost ($)"}),e.jsx("input",{type:"number",value:s.transferCost,onChange:r=>t(m=>({...m,transferCost:r.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"0"})]})]}),s.decision==="avoid"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Avoidance Strategy"}),e.jsx("textarea",{value:s.avoidStrategy,onChange:r=>t(m=>({...m,avoidStrategy:r.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"How will the risk be avoided..."})]}),s.decision==="accept"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Acceptance Rationale"}),e.jsx("textarea",{value:s.acceptanceRationale,onChange:r=>t(m=>({...m,acceptanceRationale:r.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Why is accepting appropriate..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Acceptance Expires"}),e.jsx("input",{type:"date",value:s.acceptanceExpiresAt,onChange:r=>t(m=>({...m,acceptanceExpiresAt:r.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>i.mutate(),disabled:i.isPending||!s.justification,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:i.isPending?"Submitting...":"Submit Decision"})]})]})})}function Ie({riskId:a,onClose:l,onSuccess:o}){const[u,s]=f.useState(""),t=N({mutationFn:async()=>{await v.assignExecutiveApprover(a,u)},onSuccess:()=>{o(),l()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Assign Executive Approver"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Identify the department lead or executive who should approve this treatment decision."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Executive Approver ID *"}),e.jsx("input",{type:"text",value:u,onChange:n=>s(n.target.value),required:!0,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"User ID of the executive approver"})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>t.mutate(),disabled:t.isPending||!u,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:t.isPending?"Assigning...":"Assign Approver"})]})]})})}function Z({riskId:a,approve:l,onClose:o,onSuccess:u}){const[s,t]=f.useState(""),[n,i]=f.useState(""),r=N({mutationFn:async()=>{await v.submitExecutiveApproval(a,{approved:l,notes:s||void 0,deniedReason:l?void 0:n})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:l?"Approve Treatment":"Deny Treatment"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsx("div",{className:"p-4 space-y-4",children:l?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:s,onChange:m=>t(m.target.value),rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Add any notes..."})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Reason for Denial *"}),e.jsx("textarea",{value:n,onChange:m=>i(m.target.value),required:!0,rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Explain why this decision is denied..."})]})}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>r.mutate(),disabled:r.isPending||!l&&!n,className:`px-4 py-2 text-white rounded-lg disabled:opacity-50 ${l?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"}`,children:r.isPending?"Processing...":l?"Approve":"Deny"})]})]})})}function De({riskId:a,treatment:l,onClose:o,onSuccess:u}){const[s,t]=f.useState({status:l?.mitigationStatus||"on_track",progress:l?.mitigationProgress||0,notes:"",newTargetDate:"",delayReason:"",cancellationReason:"",residualLikelihood:"",residualImpact:""}),n=N({mutationFn:async()=>{await v.updateMitigationStatus(a,{status:s.status,progress:s.progress,notes:s.notes||void 0,newTargetDate:s.newTargetDate||void 0,delayReason:s.delayReason||void 0,cancellationReason:s.cancellationReason||void 0,residualLikelihood:s.residualLikelihood||void 0,residualImpact:s.residualImpact||void 0})},onSuccess:()=>{u(),o()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Update Mitigation Status"}),e.jsx("button",{onClick:o,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Status *"}),e.jsxs("select",{value:s.status,onChange:i=>t(r=>({...r,status:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"on_track",children:"On Track"}),e.jsx("option",{value:"delayed",children:"Delayed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-surface-400 mb-2",children:["Progress: ",s.progress,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:s.progress,onChange:i=>t(r=>({...r,progress:parseInt(i.target.value)})),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Notes"}),e.jsx("textarea",{value:s.notes,onChange:i=>t(r=>({...r,notes:i.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Update notes..."})]}),s.status==="delayed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"New Target Date"}),e.jsx("input",{type:"date",value:s.newTargetDate,onChange:i=>t(r=>({...r,newTargetDate:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Delay Reason"}),e.jsx("textarea",{value:s.delayReason,onChange:i=>t(r=>({...r,delayReason:i.target.value})),rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Why is it delayed..."})]})]}),s.status==="cancelled"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Cancellation Reason *"}),e.jsx("textarea",{value:s.cancellationReason,onChange:i=>t(r=>({...r,cancellationReason:i.target.value})),required:!0,rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Why is mitigation cancelled..."})]}),s.status==="done"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Residual Likelihood"}),e.jsxs("select",{value:s.residualLikelihood,onChange:i=>t(r=>({...r,residualLikelihood:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"rare",children:"Rare"}),e.jsx("option",{value:"unlikely",children:"Unlikely"}),e.jsx("option",{value:"possible",children:"Possible"}),e.jsx("option",{value:"likely",children:"Likely"}),e.jsx("option",{value:"almost_certain",children:"Almost Certain"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Residual Impact"}),e.jsxs("select",{value:s.residualImpact,onChange:i=>t(r=>({...r,residualImpact:i.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"negligible",children:"Negligible"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"major",children:"Major"}),e.jsx("option",{value:"severe",children:"Severe"})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>n.mutate(),disabled:n.isPending||s.status==="cancelled"&&!s.cancellationReason,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:n.isPending?"Updating...":"Update Status"})]})]})})}function A({riskId:a,roleType:l,roleLabel:o,currentUserId:u,onClose:s,onSuccess:t}){const[n,i]=f.useState(u||""),[r,m]=f.useState(""),{data:x}=_({queryKey:["users","list"],queryFn:async()=>{const g=await fetch("/api/users?limit=100");return g.ok?g.json():{users:[]}}}),h=x?.users||[],b=h.filter(g=>g.email?.toLowerCase().includes(r.toLowerCase())||g.firstName?.toLowerCase().includes(r.toLowerCase())||g.lastName?.toLowerCase().includes(r.toLowerCase())),p=N({mutationFn:async()=>{const g={reporter:"reporterId",grcSme:"grcSmeId",riskAssessor:"riskAssessorId",riskOwner:"riskOwnerId"};await v.update(a,{[g[l]]:n||null})},onSuccess:()=>{t(),s()}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-white",children:["Assign ",o]}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Search Users"}),e.jsx("input",{type:"text",value:r,onChange:g=>m(g.target.value),placeholder:"Search by name or email...",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-2",children:[e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${n===""?"bg-brand-500/20 border border-brand-500":"bg-surface-700 hover:bg-surface-600"}`,children:[e.jsx("input",{type:"radio",name:"user",value:"",checked:n==="",onChange:()=>i(""),className:"sr-only"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-surface-600 flex items-center justify-center",children:e.jsx(R,{className:"w-4 h-4 text-surface-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:"Unassigned"}),e.jsx("p",{className:"text-sm text-surface-400",children:"Remove assignment"})]})]}),b.length===0&&r&&e.jsx("p",{className:"text-center text-surface-500 py-4",children:"No users found"}),b.map(g=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${n===g.id?"bg-brand-500/20 border border-brand-500":"bg-surface-700 hover:bg-surface-600"}`,children:[e.jsx("input",{type:"radio",name:"user",value:g.id,checked:n===g.id,onChange:d=>i(d.target.value),className:"sr-only"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-500 flex items-center justify-center text-white text-sm font-medium",children:(g.firstName?.[0]||g.email?.[0]||"?").toUpperCase()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-white truncate",children:g.firstName&&g.lastName?`${g.firstName} ${g.lastName}`:g.email}),e.jsx("p",{className:"text-sm text-surface-400 truncate",children:g.email})]})]},g.id)),h.length===0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Or enter User ID directly:"}),e.jsx("input",{type:"text",value:n,onChange:g=>i(g.target.value),placeholder:"Enter user ID...",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>p.mutate(),disabled:p.isPending,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:p.isPending?"Saving...":"Assign"})]})]})})}const Te=[{value:"low",label:"Low",color:"bg-emerald-500"},{value:"medium",label:"Medium",color:"bg-amber-500"},{value:"high",label:"High",color:"bg-orange-500"},{value:"critical",label:"Critical",color:"bg-red-500"}],Ee=["rare","unlikely","possible","likely","almost_certain"],Le=["negligible","minor","moderate","major","severe"],Me=[{value:"accept",label:"Accept",description:"Accept the risk as-is"},{value:"mitigate",label:"Mitigate",description:"Implement controls to reduce risk"},{value:"transfer",label:"Transfer",description:"Transfer risk to third party"},{value:"avoid",label:"Avoid",description:"Eliminate the risk entirely"}],Pe=[{value:"none",label:"None",color:"text-red-400"},{value:"partial",label:"Partial",color:"text-amber-400"},{value:"full",label:"Full",color:"text-emerald-400"}];function Xe(){const{id:a}=be(),l=he(),o=pe(),[u,s]=f.useState("controls"),[t,n]=f.useState(!1),[i,r]=f.useState(!1),[m,x]=f.useState(!1),[h,b]=f.useState(!1),[p,g]=f.useState(!1),{data:d,isLoading:se}=_({queryKey:["risks",a],queryFn:async()=>(await v.get(a)).data,enabled:!!a}),{data:te}=_({queryKey:["controls","all"],queryFn:async()=>(await Ne.list({limit:500})).data}),{data:ae}=_({queryKey:["assets","all"],queryFn:async()=>(await ye.list({limit:500})).data}),M=N({mutationFn:async c=>(await v.update(a,c)).data,onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),n(!1),j.success("Risk updated successfully")},onError:()=>j.error("Failed to update risk")}),re=N({mutationFn:async()=>{await v.delete(a)},onSuccess:()=>{j.success("Risk deleted successfully"),l("/risks")},onError:()=>j.error("Failed to delete risk")}),P=N({mutationFn:async c=>(await v.updateTreatment(a,c)).data,onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),r(!1),j.success("Treatment plan updated")},onError:()=>j.error("Failed to update treatment")}),F=N({mutationFn:async()=>(await v.markReviewed(a)).data,onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),j.success("Risk marked as reviewed")},onError:()=>j.error("Failed to mark as reviewed")}),q=N({mutationFn:async c=>{await v.linkControl(a,c)},onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),x(!1),j.success("Control linked")},onError:()=>j.error("Failed to link control")}),le=N({mutationFn:async c=>{await v.unlinkControl(a,c)},onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),j.success("Control unlinked")},onError:()=>j.error("Failed to unlink control")}),z=N({mutationFn:async c=>{await v.linkAssets(a,c)},onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),b(!1),j.success("Assets linked")},onError:()=>j.error("Failed to link assets")}),ie=N({mutationFn:async c=>{await v.unlinkAsset(a,c)},onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),j.success("Asset unlinked")},onError:()=>j.error("Failed to unlink asset")}),O=N({mutationFn:async c=>(await v.createScenario(a,c)).data,onSuccess:()=>{o.invalidateQueries({queryKey:["risks",a]}),g(!1),j.success("Scenario created")},onError:()=>j.error("Failed to create scenario")}),ne=N({mutationFn:async c=>{await v.deleteScenario(a,c)},onSuccess:()=>{j.success("Scenario deleted"),o.invalidateQueries({queryKey:["risks",a]})},onError:()=>j.error("Failed to delete scenario")}),$=c=>Te.find(oe=>oe.value===c)?.color||"bg-gray-500",ce=c=>{switch(c){case"open":return"bg-red-500/20 text-red-400";case"in_treatment":return"bg-amber-500/20 text-amber-400";case"accepted":return"bg-blue-500/20 text-blue-400";case"mitigated":return"bg-emerald-500/20 text-emerald-400";case"closed":return"bg-surface-500/20 text-surface-400";default:return"bg-surface-500/20 text-surface-400"}},V=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(c);return se?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-surface-400",children:"Loading risk details..."})}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l("/risks"),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-brand-400 font-mono",children:d.riskId}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${ce(d.status)}`,children:d.status.replace("_"," ")})]}),e.jsx("h1",{className:"text-2xl font-semibold text-white mt-1",children:d.title})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>F.mutate(),disabled:F.isPending,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg hover:bg-surface-600 flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Mark Reviewed"]}),e.jsxs("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Treatment Plan"]}),e.jsx("button",{onClick:()=>n(!0),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this risk?")&&re.mutate()},className:"p-2 hover:bg-red-500/20 rounded-lg text-red-400",children:e.jsx(B,{className:"w-5 h-5"})})]})]}),e.jsx(ke,{risk:d,onUpdate:()=>o.invalidateQueries({queryKey:["risks",a]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-surface-800 rounded-xl border border-surface-700 p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Description"}),e.jsx("p",{className:"text-surface-200",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Category"}),e.jsx("p",{className:"text-white capitalize",children:d.category})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Review Frequency"}),e.jsx("p",{className:"text-white capitalize",children:d.reviewFrequency})]}),d.lastReviewedAt&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Last Reviewed"}),e.jsx("p",{className:"text-white",children:new Date(d.lastReviewedAt).toLocaleDateString()})]}),d.nextReviewDue&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Next Review Due"}),e.jsx("p",{className:"text-white",children:new Date(d.nextReviewDue).toLocaleDateString()})]})]}),(d?.tags?.length??0)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d?.tags?.map(c=>e.jsx("span",{className:"px-2 py-1 bg-brand-500/20 text-brand-400 rounded text-sm",children:c},c))})]}),d.treatmentPlan&&e.jsxs("div",{className:"pt-4 border-t border-surface-700",children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:"Treatment Plan"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"px-3 py-1 bg-brand-500/20 text-brand-400 rounded capitalize",children:d.treatmentPlan}),d.treatmentDueDate&&e.jsxs("span",{className:"text-surface-400 text-sm flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),"Due: ",new Date(d.treatmentDueDate).toLocaleDateString()]})]}),d.treatmentNotes&&e.jsx("p",{className:"text-surface-300 mt-2",children:d.treatmentNotes})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Risk Assessment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-surface-400",children:"Likelihood"}),e.jsx("span",{className:"text-white capitalize",children:(d.likelihood||"").replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-surface-400",children:"Impact"}),e.jsx("span",{className:"text-white capitalize",children:d.impact})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-surface-700",children:[e.jsx("span",{className:"text-surface-400",children:"Inherent Risk"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${$(d.inherentRisk||"")}`}),e.jsx("span",{className:"text-white capitalize font-medium",children:d.inherentRisk})]})]}),d.residualRisk&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-surface-400",children:"Residual Risk"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${$(d.residualRisk)}`}),e.jsx("span",{className:"text-white capitalize font-medium",children:d.residualRisk})]})]})]})]}),(d.likelihoodPct!==void 0||d.impactValue!==void 0)&&e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Quantitative Analysis"}),e.jsxs("div",{className:"space-y-4",children:[d.likelihoodPct!==void 0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Likelihood"]}),e.jsxs("span",{className:"text-white",children:[d.likelihoodPct,"%"]})]}),d.impactValue!==void 0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Impact Value"]}),e.jsx("span",{className:"text-white",children:V(d.impactValue)})]}),d.annualLossExp!==void 0&&e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-surface-700",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Annual Loss Exp."]}),e.jsx("span",{className:"text-white font-medium",children:V(d.annualLossExp)})]})]})]}),e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Linked Items"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Assets"]}),e.jsx("span",{className:"text-white",children:d.assetCount})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Controls"]}),e.jsx("span",{className:"text-white",children:d.controlCount})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-surface-400 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Scenarios"]}),e.jsx("span",{className:"text-white",children:d.scenarioCount})]})]})]})]})]}),e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700",children:[e.jsx("div",{className:"flex border-b border-surface-700",children:[{key:"controls",label:"Controls",icon:C,count:d?.controls?.length??0},{key:"assets",label:"Assets",icon:D,count:d?.assets?.length??0},{key:"scenarios",label:"Scenarios",icon:X,count:d?.scenarios?.length??0},{key:"history",label:"History",icon:je,count:d?.history?.length??0}].map(c=>e.jsxs("button",{onClick:()=>s(c.key),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${u===c.key?"border-brand-500 text-brand-400":"border-transparent text-surface-400 hover:text-surface-300"}`,children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label,e.jsx("span",{className:"px-2 py-0.5 bg-surface-700 rounded text-xs",children:c.count})]},c.key))}),e.jsxs("div",{className:"p-6",children:[u==="controls"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-surface-400",children:"Controls that mitigate this risk"}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-brand-500 text-white rounded-lg hover:bg-brand-600 text-sm",children:[e.jsx(T,{className:"w-4 h-4"}),"Link Control"]})]}),(d?.controls?.length??0)===0?e.jsx("div",{className:"text-center py-8 text-surface-500",children:"No controls linked to this risk"}):e.jsx("div",{className:"space-y-2",children:d?.controls?.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-surface-700 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-brand-400 font-mono text-sm",children:c.controlId}),e.jsx("p",{className:"text-white",children:c.title})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-sm ${Pe.find(w=>w.value===c.effectiveness)?.color}`,children:[c.effectiveness," effectiveness"]}),e.jsx("button",{onClick:()=>le.mutate(c.id),className:"p-1 hover:bg-surface-600 rounded text-surface-400 hover:text-red-400",children:e.jsx(y,{className:"w-4 h-4"})})]})]},c.id))})]}),u==="assets"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-surface-400",children:"Assets affected by this risk"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-brand-500 text-white rounded-lg hover:bg-brand-600 text-sm",children:[e.jsx(T,{className:"w-4 h-4"}),"Link Asset"]})]}),(d?.assets?.length??0)===0?e.jsx("div",{className:"text-center py-8 text-surface-500",children:"No assets linked to this risk"}):e.jsx("div",{className:"space-y-2",children:d?.assets?.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-surface-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{className:"w-8 h-8 text-surface-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:c.name}),e.jsxs("p",{className:"text-sm text-surface-400",children:[c.type," • ",c.criticality," criticality • ",c.source]})]})]}),e.jsx("button",{onClick:()=>ie.mutate(c.id),className:"p-1 hover:bg-surface-600 rounded text-surface-400 hover:text-red-400",children:e.jsx(y,{className:"w-4 h-4"})})]},c.id))})]}),u==="scenarios"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-surface-400",children:"Threat scenarios and attack vectors"}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-brand-500 text-white rounded-lg hover:bg-brand-600 text-sm",children:[e.jsx(T,{className:"w-4 h-4"}),"Add Scenario"]})]}),(d?.scenarios?.length??0)===0?e.jsx("div",{className:"text-center py-8 text-surface-500",children:"No scenarios defined for this risk"}):e.jsx("div",{className:"space-y-3",children:d?.scenarios?.map(c=>e.jsx("div",{className:"p-4 bg-surface-700 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:c.title}),e.jsx("p",{className:"text-surface-400 mt-1",children:c.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm",children:[c.threatActor&&e.jsxs("span",{className:"text-surface-400",children:["Threat Actor: ",e.jsx("span",{className:"text-surface-300",children:c.threatActor})]}),c.attackVector&&e.jsxs("span",{className:"text-surface-400",children:["Vector: ",e.jsx("span",{className:"text-surface-300",children:c.attackVector})]}),e.jsxs("span",{className:"text-surface-400",children:["L: ",e.jsx("span",{className:"text-surface-300 capitalize",children:c.likelihood.replace("_"," ")})]}),e.jsxs("span",{className:"text-surface-400",children:["I: ",e.jsx("span",{className:"text-surface-300 capitalize",children:c.impact})]})]})]}),e.jsx("button",{onClick:()=>ne.mutate(c.id),className:"p-1 hover:bg-surface-600 rounded text-surface-400 hover:text-red-400",children:e.jsx(B,{className:"w-4 h-4"})})]})},c.id))})]}),u==="history"&&e.jsx(we,{entityType:"risk",entityId:a})]})]}),m&&e.jsx(Fe,{controls:te?.data||[],linkedControlIds:d?.controls?.map(c=>c.id)??[],onLink:(c,w)=>q.mutate({controlId:c,effectiveness:w}),onClose:()=>x(!1),isPending:q.isPending}),h&&e.jsx(qe,{assets:ae?.assets||[],linkedAssetIds:d?.assets?.map(c=>c.id)??[],onLink:c=>z.mutate(c),onClose:()=>b(!1),isPending:z.isPending}),i&&e.jsx(ze,{currentPlan:d.treatmentPlan,currentNotes:d.treatmentNotes,currentDueDate:d.treatmentDueDate,onSave:c=>P.mutate(c),onClose:()=>r(!1),isPending:P.isPending}),p&&e.jsx(Oe,{onCreate:c=>O.mutate(c),onClose:()=>g(!1),isPending:O.isPending}),t&&e.jsx(Ke,{risk:d,onSave:c=>M.mutate(c),onClose:()=>n(!1),isPending:M.isPending})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-surface-400",children:"Risk not found"})})}function Fe({controls:a,linkedControlIds:l,onLink:o,onClose:u,isPending:s}){const[t,n]=f.useState(""),[i,r]=f.useState("partial"),[m,x]=f.useState(""),h=a.filter(b=>!l.includes(b.id)&&(b.title.toLowerCase().includes(m.toLowerCase())||b.controlId.toLowerCase().includes(m.toLowerCase())));return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Link Control"}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Search controls...",value:m,onChange:b=>x(b.target.value),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:h.map(b=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${t===b.id?"bg-brand-500/20":"bg-surface-700 hover:bg-surface-600"}`,children:[e.jsx("input",{type:"radio",name:"control",value:b.id,checked:t===b.id,onChange:p=>n(p.target.value),className:"sr-only"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-brand-400 font-mono text-sm",children:b.controlId}),e.jsx("p",{className:"text-white",children:b.title})]})]},b.id))}),t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Control Effectiveness"}),e.jsxs("select",{value:i,onChange:b=>r(b.target.value),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"full",children:"Full"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>t&&o(t,i),disabled:!t||s,className:"px-4 py-2 bg-brand-500 text-white rounded-lg disabled:opacity-50",children:s?"Linking...":"Link Control"})]})]})})}function qe({assets:a,linkedAssetIds:l,onLink:o,onClose:u,isPending:s}){const[t,n]=f.useState([]),[i,r]=f.useState(""),m=a.filter(h=>!l.includes(h.id)&&h.name.toLowerCase().includes(i.toLowerCase())),x=h=>{n(b=>b.includes(h)?b.filter(p=>p!==h):[...b,h])};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Link Assets"}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Search assets...",value:i,onChange:h=>r(h.target.value),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:m.length===0?e.jsx("p",{className:"text-center text-surface-500 py-4",children:"No assets available"}):m.map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${t.includes(h.id)?"bg-brand-500/20":"bg-surface-700 hover:bg-surface-600"}`,children:[e.jsx("input",{type:"checkbox",checked:t.includes(h.id),onChange:()=>x(h.id),className:"rounded border-surface-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:h.name}),e.jsxs("p",{className:"text-sm text-surface-400",children:[h.type," • ",h.source]})]})]},h.id))})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>o(t),disabled:t.length===0||s,className:"px-4 py-2 bg-brand-500 text-white rounded-lg disabled:opacity-50",children:s?"Linking...":`Link ${t.length} Asset(s)`})]})]})})}function ze({currentPlan:a,currentNotes:l,currentDueDate:o,onSave:u,onClose:s,isPending:t}){const[n,i]=f.useState(a||"mitigate"),[r,m]=f.useState(l||""),[x,h]=f.useState(o?o.split("T")[0]:"");return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Treatment Plan"}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Treatment Strategy"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Me.map(b=>e.jsxs("button",{type:"button",onClick:()=>i(b.value),className:`p-3 rounded-lg text-left ${n===b.value?"bg-brand-500/20 border border-brand-500":"bg-surface-700 border border-surface-600 hover:bg-surface-600"}`,children:[e.jsx("p",{className:"text-white font-medium",children:b.label}),e.jsx("p",{className:"text-surface-400 text-sm",children:b.description})]},b.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:x,onChange:b=>h(b.target.value),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Notes"}),e.jsx("textarea",{value:r,onChange:b=>m(b.target.value),rows:3,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"Describe the treatment approach..."})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:()=>u({treatmentPlan:n,treatmentNotes:r,treatmentDueDate:x||void 0}),disabled:t,className:"px-4 py-2 bg-brand-500 text-white rounded-lg disabled:opacity-50",children:t?"Saving...":"Save Treatment"})]})]})})}function Oe({onCreate:a,onClose:l,isPending:o}){const[u,s]=f.useState({title:"",description:"",threatActor:"",attackVector:"",likelihood:"possible",impact:"moderate",notes:""});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Add Scenario"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(y,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),a(u)},className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:u.title,onChange:t=>s(n=>({...n,title:t.target.value})),required:!0,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"e.g., Phishing attack on employees"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Description *"}),e.jsx("textarea",{value:u.description,onChange:t=>s(n=>({...n,description:t.target.value})),required:!0,rows:2,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Threat Actor"}),e.jsxs("select",{value:u.threatActor,onChange:t=>s(n=>({...n,threatActor:t.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"insider",children:"Insider"}),e.jsx("option",{value:"external",children:"External"}),e.jsx("option",{value:"natural",children:"Natural Event"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Attack Vector"}),e.jsx("input",{type:"text",value:u.attackVector,onChange:t=>s(n=>({...n,attackVector:t.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"e.g., Email, Network"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Likelihood"}),e.jsx("select",{value:u.likelihood,onChange:t=>s(n=>({...n,likelihood:t.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:Ee.map(t=>e.jsx("option",{value:t,children:t.replace("_"," ")},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Impact"}),e.jsx("select",{value:u.impact,onChange:t=>s(n=>({...n,impact:t.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:Le.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-brand-500 text-white rounded-lg disabled:opacity-50",children:o?"Creating...":"Create Scenario"})]})]})]})})}const $e=[{value:"technical",label:"Technical"},{value:"process_compliance",label:"Process & Compliance"},{value:"third_party",label:"Third Party"},{value:"operational",label:"Operational"},{value:"strategic",label:"Strategic"},{value:"compliance",label:"Compliance"},{value:"security",label:"Security"},{value:"financial",label:"Financial"}],Ve=[{value:"internal_security_reviews",label:"Internal Security Reviews"},{value:"ad_hoc_discovery",label:"Ad Hoc Discovery"},{value:"external_security_reviews",label:"External Security Reviews"},{value:"incident_response",label:"Incident Response"},{value:"policy_exception",label:"Policy Exception"},{value:"employee_reporting",label:"Employee Reporting"}],Ue=[{value:"very_low",label:"Very Low"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"very_high",label:"Very High"}];function Ke({risk:a,onSave:l,onClose:o,isPending:u}){const[s,t]=f.useState({title:a.title,description:a.description,category:a.category||"security",source:a.source||"employee_reporting",initialSeverity:a.initialSeverity||"medium",tags:a.tags||[]}),[n,i]=f.useState(""),r=()=>{n.trim()&&!s.tags.includes(n.trim())&&(t(x=>({...x,tags:[...x.tags,n.trim()]})),i(""))},m=x=>{t(h=>({...h,tags:h.tags.filter(b=>b!==x)}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Edit Risk"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(y,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:x=>{x.preventDefault(),l(s)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:s.title,onChange:x=>t(h=>({...h,title:x.target.value})),required:!0,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Description *"}),e.jsx("textarea",{value:s.description,onChange:x=>t(h=>({...h,description:x.target.value})),required:!0,rows:4,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Category"}),e.jsx("select",{value:s.category,onChange:x=>t(h=>({...h,category:x.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:$e.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Source"}),e.jsx("select",{value:s.source,onChange:x=>t(h=>({...h,source:x.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:Ve.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Initial Severity"}),e.jsx("select",{value:s.initialSeverity,onChange:x=>t(h=>({...h,initialSeverity:x.target.value})),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:Ue.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Tags"}),e.jsx("div",{className:"flex gap-2 mb-2 flex-wrap",children:s.tags.map(x=>e.jsxs("span",{className:"px-2 py-1 bg-brand-500/20 text-brand-400 rounded text-sm flex items-center gap-1",children:[x,e.jsx("button",{type:"button",onClick:()=>m(x),className:"hover:text-brand-300",children:e.jsx(y,{className:"w-3 h-3"})})]},x))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:x=>i(x.target.value),onKeyPress:x=>x.key==="Enter"&&(x.preventDefault(),r()),className:"flex-1 px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"Add tag..."}),e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg hover:bg-surface-600",children:"Add"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg hover:bg-surface-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 disabled:opacity-50",children:u?"Saving...":"Save Changes"})]})]})]})})}export{Xe as default};
