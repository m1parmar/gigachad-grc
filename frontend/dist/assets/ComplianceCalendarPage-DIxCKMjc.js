import{k as V,r as u,b as g,j as t,B as l,bR as B,am as G,bQ as H,A as W,q as z,y as J,H as X}from"./vendor-CWk44mA8.js";import{p as Z,U as ee,e as te,S as se}from"./index-CiJwl-Bo.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const x={policy_review:{label:"Policy Review",icon:J,color:"bg-blue-500",textColor:"text-blue-400",path:"/policies"},audit:{label:"Audit",icon:z,color:"bg-purple-500",textColor:"text-purple-400",path:"/audits"},control_review:{label:"Control Review",icon:W,color:"bg-emerald-500",textColor:"text-emerald-400",path:"/controls"},contract_expiration:{label:"Contract Expiration",icon:H,color:"bg-orange-500",textColor:"text-orange-400",path:"/contracts"}},ae=(i,c)=>new Date(i,c+1,0).getDate(),ne=(i,c)=>new Date(i,c,1).getDay(),j=(i,c)=>i.getFullYear()===c.getFullYear()&&i.getMonth()===c.getMonth()&&i.getDate()===c.getDate(),re=i=>j(i,new Date),ie=i=>i.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});function ce({className:i,showFilters:c=!0}){const R=V(),a=new Date,[f,y]=u.useState(new Date(a.getFullYear(),a.getMonth(),1)),[o,v]=u.useState(null),[p,M]=u.useState(new Set(["policy_review","audit","control_review","contract_expiration"])),{data:I}=g({queryKey:["policies-calendar"],queryFn:()=>Z.list({limit:100}).then(s=>s.data)}),N=I?.data||[],{data:D}=g({queryKey:["audits-calendar"],queryFn:()=>ee.list().then(s=>s.data)}),{data:_}=g({queryKey:["controls-calendar"],queryFn:()=>te.list({limit:100}).then(s=>s.data)}),T=_?.data||[],{data:C}=g({queryKey:["contracts-calendar"],queryFn:()=>se.list().then(s=>s.data)}),w=u.useMemo(()=>{const s=[];return(N||[]).forEach(e=>{e.reviewDate&&s.push({id:`policy-${e.id}`,title:`Review: ${e.title}`,date:new Date(e.reviewDate),type:"policy_review",entityId:e.id,entityType:"policy",status:e.status,priority:new Date(e.reviewDate)<a?"critical":"medium"})}),(D||[]).forEach(e=>{e.plannedStartDate&&s.push({id:`audit-start-${e.id}`,title:`Start: ${e.name}`,date:new Date(e.plannedStartDate),type:"audit",entityId:e.id,entityType:"audit",status:e.status,priority:"high"}),e.plannedEndDate&&s.push({id:`audit-end-${e.id}`,title:`Due: ${e.name}`,date:new Date(e.plannedEndDate),type:"audit",entityId:e.id,entityType:"audit",status:e.status,priority:e.status!=="completed"?"critical":"low"})}),(T||[]).forEach(e=>{e.implementation?.nextReviewDate&&s.push({id:`control-${e.id}`,title:`Review: ${e.title}`,date:new Date(e.implementation.nextReviewDate),type:"control_review",entityId:e.id,entityType:"control",status:e.implementation?.status,priority:new Date(e.implementation.nextReviewDate)<a?"critical":"medium"})}),(C||[]).forEach(e=>{if(e.endDate){const n=new Date(e.endDate),r=Math.ceil((n.getTime()-a.getTime())/(1e3*60*60*24));s.push({id:`contract-${e.id}`,title:`Expires: ${e.name||e.title}`,date:n,type:"contract_expiration",entityId:e.id,entityType:"contract",status:e.status,priority:r<=0?"critical":r<=30?"high":"medium"})}}),s.filter(e=>p.has(e.type))},[N,D,T,C,p,a]),$=s=>w.filter(e=>j(e.date,s)),F=o?$(o):[],E=u.useMemo(()=>{const s=new Date(a);return s.setDate(s.getDate()+30),w.filter(e=>e.date>=a&&e.date<=s).sort((e,n)=>e.date.getTime()-n.date.getTime()).slice(0,10)},[w,a]),d=f.getFullYear(),m=f.getMonth(),k=ae(d,m),q=ne(d,m),A=()=>{y(new Date(d,m-1,1))},U=()=>{y(new Date(d,m+1,1))},Y=()=>{y(new Date(a.getFullYear(),a.getMonth(),1)),v(a)},K=s=>{const e=new Set(p);e.has(s)?e.delete(s):e.add(s),M(e)},S=s=>{const e=x[s.type];R(`${e.path}/${s.entityId}`)};return t.jsx("div",{className:l("space-y-6",i),children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 bg-surface-800 rounded-xl border border-surface-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:f.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),t.jsx("button",{onClick:Y,className:"px-3 py-1 text-sm bg-surface-700 hover:bg-surface-600 rounded-lg text-surface-300",children:"Today"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:A,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:t.jsx(B,{className:"w-5 h-5"})}),t.jsx("button",{onClick:U,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:t.jsx(G,{className:"w-5 h-5"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>t.jsx("div",{className:"text-center text-sm font-medium text-surface-500 py-2",children:s},s))}),t.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:q}).map((s,e)=>t.jsx("div",{className:"aspect-square p-1"},`empty-${e}`)),Array.from({length:k}).map((s,e)=>{const n=e+1,r=new Date(d,m,n),h=$(r),L=o&&j(r,o),b=re(r),O=r<a&&!b;return t.jsxs("button",{onClick:()=>v(r),className:l("aspect-square p-1 rounded-lg transition-all relative",L?"bg-brand-500/20 ring-2 ring-brand-500":"hover:bg-surface-700",b&&"bg-surface-700",O&&"opacity-50"),children:[t.jsx("span",{className:l("text-sm",b?"text-brand-400 font-bold":"text-surface-300"),children:n}),h.length>0&&t.jsxs("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 flex gap-0.5",children:[h.slice(0,3).map((P,Q)=>t.jsx("div",{className:l("w-1.5 h-1.5 rounded-full",x[P.type].color)},Q)),h.length>3&&t.jsxs("span",{className:"text-[10px] text-surface-400",children:["+",h.length-3]})]})]},n)})]}),c&&t.jsx("div",{className:"mt-6 pt-4 border-t border-surface-700",children:t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(x).map(([s,e])=>{const n=e.icon,r=p.has(s);return t.jsxs("button",{onClick:()=>K(s),className:l("flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-all",r?`${e.color}/20 ${e.textColor}`:"bg-surface-700/50 text-surface-500"),children:[t.jsx(n,{className:"w-4 h-4"}),e.label]},s)})})})]}),t.jsxs("div",{className:"space-y-6",children:[o&&t.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:[t.jsx("h3",{className:"font-medium text-white mb-3",children:ie(o)}),F.length===0?t.jsx("p",{className:"text-sm text-surface-500",children:"No events scheduled"}):t.jsx("div",{className:"space-y-2",children:F.map(s=>{const e=x[s.type],n=e.icon;return t.jsx("button",{onClick:()=>S(s),className:"w-full text-left p-2 rounded-lg bg-surface-700/50 hover:bg-surface-700 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:l("p-1 rounded",`${e.color}/20`),children:t.jsx(n,{className:l("w-4 h-4",e.textColor)})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-surface-100 truncate",children:s.title}),t.jsx("p",{className:"text-xs text-surface-500",children:e.label})]})]})},s.id)})})]}),t.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:[t.jsx("h3",{className:"font-medium text-white mb-3",children:"Upcoming (30 days)"}),E.length===0?t.jsx("p",{className:"text-sm text-surface-500",children:"No upcoming events"}):t.jsx("div",{className:"space-y-2",children:E.map(s=>{const e=x[s.type],n=e.icon,r=Math.ceil((s.date.getTime()-a.getTime())/(1e3*60*60*24));return t.jsx("button",{onClick:()=>S(s),className:"w-full text-left p-2 rounded-lg bg-surface-700/50 hover:bg-surface-700 transition-colors",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:l("p-1 rounded",`${e.color}/20`),children:t.jsx(n,{className:l("w-4 h-4",e.textColor)})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-surface-100 truncate",children:s.title}),t.jsx("p",{className:"text-xs text-surface-500",children:r===0?"Today":r===1?"Tomorrow":`In ${r} days`})]})]})},s.id)})})]})]})]})})}function ue(){return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-surface-100 flex items-center gap-3",children:[t.jsx(X,{className:"w-8 h-8 text-brand-500"}),"Compliance Calendar"]}),t.jsx("p",{className:"text-surface-400 mt-1",children:"Track policy reviews, audit deadlines, and control assessments"})]})}),t.jsx(ce,{showFilters:!0})]})}export{ue as default};
