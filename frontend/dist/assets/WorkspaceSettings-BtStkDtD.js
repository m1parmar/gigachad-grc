import{aS as I,k as R,u as E,r as o,b as S,c as h,j as e,aO as $,t as q,ce as D,h as P,aD as n}from"./vendor-CWk44mA8.js";import{c as U,d as p}from"./index-CiJwl-Bo.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const C=[{value:"owner",label:"Owner",description:"Full control of workspace"},{value:"manager",label:"Manager",description:"Can manage controls, evidence, risks"},{value:"contributor",label:"Contributor",description:"Can add evidence, update implementations"},{value:"viewer",label:"Viewer",description:"Read-only access"}];function z({isOpen:a,onClose:i,workspaceId:v,existingMemberIds:j,onSuccess:N}){const[d,u]=o.useState(""),[m,x]=o.useState("viewer"),[g,b]=o.useState(!1),{data:w=[]}=S({queryKey:["org-users"],queryFn:()=>p.get("/api/users").then(s=>s.data?.data||s.data||[]),enabled:a}),c=w.filter(s=>!j.includes(s.id)),t=async s=>{if(s.preventDefault(),!!d){b(!0);try{await p.post(`/api/workspaces/${v}/members`,{userId:d,role:m}),n.success("Member added to workspace"),N(),i(),u(""),x("viewer")}catch{n.error("Failed to add member")}finally{b(!1)}}};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Add Member"}),e.jsxs("form",{onSubmit:t,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Select User *"}),e.jsxs("select",{value:d,onChange:s=>u(s.target.value),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-brand-500",required:!0,children:[e.jsx("option",{value:"",children:"Select a user..."}),c.map(s=>e.jsxs("option",{value:s.id,children:[s.displayName||s.email," (",s.email,")"]},s.id))]}),c.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"All organization members are already in this workspace."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Role"}),e.jsx("select",{value:m,onChange:s=>x(s.target.value),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-brand-500",children:C.map(s=>e.jsxs("option",{value:s.value,children:[s.label," - ",s.description]},s.value))})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm text-muted-foreground hover:text-foreground",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!d||g,className:"px-4 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Adding...":"Add Member"})]})]})]})}):null}function L(){const{id:a}=I(),i=R(),v=E(),{updateWorkspace:j,deleteWorkspace:N}=U(),[d,u]=o.useState(""),[m,x]=o.useState(""),[g,b]=o.useState(!1),[w,c]=o.useState(!1),{data:t,isLoading:s,refetch:f}=S({queryKey:["workspace",a],queryFn:()=>p.get(`/api/workspaces/${a}`).then(r=>r.data),enabled:!!a});o.useEffect(()=>{t&&(u(t.name),x(t.description||""))},[t]);const y=h({mutationFn:r=>j(a,r),onSuccess:()=>{n.success("Workspace updated"),f()},onError:()=>{n.error("Failed to update workspace")}}),M=h({mutationFn:({userId:r,role:l})=>p.put(`/api/workspaces/${a}/members/${r}`,{role:l}),onSuccess:()=>{n.success("Member role updated"),f()},onError:()=>{n.error("Failed to update member role")}}),A=h({mutationFn:r=>p.delete(`/api/workspaces/${a}/members/${r}`),onSuccess:()=>{n.success("Member removed"),f()},onError:()=>{n.error("Failed to remove member")}}),k=h({mutationFn:()=>N(a),onSuccess:()=>{n.success("Workspace archived"),v.invalidateQueries({queryKey:["workspaces"]}),i("/settings/workspaces")},onError:()=>{n.error("Failed to archive workspace")}}),F=()=>{d.trim()&&y.mutate({name:d.trim(),description:m.trim()||void 0})};if(s)return e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-brand-500"})});if(!t)return e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Workspace not found."})});const W=t.members?.map(r=>r.userId)||[];return e.jsxs("div",{className:"p-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>i("/settings/workspaces"),className:"p-2 text-muted-foreground hover:text-foreground hover:bg-surface-800 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Workspace Settings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t.name})]})]}),e.jsxs("section",{className:"bg-surface-800 rounded-lg p-6 border border-surface-700 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Workspace Name *"}),e.jsx("input",{type:"text",value:d,onChange:r=>u(r.target.value),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Description"}),e.jsx("textarea",{value:m,onChange:r=>x(r.target.value),rows:3,className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-brand-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Slug"}),e.jsx("input",{type:"text",value:t.slug,disabled:!0,className:"w-full px-3 py-2 bg-surface-700/50 border border-surface-600 rounded-lg text-muted-foreground cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"The slug cannot be changed after creation."})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{onClick:F,disabled:y.isPending||!d.trim(),className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50",children:y.isPending?"Saving...":"Save Changes"})})]})]}),e.jsxs("section",{className:"bg-surface-800 rounded-lg p-6 border border-surface-700 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Members"}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700",children:[e.jsx(D,{className:"w-4 h-4"}),"Add Member"]})]}),e.jsxs("div",{className:"space-y-2",children:[t.members?.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-surface-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-600 flex items-center justify-center text-white text-sm font-medium",children:r.user?.firstName?.[0]||r.user?.email?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:r.user?.displayName||r.user?.email}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.user?.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:r.role,onChange:l=>M.mutate({userId:r.userId,role:l.target.value}),className:"px-2 py-1 text-sm bg-surface-700 border border-surface-600 rounded text-foreground focus:outline-none",children:C.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("button",{onClick:()=>A.mutate(r.userId),className:"p-1.5 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded",title:"Remove member",children:e.jsx(P,{className:"w-4 h-4"})})]})]},r.id)),(!t.members||t.members.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No members in this workspace."})]})]}),e.jsxs("section",{className:"bg-red-500/10 rounded-lg p-6 border border-red-500/30",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-400 mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-foreground font-medium",children:"Archive this workspace"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once archived, the workspace will be hidden but data will be preserved."})]}),e.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Archive Workspace"})]})]}),e.jsx(z,{isOpen:g,onClose:()=>b(!1),workspaceId:a,existingMemberIds:W,onSuccess:()=>f()}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Archive Workspace?"}),e.jsxs("p",{className:"text-muted-foreground mb-6",children:["Are you sure you want to archive ",e.jsx("strong",{children:t.name}),"? This workspace will be hidden but data will be preserved."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm text-muted-foreground hover:text-foreground",children:"Cancel"}),e.jsx("button",{onClick:()=>{k.mutate(),c(!1)},disabled:k.isPending,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:k.isPending?"Archiving...":"Archive Workspace"})]})]})})]})}export{L as default};
