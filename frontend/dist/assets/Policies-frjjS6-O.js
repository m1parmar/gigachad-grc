import{u as P,r,b as N,j as e,M as _,l as k,y as f,L as O,B as j,c as U,aD as y,m as w,N as I}from"./vendor-CWk44mA8.js";import{B as v,p as g}from"./index-CiJwl-Bo.js";import{a as M}from"./Skeleton-DVOICtGK.js";import{E as T}from"./ExportDropdown-ClBGGM80.js";import{e as q}from"./export-DqfI3kh9.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const C={draft:{label:"Draft",color:"badge-neutral"},in_review:{label:"In Review",color:"badge-warning"},approved:{label:"Approved",color:"badge-success"},published:{label:"Published",color:"badge-info"},retired:{label:"Retired",color:"badge-danger"}},A=[{value:"information_security",label:"Information Security"},{value:"acceptable_use",label:"Acceptable Use"},{value:"data_privacy",label:"Data Privacy"},{value:"incident_response",label:"Incident Response"},{value:"access_control",label:"Access Control"},{value:"business_continuity",label:"Business Continuity"},{value:"change_management",label:"Change Management"},{value:"risk_management",label:"Risk Management"},{value:"vendor_management",label:"Vendor Management"},{value:"other",label:"Other"}];function G(){const n=P(),[o,t]=r.useState(""),[x,l]=r.useState(!1),{data:u,isLoading:m}=N({queryKey:["policies",o],queryFn:()=>g.list({search:o||void 0}).then(a=>a.data)}),{data:d}=N({queryKey:["policies-stats"],queryFn:()=>g.getStats().then(a=>a.data)}),i=u?.data||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Policy Center"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Manage your organization's policies and track review cycles"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{data:i,columns:q.policies,filename:"policies",sheetName:"Policies",disabled:m||i.length===0}),e.jsx(v,{onClick:()=>l(!0),leftIcon:e.jsx(_,{className:"w-4 h-4"}),children:"Upload Policy"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Total Policies"}),e.jsx("p",{className:"text-2xl font-bold text-surface-100 mt-1",children:d?.total||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-400 mt-1",children:d?.approved||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400 mt-1",children:d?.inReview||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Overdue Review"}),e.jsx("p",{className:"text-2xl font-bold text-red-400 mt-1",children:d?.overdueReview||0})]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-500"}),e.jsx("input",{type:"text",placeholder:"Search policies...",value:o,onChange:a=>t(a.target.value),className:"input pl-10"})]})}),e.jsx("div",{className:"card overflow-hidden",children:m?e.jsx(M,{rows:8,columns:6,className:"border-none shadow-none"}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-surface-500",children:[e.jsx(f,{className:"w-16 h-16 mb-4"}),e.jsx("p",{className:"text-lg mb-2",children:"No policies found"}),e.jsx("p",{className:"text-sm",children:"Upload your first policy to get started"})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Policy"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Version"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Next Review"})]})}),e.jsx("tbody",{children:i.map(a=>{const h=C[a.status]||C.draft;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(O,{to:`/policies/${a.id}`,className:"flex items-center gap-3 hover:text-brand-400",children:[e.jsx("div",{className:"p-2 bg-surface-800 rounded-lg",children:e.jsx(f,{className:"w-5 h-5 text-surface-400"})}),e.jsx("span",{className:"font-medium text-surface-100",children:a.title})]})}),e.jsx("td",{children:e.jsx("span",{className:"capitalize text-surface-300",children:a.category?.replace(/_/g," ")})}),e.jsx("td",{children:e.jsxs("span",{className:"font-mono text-surface-400",children:["v",a.version]})}),e.jsx("td",{children:e.jsx("span",{className:j("badge",h.color),children:h.label})}),e.jsx("td",{children:e.jsx("span",{className:"text-surface-300",children:a.owner?.displayName||"Unassigned"})}),e.jsx("td",{children:a.nextReviewDue?e.jsx("span",{className:j("text-surface-400",new Date(a.nextReviewDue)<new Date&&"text-red-400"),children:new Date(a.nextReviewDue).toLocaleDateString()}):e.jsx("span",{className:"text-surface-500",children:"-"})})]},a.id)})})]})})}),x&&e.jsx(E,{onClose:()=>l(!1),onSuccess:()=>{n.invalidateQueries({queryKey:["policies"]}),n.invalidateQueries({queryKey:["policies-stats"]}),l(!1)}})]})}function E({onClose:n,onSuccess:o}){const[t,x]=r.useState(null),[l,u]=r.useState(""),[m,d]=r.useState(""),[i,a]=r.useState("information_security"),[h,D]=r.useState("1.0"),[S,p]=r.useState(!1),b=U({mutationFn:()=>{if(!t)throw new Error("No file selected");return g.upload(t,{title:l,description:m,type:i,version:h})},onSuccess:()=>{y.success("Policy uploaded successfully!"),o()},onError:s=>{y.error(s.message||"Failed to upload policy")}}),R=s=>{s.preventDefault(),p(!1);const c=s.dataTransfer.files[0];c&&(x(c),l||u(c.name.replace(/\.[^/.]+$/,"")))},F=s=>{const c=s.target.files?.[0];c&&(x(c),l||u(c.name.replace(/\.[^/.]+$/,"")))};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:n}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-800 rounded-xl w-full max-w-lg mx-4 p-6 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Upload Policy"}),e.jsx("button",{onClick:n,className:"text-surface-400 hover:text-surface-100",children:e.jsx(w,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:j("border-2 border-dashed rounded-lg p-8 text-center transition-colors",S?"border-brand-500 bg-brand-500/10":"border-surface-700",t&&"border-green-500 bg-green-500/10"),onDragOver:s=>{s.preventDefault(),p(!0)},onDragLeave:()=>p(!1),onDrop:R,children:t?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(f,{className:"w-8 h-8 text-green-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-surface-100 font-medium",children:t.name}),e.jsxs("p",{className:"text-surface-500 text-sm",children:[(t.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>x(null),className:"ml-2 text-surface-400 hover:text-red-400",children:e.jsx(w,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-10 h-10 text-surface-500 mx-auto mb-3"}),e.jsx("p",{className:"text-surface-300 mb-2",children:"Drag and drop a file here, or click to browse"}),e.jsx("input",{type:"file",onChange:F,className:"hidden",id:"policy-file",accept:".pdf,.doc,.docx,.txt"}),e.jsx("label",{htmlFor:"policy-file",className:"btn-outline cursor-pointer",children:"Choose File"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Title *"}),e.jsx("input",{type:"text",value:l,onChange:s=>u(s.target.value),className:"input mt-1",placeholder:"e.g., Information Security Policy",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:m,onChange:s=>d(s.target.value),className:"input mt-1",rows:2,placeholder:"Brief description of the policy..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category *"}),e.jsx("select",{value:i,onChange:s=>a(s.target.value),className:"input mt-1",children:A.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Version"}),e.jsx("input",{type:"text",value:h,onChange:s=>D(s.target.value),className:"input mt-1",placeholder:"1.0"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(v,{variant:"secondary",onClick:n,children:"Cancel"}),e.jsx(v,{onClick:()=>b.mutate(),disabled:!t||!l,isLoading:b.isPending,children:"Upload Policy"})]})]})]})}export{G as default};
