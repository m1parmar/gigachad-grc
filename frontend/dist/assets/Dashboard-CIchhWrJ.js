import{r as g,b as k,j as e,B as f,ay as X,L as N,N as ne,v as S,S as $,az as je,h as Ae,aA as Le,aB as _e,y as F,G as qe,E as Ne,t as P,aC as Ie,D as ve,A as V,k as z,M as we,u as ye,c as Ce,Q as Me,J as Oe,m as E,a7 as ke,T as ee,aD as q,am as D,aE as xe,U as Q,a1 as We,O as Ee,aa as A,H as Se,aF as Re,aG as me,ab as Pe,V as Ve,g as ze,aH as Be}from"./vendor-CWk44mA8.js";import{a as Qe,u as Ue,s as ce,b as De,c as Ke,d as Z,f as He,e as Ge,g as Fe,v as Ye,q as Je,h as Xe}from"./index-CiJwl-Bo.js";import{C as Ze}from"./RiskHeatMap-qmek_2NP.js";import{L as ae}from"./LazyCharts-CLuWtu1O.js";import{S as es}from"./Skeleton-DVOICtGK.js";import{f as ss}from"./vendor-date-CWdg4M78.js";import"./vendor-http-B9ygI19o.js";const ue={created:_e,updated:Le,deleted:Ae,viewed:je,exported:ne,approved:$,rejected:S,uploaded:ne,default:X},he={control:V,policy:F,evidence:ve,risk:S,user:Ie,vendor:P,framework:Ne,assessment:qe,default:F},fe={created:"text-emerald-400 bg-emerald-500/10",updated:"text-blue-400 bg-blue-500/10",deleted:"text-red-400 bg-red-500/10",viewed:"text-surface-400 bg-surface-500/10",exported:"text-purple-400 bg-purple-500/10",approved:"text-emerald-400 bg-emerald-500/10",rejected:"text-amber-400 bg-amber-500/10",uploaded:"text-cyan-400 bg-cyan-500/10",default:"text-surface-400 bg-surface-500/10"},ts={control:"/controls",policy:"/policies",evidence:"/evidence",risk:"/risks",vendor:"/vendors",framework:"/frameworks",assessment:"/assessments",user:"/users",audit:"/audits"};function as({limit:l=10,entityType:s,entityId:o,compact:t=!1,showHeader:i=!0,className:n}){const[a,x]=g.useState("all"),{data:m,isLoading:h,refetch:v,isRefetching:w}=k({queryKey:["audit-log",{limit:l,entityType:s,entityId:o,filter:a}],queryFn:()=>Qe.list({limit:l,entityType:s||(a!=="all"?a:void 0),entityId:o}).then(u=>u.data)}),y=m?.logs||[],b=u=>ue[u.toLowerCase()]||ue.default,r=u=>he[u.toLowerCase()]||he.default,d=u=>fe[u.toLowerCase()]||fe.default,R=(u,C)=>{const p=ts[u.toLowerCase()];return p?`${p}/${C}`:null};return h?e.jsxs("div",{className:f("bg-surface-800 rounded-xl border border-surface-700",n),children:[i&&e.jsx("div",{className:"px-4 py-3 border-b border-surface-700",children:e.jsx("div",{className:"h-5 bg-surface-700 rounded w-32 animate-pulse"})}),e.jsx("div",{className:"p-4 space-y-4",children:Array.from({length:5}).map((u,C)=>e.jsxs("div",{className:"flex items-start gap-3 animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-surface-700"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-surface-700 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-surface-700 rounded w-1/2"})]})]},C))})]}):e.jsxs("div",{className:f("bg-surface-800 rounded-xl border border-surface-700",n),children:[i&&e.jsxs("div",{className:"px-4 py-3 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-white",children:"Recent Activity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s&&e.jsxs("select",{value:a,onChange:u=>x(u.target.value),className:"text-xs bg-surface-700 border-surface-600 rounded-md text-surface-300 py-1 px-2",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"control",children:"Controls"}),e.jsx("option",{value:"policy",children:"Policies"}),e.jsx("option",{value:"evidence",children:"Evidence"}),e.jsx("option",{value:"risk",children:"Risks"}),e.jsx("option",{value:"vendor",children:"Vendors"})]}),e.jsx("button",{onClick:()=>v(),className:f("p-1.5 rounded-md hover:bg-surface-700 text-surface-400 hover:text-white transition-colors",w&&"animate-spin"),children:e.jsx(X,{className:"w-4 h-4"})})]})]}),y.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(X,{className:"w-10 h-10 mx-auto text-surface-600 mb-3"}),e.jsx("p",{className:"text-surface-400",children:"No recent activity"}),e.jsx("p",{className:"text-surface-500 text-sm mt-1",children:"Activity will appear here as changes are made"})]}):e.jsx("div",{className:f("divide-y divide-surface-700",t?"":"p-2"),children:y.map(u=>{const C=b(u.action),p=r(u.entityType),B=d(u.action),L=R(u.entityType,u.entityId);return e.jsxs("div",{className:f("flex items-start gap-3 hover:bg-surface-700/50 transition-colors",t?"py-2 px-3":"p-3 rounded-lg"),children:[e.jsx("div",{className:f("p-1.5 rounded-lg",B),children:e.jsx(C,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-surface-300 text-sm",children:u.userName||"System"}),e.jsx("span",{className:"text-surface-500 text-sm",children:u.action.toLowerCase()}),e.jsxs("div",{className:"flex items-center gap-1 text-surface-400",children:[e.jsx(p,{className:"w-3.5 h-3.5"}),L?e.jsx(N,{to:L,className:"text-sm text-brand-400 hover:text-brand-300 truncate max-w-[200px]",children:u.entityName||u.entityType}):e.jsx("span",{className:"text-sm truncate max-w-[200px]",children:u.entityName||u.entityType})]})]}),u.description&&!t&&e.jsx("p",{className:"text-surface-500 text-xs mt-1 line-clamp-2",children:u.description}),e.jsx("p",{className:"text-surface-600 text-xs mt-1",children:ss(new Date(u.createdAt),{addSuffix:!0})})]})]},u.id)})}),y.length>0&&i&&e.jsx("div",{className:"px-4 py-3 border-t border-surface-700",children:e.jsx(N,{to:"/audit-log",className:"text-sm text-brand-400 hover:text-brand-300 font-medium",children:"View all activity â†’"})})]})}function rs({className:l}){const s=z(),o=[{id:"new-control",label:"New Control",description:"Create a custom control",icon:V,action:()=>s("/controls/new"),color:"text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20"},{id:"new-risk",label:"New Risk",description:"Register a risk",icon:S,action:()=>s("/risks/new"),color:"text-amber-400 bg-amber-500/10 hover:bg-amber-500/20"},{id:"upload-evidence",label:"Upload Evidence",description:"Add evidence files",icon:ne,action:()=>s("/evidence/new"),color:"text-blue-400 bg-blue-500/10 hover:bg-blue-500/20"},{id:"new-vendor",label:"New Vendor",description:"Add a vendor",icon:P,action:()=>s("/vendors/new"),color:"text-purple-400 bg-purple-500/10 hover:bg-purple-500/20"},{id:"new-policy",label:"New Policy",description:"Create a policy",icon:F,action:()=>s("/policies/new"),color:"text-cyan-400 bg-cyan-500/10 hover:bg-cyan-500/20"}];return e.jsxs("div",{className:f("bg-surface-800 rounded-xl border border-surface-700 p-4",l),children:[e.jsxs("h3",{className:"font-medium text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-brand-400"}),"Quick Actions"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:o.map(t=>e.jsxs("button",{onClick:t.action,className:f("flex flex-col items-center p-3 rounded-lg transition-all",t.color,"border border-transparent hover:border-surface-600"),children:[e.jsx(t.icon,{className:"w-6 h-6 mb-2"}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.label}),t.shortcut&&e.jsx("span",{className:"text-xs text-surface-500 mt-1",children:t.shortcut})]},t.id))})]})}function ls({onDismiss:l}){const s=ye(),o=Ue(),[t,i]=g.useState(()=>localStorage.getItem("onboarding-banner-dismissed")==="true"),{data:n,isLoading:a}=k({queryKey:["seed-status"],queryFn:()=>ce.getStatus().then(v=>v.data)}),x=Ce({mutationFn:()=>ce.loadDemoData(),onSuccess:v=>{s.invalidateQueries({queryKey:["seed-status"]}),s.invalidateQueries(),q.success(`Demo data loaded! Created ${v.data.totalRecords} records.`),m()},onError:v=>{q.error(v.response?.data?.message||"Failed to load demo data")}}),m=()=>{i(!0),localStorage.setItem("onboarding-banner-dismissed","true"),l?.()},h=()=>{x.mutate()};return t||a||n?.hasExistingData?null:e.jsx("div",{className:"relative bg-gradient-to-r from-brand-600/20 via-purple-600/20 to-brand-600/20 border border-brand-500/30 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-500/20 rounded-lg",children:e.jsx(Me,{className:"h-6 w-6 text-brand-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground",children:["Welcome to ",o.platformName,"!"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get started with your security and compliance journey"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsx(U,{icon:V,label:"Controls",description:"50 security controls"}),e.jsx(U,{icon:F,label:"Policies",description:"15 policy templates"}),e.jsx(U,{icon:Oe,label:"Vendors",description:"20 vendor profiles"}),e.jsx(U,{icon:Ne,label:"Risks",description:"25 risk items"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 lg:w-64 flex-shrink-0",children:[e.jsx("div",{className:"flex justify-end lg:hidden",children:e.jsx("button",{onClick:m,className:"p-1 hover:bg-surface-700 rounded-lg text-muted-foreground hover:text-foreground",children:e.jsx(E,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("button",{onClick:h,disabled:x.isPending,className:"btn btn-primary flex-1 flex items-center justify-center gap-2 py-3",children:[x.isPending?e.jsx(X,{className:"h-5 w-5 animate-spin"}):e.jsx(ke,{className:"h-5 w-5"}),x.isPending?"Loading...":"Try with Demo Data"]}),e.jsx("button",{onClick:m,className:"hidden lg:flex p-2 hover:bg-surface-700 rounded-lg text-muted-foreground hover:text-foreground flex-shrink-0",title:"Dismiss",children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsxs(N,{to:"/integrations",className:"btn btn-secondary flex items-center justify-center gap-2 py-3",children:[e.jsx(ee,{className:"h-5 w-5"}),"Start from Scratch"]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Demo data can be cleared later in Settings"})]})]})})}function U({icon:l,label:s,description:o}){return e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-surface-800/50 rounded-lg",children:[e.jsx(l,{className:"h-5 w-5 text-brand-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-foreground truncate",children:s}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:o})]})]})}function ns(){const{data:l,isLoading:s}=k({queryKey:["seed-status"],queryFn:()=>ce.getStatus().then(o=>o.data),staleTime:6e4});return s||!l?.demoDataLoaded?null:e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-5 w-5 text-purple-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-purple-400",children:"Demo Mode Active"}),e.jsx("span",{className:"text-sm text-purple-400/70 ml-2",children:"This organization contains demonstration data"})]})]}),e.jsxs(N,{to:"/settings/organization",className:"flex items-center gap-1 text-sm text-purple-400 hover:text-purple-300 font-medium",children:["Clear Demo Data",e.jsx(ee,{className:"h-4 w-4"})]})]})}function cs(){const l=z(),{user:s}=De(),{isMultiWorkspaceEnabled:o,setCurrentWorkspace:t}=Ke(),{data:i,isLoading:n}=k({queryKey:["org-dashboard"],queryFn:()=>Z.get("/api/workspaces/org/dashboard").then(m=>m.data),enabled:o&&s?.role==="admin"});if(!o||s?.role!=="admin")return null;if(n)return e.jsx("div",{className:"bg-surface-800 rounded-lg border border-surface-700 p-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-5 bg-surface-700 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-12 bg-surface-700 rounded"}),e.jsx("div",{className:"h-12 bg-surface-700 rounded"})]})]})});if(!i||!i.workspaces||i.workspaces.length===0)return null;const a=[...i.workspaces].sort((m,h)=>h.complianceScore-m.complianceScore),x=m=>m>=80?"text-green-400":m>=60?"text-yellow-400":m>=40?"text-orange-400":"text-red-400";return e.jsxs("div",{className:"bg-surface-800 rounded-lg border border-surface-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-brand-400"}),e.jsx("h3",{className:"font-semibold text-foreground",children:"Workspace Comparison"})]}),e.jsxs("button",{onClick:()=>l("/settings/workspaces"),className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View All",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-px bg-surface-700",children:[e.jsxs("div",{className:"bg-surface-800 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Avg Score"}),e.jsxs("p",{className:`text-lg font-bold ${x(i.avgComplianceScore)}`,children:[i.avgComplianceScore,"%"]})]}),e.jsxs("div",{className:"bg-surface-800 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Controls"}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:i.totals.controls})]}),e.jsxs("div",{className:"bg-surface-800 p-3 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Risks"}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:i.totals.risks})]})]}),e.jsx("div",{className:"divide-y divide-surface-700",children:a.slice(0,5).map(m=>e.jsxs("button",{onClick:()=>{t({id:m.id,organizationId:"",name:m.name,slug:m.slug,status:"active",settings:{},createdAt:"",updatedAt:""}),l("/dashboard")},className:"w-full flex items-center justify-between p-3 hover:bg-surface-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-600/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-brand-400",children:m.name[0]?.toUpperCase()})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:m.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.stats.controls," controls â€¢ ",m.stats.risks," risks"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`text-sm font-medium ${x(m.complianceScore)}`,children:[m.complianceScore,"%"]}),m.complianceScore>=80&&e.jsx($,{className:"w-4 h-4 text-green-400"})]})]},m.id))}),i.workspaces.length>5&&e.jsx("div",{className:"p-3 text-center border-t border-surface-700",children:e.jsxs("button",{onClick:()=>l("/settings/workspaces"),className:"text-sm text-muted-foreground hover:text-foreground",children:["+ ",i.workspaces.length-5," more workspaces"]})})]})}function is({onDismiss:l}){const s=z(),[o,t]=g.useState(!1);g.useEffect(()=>{localStorage.getItem("grc-onboarding-dismissed")&&t(!0)},[]);const{data:i}=k({queryKey:["frameworks"],queryFn:()=>He.list().then(d=>d.data)}),{data:n}=k({queryKey:["controls-count"],queryFn:()=>Ge.list({limit:1}).then(d=>d.data)}),{data:a}=k({queryKey:["dashboard-summary"],queryFn:()=>Fe.getSummary().then(d=>d.data)}),x=(i?.length||0)>0,m=(n?.meta?.total||0)>0,h=(a?.controlStats?.implemented||0)>0,v=(a?.evidenceStats?.total||0)>0,w=[{id:"framework",title:"Select a Compliance Framework",description:"Choose the frameworks you need to comply with (e.g., SOC 2, ISO 27001)",icon:V,isComplete:x,action:()=>s("/frameworks"),actionLabel:"Browse Frameworks"},{id:"controls",title:"Review Your Controls",description:"See the controls mapped to your framework and start implementing them",icon:F,isComplete:m,action:()=>s("/controls"),actionLabel:"View Controls"},{id:"implement",title:"Implement Controls",description:"Mark controls as implemented and assign owners",icon:P,isComplete:h,action:()=>s("/controls?status=not_started"),actionLabel:"Start Implementing"},{id:"evidence",title:"Collect Evidence",description:"Upload evidence to demonstrate your control implementations",icon:F,isComplete:v,action:()=>s("/evidence"),actionLabel:"Upload Evidence"}],y=w.filter(d=>d.isComplete).length,b=Math.round(y/w.length*100),r=()=>{localStorage.setItem("grc-onboarding-dismissed","true"),t(!0),l?.()};return o?null:y===w.length?e.jsx("div",{className:"bg-green-900/30 border border-green-700 rounded-xl p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx($,{className:"h-12 w-12 text-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-400",children:"Setup Complete! ðŸŽ‰"}),e.jsx("p",{className:"text-green-300 text-sm mt-1",children:"Your GRC program is up and running. Keep monitoring your compliance dashboard for ongoing progress."})]}),e.jsx("button",{onClick:r,className:"text-green-400 hover:text-green-300",children:e.jsx(E,{className:"h-6 w-6"})})]})}):e.jsxs("div",{className:"bg-surface-800 border border-surface-700 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-surface-100",children:"Welcome to GigaChad GRC! ðŸš€"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Complete these steps to set up your compliance program"})]}),e.jsx("button",{onClick:r,className:"text-surface-400 hover:text-surface-300 p-1","aria-label":"Dismiss onboarding",children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-surface-400",children:"Setup Progress"}),e.jsxs("span",{className:"text-surface-300 font-medium",children:[y,"/",w.length," complete"]})]}),e.jsx("div",{className:"h-2 bg-surface-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500",style:{width:`${b}%`}})})]}),e.jsx("div",{className:"space-y-3",children:w.map((d,R)=>{const u=d.icon,C=!d.isComplete&&w.slice(0,R).every(p=>p.isComplete);return e.jsxs("div",{className:`
                flex items-center gap-4 p-4 rounded-lg border transition-colors
                ${d.isComplete?"bg-green-900/20 border-green-800":C?"bg-blue-900/20 border-blue-700":"bg-surface-900 border-surface-700"}
              `,children:[e.jsx("div",{className:`
                p-2 rounded-lg
                ${d.isComplete?"bg-green-800":C?"bg-blue-800":"bg-surface-700"}
              `,children:d.isComplete?e.jsx($,{className:"h-6 w-6 text-green-400"}):e.jsx(u,{className:`h-6 w-6 ${C?"text-blue-400":"text-surface-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${d.isComplete?"text-green-400":"text-surface-100"}`,children:d.title}),e.jsx("p",{className:"text-sm text-surface-400 mt-0.5",children:d.description})]}),!d.isComplete&&e.jsxs("button",{onClick:d.action,className:`
                    flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm
                    transition-colors
                    ${C?"bg-blue-600 text-white hover:bg-blue-700":"bg-surface-700 text-surface-300 hover:bg-surface-600"}
                  `,children:[d.actionLabel,e.jsx(ee,{className:"h-4 w-4"})]}),d.isComplete&&e.jsx("span",{className:"text-green-400 text-sm font-medium",children:"Complete âœ“"})]},d.id)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-surface-700",children:e.jsxs("p",{className:"text-surface-400 text-sm",children:["Need help getting started?"," ",e.jsx("button",{onClick:()=>s("/help"),className:"text-blue-400 hover:text-blue-300",children:"Visit our Help Center"})]})})]})}const os=[{id:"compliance_summary",name:"Compliance Summary",description:"Executive overview of compliance posture",requiresFramework:!1},{id:"control_status",name:"Control Status",description:"Implementation status of all controls",requiresFramework:!1},{id:"risk_register",name:"Risk Register",description:"Complete list of identified risks",requiresFramework:!1},{id:"framework_assessment",name:"Framework Assessment",description:"Assessment against a specific framework",requiresFramework:!0}];function ds({frameworkId:l,variant:s="menu",className:o=""}){const[t,i]=g.useState(null),n=async a=>{i(a);try{let x=`/api/reports/generate/${a.replace("_","-")}`;a==="framework_assessment"&&l&&(x+=`?frameworkId=${l}`);const m=await Z.get(x,{responseType:"blob"}),h=m.headers["content-disposition"];let v=`${a}-${new Date().toISOString().split("T")[0]}.pdf`;if(h){const r=h.match(/filename="(.+)"/);r&&(v=r[1])}const w=new Blob([m.data],{type:"application/pdf"}),y=window.URL.createObjectURL(w),b=document.createElement("a");b.href=y,b.download=v,document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(y),q.success("Report downloaded successfully")}catch(x){console.error("Failed to download report:",x),q.error("Failed to download report")}finally{i(null)}};return s==="button"?e.jsx("button",{onClick:()=>n("framework_assessment"),disabled:!!t||!l,className:`
          inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium
          bg-blue-600 text-white hover:bg-blue-700
          disabled:opacity-50 disabled:cursor-not-allowed
          transition-colors ${o}
        `,children:t?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-5 w-5"}),"Download Report"]})}):e.jsxs(Q,{as:"div",className:`relative inline-block text-left ${o}`,children:[e.jsxs(Q.Button,{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg font-medium bg-surface-700 text-surface-100 hover:bg-surface-600 transition-colors",children:[e.jsx(We,{className:"h-5 w-5"}),"Generate Report"]}),e.jsx(Ee,{as:g.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsx(Q.Items,{className:"absolute right-0 mt-2 w-72 origin-top-right rounded-lg bg-surface-800 border border-surface-700 shadow-lg focus:outline-none z-50",children:e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"px-3 py-2 text-xs font-medium text-surface-400 uppercase tracking-wider",children:"Download Reports"}),os.map(a=>{const x=a.requiresFramework&&!l,m=t===a.id;return e.jsx(Q.Item,{children:({active:h})=>e.jsxs("button",{onClick:()=>n(a.id),disabled:x||m,className:`
                        w-full text-left px-3 py-2 rounded-md flex items-start gap-3
                        ${h&&!x?"bg-surface-700":""}
                        ${x?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                      `,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:m?e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx(xe,{className:"h-5 w-5 text-surface-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-surface-100",children:a.name}),e.jsxs("p",{className:"text-xs text-surface-400",children:[a.description,a.requiresFramework&&!l&&e.jsx("span",{className:"block text-yellow-500 mt-1",children:"Requires framework selection"})]})]})]})},a.id)})]})})})]})}const pe={critical:"text-red-500 bg-red-500/10",high:"text-orange-500 bg-orange-500/10",medium:"text-yellow-500 bg-yellow-500/10",low:"text-green-500 bg-green-500/10"},xs={pending:A,in_progress:A,completed:$,blocked:S};function ms({limit:l=5,showCreateButton:s=!0,entityType:o,entityId:t}){const i=z(),n=ye(),{data:a,isLoading:x}=k({queryKey:["tasks",o,t],queryFn:async()=>{const r={};return o&&t&&(r.entityType=o,r.entityId=t),(await Z.get("/api/tasks/my",{params:r})).data}}),m=Ce({mutationFn:({id:r,status:d})=>Z.put(`/api/tasks/${r}`,{status:d}),onSuccess:()=>{n.invalidateQueries({queryKey:["tasks"]}),q.success("Task updated")},onError:()=>{q.error("Failed to update task")}}),h=r=>{m.mutate({id:r,status:"completed"})},v=a?.slice(0,l)||[],w=a?.filter(r=>r.status!=="completed").length||0,y=(r,d)=>{switch(r){case"control":return`/controls/${d}`;case"risk":return`/risks/${d}`;case"evidence":return`/evidence/${d}`;case"policy":return`/policies/${d}`;default:return"#"}},b=r=>{const d=new Date(r),R=new Date;return Math.ceil((d.getTime()-R.getTime())/(1e3*60*60*24))};return x?e.jsx("div",{className:"bg-surface-800 border border-surface-700 rounded-xl p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-surface-700 rounded w-1/3"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(r=>e.jsx("div",{className:"h-16 bg-surface-700 rounded"},r))})]})}):e.jsxs("div",{className:"bg-surface-800 border border-surface-700 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"Action Items"}),w>0&&e.jsxs("p",{className:"text-sm text-surface-400",children:[w," pending task",w!==1?"s":""]})]}),s&&e.jsxs("button",{onClick:()=>i("/tasks"),className:"flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300",children:["View All",e.jsx(D,{className:"h-4 w-4"})]})]}),e.jsx("div",{className:"divide-y divide-surface-700",children:v.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx($,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-surface-300 font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-surface-400 text-sm mt-1",children:"No pending action items"})]}):v.map(r=>{const d=xs[r.status]||A,R=r.dueDate&&b(r.dueDate)<0,u=r.dueDate&&b(r.dueDate)<=3&&!R;return e.jsx("div",{className:"p-4 hover:bg-surface-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>h(r.id),disabled:r.status==="completed",className:`
                      flex-shrink-0 mt-0.5 p-1 rounded-md transition-colors
                      ${r.status==="completed"?"text-green-500 cursor-default":"text-surface-400 hover:text-green-500 hover:bg-green-500/10"}
                    `,"aria-label":r.status==="completed"?"Completed":"Mark as complete",children:e.jsx(d,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("button",{onClick:()=>i(y(r.entityType,r.entityId)),className:`
                          text-left font-medium truncate
                          ${r.status==="completed"?"text-surface-400 line-through":"text-surface-100 hover:text-blue-400"}
                        `,children:r.title}),e.jsx("span",{className:`
                        flex-shrink-0 text-xs px-2 py-0.5 rounded-full font-medium
                        ${pe[r.priority]||pe.medium}
                      `,children:r.priority})]}),r.description&&e.jsx("p",{className:"text-sm text-surface-400 mt-1 line-clamp-1",children:r.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-surface-400",children:[r.dueDate&&e.jsxs("span",{className:`
                          flex items-center gap-1
                          ${R?"text-red-500":u?"text-yellow-500":""}
                        `,children:[e.jsx(A,{className:"h-3.5 w-3.5"}),R?`Overdue by ${Math.abs(b(r.dueDate))} days`:u?`Due in ${b(r.dueDate)} days`:new Date(r.dueDate).toLocaleDateString()]}),e.jsx("span",{className:"capitalize",children:r.entityType})]})]})]})},r.id)})}),a&&a.length>l&&e.jsx("div",{className:"p-4 border-t border-surface-700",children:e.jsxs("button",{onClick:()=>i("/tasks"),className:"text-sm text-blue-400 hover:text-blue-300 w-full text-center",children:["View all ",a.length," tasks"]})})]})}const us={tier_1:"Tier 1",tier_2:"Tier 2",tier_3:"Tier 3",tier_4:"Tier 4"},hs={tier_1:"bg-red-500/20 text-red-400",tier_2:"bg-orange-500/20 text-orange-400",tier_3:"bg-yellow-500/20 text-yellow-400",tier_4:"bg-green-500/20 text-green-400"};function fs({className:l}){const{data:s,isLoading:o,error:t}=k({queryKey:["vendor-reviews-due"],queryFn:()=>Ye.getReviewsDue().then(h=>h.data),staleTime:3e5,refetchOnWindowFocus:!1});if(o)return e.jsx("div",{className:f("card p-6",l),children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-surface-700 rounded w-1/3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-12 bg-surface-700 rounded"}),e.jsx("div",{className:"h-12 bg-surface-700 rounded"}),e.jsx("div",{className:"h-12 bg-surface-700 rounded"})]})]})});if(t)return e.jsx("div",{className:f("card p-6",l),children:e.jsxs("div",{className:"text-center text-surface-400",children:[e.jsx(S,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{children:"Failed to load review data"})]})});const{overdue:i,dueThisWeek:n,dueThisMonth:a,summary:x}=s||{overdue:[],dueThisWeek:[],dueThisMonth:[],summary:{overdueCount:0,dueThisWeekCount:0,dueThisMonthCount:0,upcomingCount:0}},m=x.overdueCount>0||x.dueThisWeekCount>0||x.dueThisMonthCount>0;return e.jsxs("div",{className:f("card p-6",l),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-brand-400"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Vendor Reviews Due"})]}),e.jsxs(N,{to:"/vendors",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View all ",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:f("p-3 rounded-lg text-center",x.overdueCount>0?"bg-red-500/10 border border-red-500/30":"bg-surface-800"),children:[e.jsx("p",{className:f("text-2xl font-bold",x.overdueCount>0?"text-red-400":"text-surface-300"),children:x.overdueCount}),e.jsx("p",{className:"text-xs text-surface-400",children:"Overdue"})]}),e.jsxs("div",{className:f("p-3 rounded-lg text-center",x.dueThisWeekCount>0?"bg-orange-500/10 border border-orange-500/30":"bg-surface-800"),children:[e.jsx("p",{className:f("text-2xl font-bold",x.dueThisWeekCount>0?"text-orange-400":"text-surface-300"),children:x.dueThisWeekCount}),e.jsx("p",{className:"text-xs text-surface-400",children:"This Week"})]}),e.jsxs("div",{className:f("p-3 rounded-lg text-center",x.dueThisMonthCount>0?"bg-yellow-500/10 border border-yellow-500/30":"bg-surface-800"),children:[e.jsx("p",{className:f("text-2xl font-bold",x.dueThisMonthCount>0?"text-yellow-400":"text-surface-300"),children:x.dueThisMonthCount}),e.jsx("p",{className:"text-xs text-surface-400",children:"This Month"})]})]}),m?e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[i.slice(0,3).map(h=>e.jsx(re,{vendor:h,status:"overdue",statusText:`${h.daysOverdue} days overdue`},h.id)),n.slice(0,3).map(h=>e.jsx(re,{vendor:h,status:"thisWeek",statusText:`Due in ${h.daysUntilDue} days`},h.id)),a.slice(0,2).map(h=>e.jsx(re,{vendor:h,status:"thisMonth",statusText:`Due in ${h.daysUntilDue} days`},h.id))]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(P,{className:"w-10 h-10 text-surface-600 mx-auto mb-2"}),e.jsx("p",{className:"text-surface-400 text-sm",children:"No reviews due"}),e.jsx("p",{className:"text-surface-500 text-xs mt-1",children:"All vendor reviews are up to date"})]}),x.upcomingCount>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-surface-700 text-center",children:e.jsxs("p",{className:"text-xs text-surface-400",children:[x.upcomingCount," reviews scheduled in the next 90 days"]})})]})}function re({vendor:l,status:s,statusText:o}){const t={overdue:"text-red-400",thisWeek:"text-orange-400",thisMonth:"text-yellow-400"},n={overdue:S,thisWeek:A,thisMonth:Se}[s];return e.jsxs(N,{to:`/vendors/${l.id}`,className:"flex items-center justify-between p-3 bg-surface-800/50 hover:bg-surface-700 rounded-lg transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(n,{className:f("w-4 h-4 flex-shrink-0",t[s])}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-surface-100 truncate group-hover:text-brand-400 transition-colors",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:f("text-xs px-1.5 py-0.5 rounded",hs[l.tier]||"bg-surface-700 text-surface-400"),children:us[l.tier]||l.tier}),e.jsx("span",{className:f("text-xs",t[s]),children:o})]})]})]}),e.jsx(D,{className:"w-4 h-4 text-surface-500 group-hover:text-surface-300 flex-shrink-0"})]})}function ps({className:l}){const{user:s}=De(),o=s?.organizationId||"default-org",{data:t,isLoading:i,error:n}=k({queryKey:["questionnaire-dashboard-queue",o],queryFn:async()=>(await Je.getDashboardQueue(o)).data,refetchInterval:6e4,staleTime:3e4});if(i)return e.jsx("div",{className:f("bg-surface-900 border border-surface-800 rounded-xl p-6",l),children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-surface-700 rounded w-48"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-16 bg-surface-800 rounded"}),e.jsx("div",{className:"h-16 bg-surface-800 rounded"}),e.jsx("div",{className:"h-16 bg-surface-800 rounded"})]})]})});if(n)return e.jsx("div",{className:f("bg-surface-900 border border-surface-800 rounded-xl p-6",l),children:e.jsx("p",{className:"text-red-400 text-sm",children:"Failed to load queue"})});const a=(t?.summary.overdueCount||0)+(t?.summary.dueThisWeekCount||0)+(t?.summary.highPriorityCount||0);return e.jsxs("div",{className:f("bg-surface-900 border border-surface-800 rounded-xl overflow-hidden",l),children:[e.jsxs("div",{className:"px-5 py-4 border-b border-surface-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-600/20 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-brand-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-surface-100",children:"Trust Queue"}),e.jsx("p",{className:"text-xs text-surface-400",children:"Questionnaires requiring attention"})]})]}),a>0&&e.jsx("span",{className:"flex items-center justify-center min-w-[24px] h-6 px-2 bg-red-500/20 text-red-400 text-xs font-bold rounded-full",children:a})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-px bg-surface-700",children:[e.jsx(K,{icon:S,label:"Overdue",value:t?.summary.overdueCount||0,color:"red"}),e.jsx(K,{icon:A,label:"This Week",value:t?.summary.dueThisWeekCount||0,color:"amber"}),e.jsx(K,{icon:Re,label:"Next Week",value:t?.summary.dueNextWeekCount||0,color:"blue"}),e.jsx(K,{icon:me,label:"High Priority",value:t?.summary.highPriorityCount||0,color:"orange"})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[t?.overdue&&t.overdue.length>0&&e.jsx(le,{title:"Overdue",items:t.overdue,color:"red",icon:S}),t?.dueThisWeek&&t.dueThisWeek.length>0&&e.jsx(le,{title:"Due This Week",items:t.dueThisWeek,color:"amber",icon:A}),t?.highPriority&&t.highPriority.length>0&&e.jsx(le,{title:"High Priority",items:t.highPriority,color:"orange",icon:me}),a===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(F,{className:"w-12 h-12 text-surface-600 mx-auto mb-3"}),e.jsx("p",{className:"text-surface-400 text-sm",children:"All caught up!"}),e.jsx("p",{className:"text-surface-500 text-xs mt-1",children:"No urgent questionnaires"})]})]}),e.jsx("div",{className:"px-5 py-3 border-t border-surface-800 bg-surface-800/50",children:e.jsxs(N,{to:"/questionnaires",className:"flex items-center justify-center gap-2 text-sm text-brand-400 hover:text-brand-300 transition-colors",children:["View All Questionnaires",e.jsx(ee,{className:"w-4 h-4"})]})})]})}function K({icon:l,label:s,value:o,color:t}){const i={red:"text-red-400",amber:"text-amber-400",blue:"text-blue-400",orange:"text-orange-400"};return e.jsxs("div",{className:"bg-surface-900 p-3 text-center",children:[e.jsx("div",{className:f("text-2xl font-bold",o>0?i[t]:"text-surface-500"),children:o}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs text-surface-400 mt-1",children:[e.jsx(l,{className:"w-3 h-3"}),s]})]})}function le({title:l,items:s,color:o,icon:t}){const i={red:"text-red-400 bg-red-500/10 border-red-500/30",amber:"text-amber-400 bg-amber-500/10 border-amber-500/30",blue:"text-blue-400 bg-blue-500/10 border-blue-500/30",orange:"text-orange-400 bg-orange-500/10 border-orange-500/30"},n={urgent:"bg-red-500/20 text-red-400",high:"bg-orange-500/20 text-orange-400",medium:"bg-yellow-500/20 text-yellow-400",low:"bg-surface-700 text-surface-400"};return e.jsxs("div",{className:"border-b border-surface-800 last:border-b-0",children:[e.jsxs("div",{className:f("px-4 py-2 flex items-center gap-2 text-xs font-medium border-l-2",i[o]),children:[e.jsx(t,{className:"w-3.5 h-3.5"}),l," (",s.length,")"]}),e.jsxs("div",{className:"divide-y divide-surface-800",children:[s.slice(0,3).map(a=>e.jsxs(N,{to:`/questionnaires/${a.id}`,className:"block px-4 py-3 hover:bg-surface-800/50 transition-colors group",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-surface-100 truncate",children:a.title}),e.jsx("span",{className:f("px-1.5 py-0.5 text-xs rounded capitalize",n[a.priority]||n.medium),children:a.priority})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-surface-400",children:[e.jsx("span",{children:a.requesterName}),a.company&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-surface-600",children:"â€¢"}),e.jsx("span",{children:a.company})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-surface-700 rounded-full overflow-hidden",children:e.jsx("div",{className:f("h-full transition-all",a.progress>=100?"bg-green-500":a.progress>=50?"bg-blue-500":"bg-amber-500"),style:{width:`${a.progress}%`}})}),e.jsxs("span",{className:"text-xs text-surface-500 min-w-[3rem] text-right",children:[a.answeredQuestions,"/",a.totalQuestions]})]})]}),e.jsx(D,{className:"w-4 h-4 text-surface-500 group-hover:text-surface-300 flex-shrink-0 mt-1"})]}),a.dueDate&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs",children:[e.jsx(Re,{className:"w-3 h-3"}),e.jsxs("span",{className:f(new Date(a.dueDate)<new Date?"text-red-400":"text-surface-400"),children:["Due ",new Date(a.dueDate).toLocaleDateString()]})]})]},a.id)),s.length>3&&e.jsxs("div",{className:"px-4 py-2 text-xs text-surface-500 text-center",children:["+",s.length-3," more"]})]})]})}const H={implemented:{color:"#22c55e"},in_progress:{color:"#eab308"},not_started:{color:"#6b7280"},not_applicable:{color:"#3b82f6"}},gs={implemented:H.implemented.color,in_progress:H.in_progress.color,not_started:H.not_started.color,not_applicable:H.not_applicable.color},G={draft:{color:"#6b7280"},in_review:{color:"#eab308"},approved:{color:"#3b82f6"},published:{color:"#22c55e"}},Y={published:G.published.color,approved:G.approved.color,in_review:G.in_review.color,draft:G.draft.color},ie={widgets:{statsRow:!0,alertBanner:!0,frameworkReadiness:!0,controlStatus:!0,riskHeatMap:!0,vendorReviewsDue:!0,trustQueue:!0,policyLifecycle:!0,controlsByCategory:!0,quickActions:!0,recentActivity:!0}},ge={statsRow:"Stats Cards",alertBanner:"Alert Banner",frameworkReadiness:"Framework Readiness",controlStatus:"Control Status",riskHeatMap:"Risk Heat Map",vendorReviewsDue:"Vendor Reviews Due",trustQueue:"Trust Queue",policyLifecycle:"Policy Lifecycle",controlsByCategory:"Controls by Category",quickActions:"Quick Actions",recentActivity:"Recent Activity"};function bs(){try{const l=localStorage.getItem("dashboard-config");if(l)return{...ie,...JSON.parse(l)}}catch(l){console.error("Failed to load dashboard config:",l)}return ie}function js(l){try{localStorage.setItem("dashboard-config",JSON.stringify(l))}catch(s){console.error("Failed to save dashboard config:",s)}}const be={complianceScore:{overall:0},controls:{total:0,byStatus:{},byCategory:{},overdue:0},evidence:{total:0,pendingReview:0,expiringSoon:0,expired:0}};function Fs(){const l=z(),[s,o]=g.useState(bs),[t,i]=g.useState(!1),[n,a]=g.useState(!1);g.useEffect(()=>{js(s)},[s]);const x=c=>{o(j=>({...j,widgets:{...j.widgets,[c]:!j.widgets[c]}}))},m=()=>{o(ie)},{data:h,isLoading:v,error:w}=k({queryKey:["dashboard-full"],queryFn:()=>Fe.getFull().then(c=>c.data).catch(c=>(console.error("Failed to load dashboard:",c),null)),staleTime:300*1e3,retry:1,refetchOnWindowFocus:!1}),y=h?.summary||be,b=h?.frameworks||[],r=h?.policyStats||{total:0,published:0,approved:0,inReview:0,draft:0,overdueReview:0},d=h?.riskSummary||{risks:[]},R=h?.vendorSummary||null,{data:u}=k({queryKey:["dashboards"],queryFn:()=>Xe.list().then(c=>c.data).catch(()=>[]),retry:!1,refetchOnWindowFocus:!1}),C=v,p=y||be,B=g.useMemo(()=>Array.isArray(b)?b:[],[b]),L=g.useMemo(()=>B.map(c=>({name:c.name?.replace("ISO/IEC ","").replace(" Type II","")||"Unknown",score:c.readiness?.score||0})),[B]),se=g.useMemo(()=>p.controls?.byStatus?Object.entries(p.controls.byStatus).filter(([c,j])=>j>0).map(([c,j])=>({name:c.replace(/_/g," "),value:j,color:gs[c]||"#6b7280"})):[],[p.controls?.byStatus]),te=g.useMemo(()=>[{name:"Published",value:r?.published||0,color:Y.published},{name:"Approved",value:r?.approved||0,color:Y.approved},{name:"In Review",value:r?.inReview||0,color:Y.in_review},{name:"Draft",value:r?.draft||0,color:Y.draft}].filter(c=>c.value>0),[r]),oe=g.useMemo(()=>(p.evidence?.pendingReview||0)+(p.evidence?.expiringSoon||0)+(p.controls?.overdue||0)+(r?.overdueReview||0),[p.evidence,p.controls?.overdue,r?.overdueReview]),de=g.useMemo(()=>u?.filter(c=>!c.isTemplate)||[],[u]);if(C)return e.jsx(es,{className:"animate-fade-in"});const Te=w;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[Te&&e.jsxs("div",{className:"bg-yellow-600/20 border border-yellow-600/50 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(S,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-400",children:"Some data failed to load"}),e.jsx("p",{className:"text-sm text-yellow-300/80 mt-1",children:"The dashboard is showing partial data. Some widgets may be empty or show default values."})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Dashboard"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Your compliance overview at a glance"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>a(!n),className:"btn btn-ghost btn-sm flex items-center gap-1 text-surface-400 hover:text-surface-200",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Switch Dashboard"}),e.jsx(Ve,{className:"w-4 h-4"})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsxs("div",{className:"absolute left-0 mt-2 w-64 bg-surface-800 border border-surface-700 rounded-lg shadow-xl z-20",children:[e.jsx("div",{className:"p-3 border-b border-surface-700",children:e.jsx("p",{className:"text-sm font-medium text-surface-300",children:"My Dashboards"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:de.length===0?e.jsx("div",{className:"p-3 text-sm text-surface-500",children:"No custom dashboards yet"}):de.map(c=>e.jsxs("button",{onClick:()=>{l("/dashboards"),a(!1)},className:"w-full text-left px-3 py-2 hover:bg-surface-700 flex items-center justify-between group",children:[e.jsx("span",{className:"text-sm text-surface-300 group-hover:text-surface-100",children:c.name}),c.isDefault&&e.jsx("span",{className:"text-xs text-yellow-400",children:"Default"})]},c.id))}),e.jsx("div",{className:"p-2 border-t border-surface-700",children:e.jsxs(N,{to:"/dashboards",onClick:()=>a(!1),className:"w-full btn btn-ghost btn-sm justify-start text-brand-400 hover:text-brand-300",children:[e.jsx(we,{className:"w-4 h-4 mr-1"})," Create Custom Dashboard"]})})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{}),e.jsxs("button",{onClick:()=>i(!0),className:"btn btn-secondary flex items-center gap-2",title:"Customize Dashboard",children:[e.jsx(ze,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Customize"})]})]})]}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>i(!1)}),e.jsxs("div",{className:"relative bg-surface-900 border border-surface-700 rounded-xl shadow-2xl w-full max-w-md mx-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"Customize Dashboard"}),e.jsx("button",{onClick:()=>i(!1),className:"text-surface-400 hover:text-surface-100 transition-colors",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-surface-400 mb-4",children:"Toggle widgets to show or hide them on your dashboard."}),Object.keys(ge).map(c=>e.jsxs("button",{onClick:()=>x(c),className:f("w-full flex items-center justify-between p-3 rounded-lg border transition-all",s.widgets[c]?"bg-brand-500/10 border-brand-500/30 text-surface-100":"bg-surface-800 border-surface-700 text-surface-400"),children:[e.jsx("span",{className:"font-medium",children:ge[c]}),s.widgets[c]?e.jsx(je,{className:"w-5 h-5 text-brand-400"}):e.jsx(Be,{className:"w-5 h-5 text-surface-500"})]},c))]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-surface-700",children:[e.jsx("button",{onClick:m,className:"text-sm text-surface-400 hover:text-surface-100 transition-colors",children:"Reset to Default"}),e.jsx("button",{onClick:()=>i(!1),className:"btn btn-primary",children:"Done"})]})]})]}),e.jsx(ls,{}),e.jsx(ns,{}),e.jsx(is,{}),s.widgets.statsRow&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(J,{title:"Compliance Score",value:`${p.complianceScore?.overall||0}%`,icon:V,color:"brand"}),e.jsx(J,{title:"Total Controls",value:p.controls?.total||0,icon:$,color:"green",linkTo:"/controls"}),e.jsx(J,{title:"Total Policies",value:r?.total||0,icon:F,color:"blue",linkTo:"/policies"}),e.jsx(J,{title:"Evidence Items",value:p.evidence?.total||0,icon:ve,color:"purple",linkTo:"/evidence"})]}),s.widgets.alertBanner&&oe>0&&e.jsx("div",{className:"bg-amber-50 dark:bg-yellow-500/10 border border-amber-300 dark:border-yellow-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-5 h-5 text-amber-600 dark:text-yellow-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"text-amber-700 dark:text-yellow-400 font-medium",children:[oe," items need attention:"]}),e.jsxs("span",{className:"text-gray-600 dark:text-surface-400 ml-2",children:[(p.evidence?.pendingReview??0)>0&&`${p.evidence?.pendingReview} pending review`,(p.evidence?.expiringSoon??0)>0&&`, ${p.evidence?.expiringSoon} expiring soon`,(r?.overdueReview??0)>0&&`, ${r?.overdueReview} overdue policy reviews`]})]})]})}),(s.widgets.frameworkReadiness||s.widgets.controlStatus)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.widgets.frameworkReadiness&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Framework Readiness"}),e.jsxs(N,{to:"/frameworks",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View all ",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"h-56",children:L.length>0?e.jsx(ae,{height:224,children:({BarChart:c,Bar:j,Cell:T,XAxis:I,YAxis:M,Tooltip:O,ResponsiveContainer:W})=>e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(c,{data:L,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(I,{type:"number",domain:[0,100],stroke:"#71717a",tickFormatter:_=>`${_}%`}),e.jsx(M,{type:"category",dataKey:"name",stroke:"#71717a",width:90,tick:{fill:"#a1a1aa",fontSize:11}}),e.jsx(O,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"},formatter:_=>[`${_}%`,"Readiness"]}),e.jsx(j,{dataKey:"score",radius:[0,4,4,0],children:L.map((_,$e)=>e.jsx(T,{fill:_.score>=70?"#22c55e":_.score>=40?"#eab308":"#ef4444"},`cell-${$e}`))})]})})}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-500",children:"No frameworks configured"})})]}),s.widgets.controlStatus&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Control Status"}),e.jsxs(N,{to:"/controls",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View all ",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"h-44",children:e.jsx(ae,{height:176,children:({PieChart:c,Pie:j,Cell:T,Tooltip:I,ResponsiveContainer:M})=>e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(c,{children:[e.jsx(j,{data:se,cx:"50%",cy:"50%",innerRadius:50,outerRadius:75,paddingAngle:2,dataKey:"value",children:se.map((O,W)=>e.jsx(T,{fill:O.color},`cell-${W}`))}),e.jsx(I,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}})]})})})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2",children:se.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"text-xs text-surface-400 capitalize",children:[c.name,": ",String(c.value)]})]},c.name))})]})]}),s.widgets.riskHeatMap&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Vendor Risk Summary"}),e.jsxs(N,{to:"/vendors",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View all ",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsx(vs,{data:R})]}),e.jsxs("div",{className:"card p-5 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Risk Heat Map"}),e.jsxs(N,{to:"/risks",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["View all ",e.jsx(D,{className:"w-4 h-4"})]})]}),d.risks&&d.risks.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[200px]",children:e.jsx("div",{className:"w-full max-w-[280px]",children:e.jsx(Ze,{risks:d.risks,showCounts:!0})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-surface-700",children:[e.jsxs("p",{className:"text-sm text-surface-400",children:[e.jsx("span",{className:"font-semibold text-surface-200",children:d.risks.length})," risks tracked"]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-red-400"}),e.jsx("span",{className:"text-surface-500",children:"Critical"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-orange-400"}),e.jsx("span",{className:"text-surface-500",children:"High"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-amber-400"}),e.jsx("span",{className:"text-surface-500",children:"Medium"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-emerald-400"}),e.jsx("span",{className:"text-surface-500",children:"Low"})]})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center min-h-[200px] text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-surface-700 flex items-center justify-center mb-4",children:e.jsx(S,{className:"w-8 h-8 text-surface-500"})}),e.jsx("p",{className:"text-surface-400 text-sm mb-2",children:"No risks registered yet"}),e.jsxs(N,{to:"/risks",className:"text-brand-400 text-sm hover:text-brand-300 flex items-center gap-1",children:["Add your first risk ",e.jsx(D,{className:"w-4 h-4"})]})]})]})]}),(s.widgets.policyLifecycle||s.widgets.controlsByCategory)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.widgets.policyLifecycle&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Policy Lifecycle"}),e.jsxs(N,{to:"/policies",className:"text-sm text-brand-400 hover:text-brand-300 flex items-center gap-1",children:["Manage ",e.jsx(D,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"h-44",children:e.jsx(ae,{height:176,children:({PieChart:c,Pie:j,Cell:T,Tooltip:I,ResponsiveContainer:M})=>e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(c,{children:[e.jsx(j,{data:te,cx:"50%",cy:"50%",innerRadius:50,outerRadius:75,paddingAngle:2,dataKey:"value",children:te.map((O,W)=>e.jsx(T,{fill:O.color},`cell-${W}`))}),e.jsx(I,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}})]})})})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-x-4 gap-y-2",children:te.map(c=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"text-xs text-surface-400",children:[c.name,": ",c.value]})]},c.name))})]}),s.widgets.controlsByCategory&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Controls by Category"}),e.jsx("div",{className:"space-y-3",children:Object.entries(p.controls?.byCategory||{}).sort(([,c],[,j])=>j-c).slice(0,6).map(([c,j])=>{const T=Math.round(j/(p.controls?.total||1)*100);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-surface-400 capitalize",children:c.replace(/_/g," ")}),e.jsx("span",{className:"text-sm text-surface-300",children:String(j)})]}),e.jsx("div",{className:"w-full h-1.5 bg-surface-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-500 rounded-full",style:{width:`${T}%`}})})]},c)})})]})]}),e.jsx(cs,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.widgets.vendorReviewsDue&&e.jsx(fs,{}),s.widgets.trustQueue&&e.jsx(ps,{})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ms,{limit:5}),s.widgets.quickActions&&e.jsx(rs,{})]}),s.widgets.recentActivity&&e.jsx(as,{limit:8})]})}const Ns={brand:"bg-brand-600/20 text-brand-400",green:"bg-green-600/20 text-green-400",blue:"bg-blue-600/20 text-blue-400",yellow:"bg-yellow-600/20 text-yellow-400",red:"bg-red-600/20 text-red-400",purple:"bg-purple-600/20 text-purple-400"},J=g.memo(function({title:s,value:o,icon:t,color:i,linkTo:n}){const a=e.jsx("div",{className:f("stat-card h-full",n&&"hover:border-surface-600 cursor-pointer transition-colors"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:s}),e.jsx("p",{className:"stat-value mt-1",children:o})]}),e.jsx("div",{className:f("p-2 rounded-lg",Ns[i]),children:e.jsx(t,{className:"w-5 h-5"})})]})});return n?e.jsx(N,{to:n,children:a}):a}),vs=g.memo(function({data:s}){const o=s?.recentVendors||[],t=g.useMemo(()=>({total:s?.total||0,critical:s?.byCriticality?.critical||0,high:s?.byCriticality?.high||0,medium:s?.byCriticality?.medium||0,low:s?.byCriticality?.low||0,active:s?.active||0,pendingReview:s?.pendingReview||0}),[s]),i=g.useMemo(()=>[{label:"Critical",count:t.critical,color:"bg-red-500",textColor:"text-red-400"},{label:"High",count:t.high,color:"bg-orange-500",textColor:"text-orange-400"},{label:"Medium",count:t.medium,color:"bg-yellow-500",textColor:"text-yellow-400"},{label:"Low",count:t.low,color:"bg-green-500",textColor:"text-green-400"}],[t]);return t.total===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-700 flex items-center justify-center mb-3",children:e.jsx(S,{className:"w-6 h-6 text-surface-500"})}),e.jsx("p",{className:"text-surface-400 text-sm",children:"No vendors configured yet"}),e.jsx(N,{to:"/vendors",className:"text-brand-400 text-sm mt-2 hover:text-brand-300",children:"Add your first vendor â†’"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-surface-800/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-surface-100",children:t.total}),e.jsx("p",{className:"text-xs text-surface-400",children:"Total Vendors"})]}),e.jsxs("div",{className:"text-center p-3 bg-surface-800/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:t.active}),e.jsx("p",{className:"text-xs text-surface-400",children:"Active"})]}),e.jsxs("div",{className:"text-center p-3 bg-surface-800/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:t.pendingReview}),e.jsx("p",{className:"text-xs text-surface-400",children:"Pending Review"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400 mb-2",children:"By Criticality"}),e.jsx("div",{className:"flex gap-1 h-3 rounded-full overflow-hidden bg-surface-800",children:i.map(n=>n.count>0&&e.jsx("div",{className:`${n.color} transition-all`,style:{width:`${n.count/t.total*100}%`},title:`${n.label}: ${n.count}`},n.label))}),e.jsx("div",{className:"flex justify-between mt-2",children:i.map(n=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.color}`}),e.jsxs("span",{className:"text-xs text-surface-400",children:[n.label,": ",e.jsx("span",{className:n.textColor,children:n.count})]})]},n.label))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400 mb-2",children:"Recent Vendors"}),e.jsx("div",{className:"space-y-2",children:o.slice(0,4).map(n=>e.jsxs(N,{to:`/vendors/${n.id}`,className:"flex items-center justify-between p-2 bg-surface-800/50 rounded-lg hover:bg-surface-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:f("w-2 h-2 rounded-full",n.criticality==="critical"?"bg-red-500":n.criticality==="high"?"bg-orange-500":n.criticality==="medium"?"bg-yellow-500":"bg-green-500")}),e.jsx("span",{className:"text-sm text-surface-200 truncate max-w-[180px]",children:n.name})]}),e.jsx("span",{className:f("text-xs px-2 py-0.5 rounded",n.status==="active"?"bg-green-500/20 text-green-400":n.status==="pending_review"?"bg-yellow-500/20 text-yellow-400":"bg-surface-600 text-surface-400"),children:n.status?.replace("_"," ")})]},n.id))})]})]})});export{Fs as default};
