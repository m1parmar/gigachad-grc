import{u as N,r as w,b as m,c as v,j as e,bR as y,am as k,M as C,B as l,aP as F}from"./vendor-CWk44mA8.js";import{B as o}from"./index-CiJwl-Bo.js";import{u as Q}from"./useToast-oJzujiun.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const h={critical:"bg-red-500/20 border-red-500 text-red-300",high:"bg-orange-500/20 border-orange-500 text-orange-300",medium:"bg-yellow-500/20 border-yellow-500 text-yellow-300",low:"bg-green-500/20 border-green-500 text-green-300"},R={planned:"bg-surface-700 text-surface-300",scheduled:"bg-blue-500/20 text-blue-400",in_progress:"bg-purple-500/20 text-purple-400",completed:"bg-green-500/20 text-green-400",deferred:"bg-gray-500/20 text-gray-400",cancelled:"bg-red-500/20 text-red-400"},$=["Q1","Q2","Q3","Q4"];function M(){const p=N(),f=Q(),c=new Date().getFullYear(),[r,u]=w.useState(c),d=r+2,{data:b,isLoading:j}=m({queryKey:["audit-calendar",r,d],queryFn:async()=>{const s=await fetch(`/api/audit/planning/calendar?startYear=${r}&endYear=${d}`);if(!s.ok)throw new Error("Failed to fetch calendar");return s.json()}}),{data:n}=m({queryKey:["audit-capacity",c],queryFn:async()=>{const s=await fetch(`/api/audit/planning/capacity?year=${c}`);if(!s.ok)throw new Error("Failed to fetch capacity");return s.json()}}),g=v({mutationFn:async s=>{const a=await fetch(`/api/audit/planning/${s}/convert-to-audit`,{method:"POST"});if(!a.ok)throw new Error("Failed to convert to audit");return a.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["audit-calendar"]}),f.success("Audit created from plan entry")}}),x=Array.from({length:3},(s,a)=>r+a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Audit Calendar"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Multi-year audit planning and scheduling"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>u(r-1),children:e.jsx(y,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-white font-medium",children:[r," - ",d]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>u(r+1),children:e.jsx(k,{className:"h-4 w-4"})})]}),e.jsxs(o,{children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Plan Entry"]})]})]}),n&&e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsxs("h3",{className:"text-sm font-medium text-surface-400 mb-2",children:[c," Capacity Overview"]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:$.map((s,a)=>{const i=n.hoursByQuarter?.[a+1]||0;return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:s}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[i,"h"]})]},s)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-surface-700 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-surface-400",children:["Total: ",e.jsxs("span",{className:"text-white font-medium",children:[n.totalHours,"h"]})]}),e.jsxs("span",{className:"text-surface-400",children:["Entries: ",e.jsx("span",{className:"text-white font-medium",children:n.totalEntries})]})]})]}),j?e.jsx("div",{className:"animate-pulse bg-surface-800 rounded-lg h-96"}):e.jsxs("div",{className:"bg-surface-800 rounded-lg border border-surface-700 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-3 border-b border-surface-700",children:x.map(s=>e.jsx("div",{className:"text-center py-3 text-lg font-semibold text-white border-r border-surface-700 last:border-r-0",children:s},s))}),[1,2,3,4].map(s=>e.jsx("div",{className:"grid grid-cols-3 border-b border-surface-700 last:border-b-0",children:x.map(a=>{const i=b?.[a]?.[s]||[];return e.jsxs("div",{className:"min-h-32 p-3 border-r border-surface-700 last:border-r-0",children:[e.jsxs("div",{className:"text-xs font-medium text-surface-500 mb-2",children:["Q",s]}),e.jsxs("div",{className:"space-y-2",children:[i.map(t=>e.jsxs("div",{className:l("p-2 rounded-md border text-sm cursor-pointer hover:opacity-80 transition-opacity",h[t.riskRating]||"bg-surface-700 border-surface-600 text-surface-300"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium truncate",children:t.auditName}),!t.linkedAuditId&&t.status==="planned"&&e.jsx("button",{onClick:()=>g.mutate(t.id),className:"p-1 hover:bg-white/10 rounded",title:"Convert to Audit",children:e.jsx(F,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-75",children:[e.jsx("span",{children:t.auditType}),t.framework&&e.jsxs("span",{children:["â€¢ ",t.framework]})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:l("text-xs px-1.5 py-0.5 rounded",R[t.status]),children:t.status.replace("_"," ")})})]},t.id)),i.length===0&&e.jsx("div",{className:"text-surface-600 text-sm italic text-center py-4",children:"No audits planned"})]})]},`${a}-${s}`)})},s))]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsx("span",{className:"text-surface-400",children:"Risk Rating:"}),Object.entries(h).map(([s,a])=>e.jsx("span",{className:l("px-2 py-1 rounded border",a),children:s},s))]})]})}export{M as default};
