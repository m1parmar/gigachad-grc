import{r as d,k as $,u as z,b as O,j as e,N as k,M as C,l as K,aJ as M,aD as S}from"./vendor-CWk44mA8.js";import{b as V,B as x,G as P}from"./index-CiJwl-Bo.js";import{d as Q}from"./Skeleton-DVOICtGK.js";import{E as T}from"./EmptyState-DqJSE5Oy.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";function _(){const{user:R}=V(),[f,D]=d.useState(""),[u,E]=d.useState("all"),[F,m]=d.useState(!1),[n,h]=d.useState(null),[w,j]=d.useState(!1),g=$(),A=z(),b=R?.organizationId||"",{data:v=[],isLoading:U}=O({queryKey:["knowledge-base",u,f,b],queryFn:()=>P.list({organizationId:b,category:u!=="all"?u:void 0,search:f||void 0}).then(s=>s.data),enabled:!!b}),N=s=>{const t=[];let r="",a=!1;for(let l=0;l<s.length;l++){const c=s[l];c==='"'?a=!a:c===","&&!a?(t.push(r.trim()),r=""):r+=c}return t.push(r.trim()),t},B=s=>{const t=s.trim().split(`
`),r=N(t[0]),a=[];for(let l=1;l<t.length;l++){if(!t[l].trim())continue;const c=N(t[l]),p={organizationId:"default-org"};r.forEach((o,L)=>{const i=c[L];i&&(o==="tags"?p[o]=i.split(";").map(y=>y.trim()).filter(y=>y):o==="isPublic"?p[o]=i.toLowerCase()==="true"||i==="1":p[o]=i)}),a.push(p)}return a},q=()=>{const s=`category,title,question,answer,tags,framework,status,isPublic
security,Data Encryption at Rest,Does your platform encrypt data at rest?,"Yes, all data is encrypted at rest using AES-256 encryption. We maintain strict key management practices.",encryption;data security,SOC2,approved,true
privacy,GDPR Compliance,Are you GDPR compliant?,"We are fully GDPR compliant and maintain all necessary documentation, including DPIAs and data mapping.",GDPR;privacy;compliance,GDPR,approved,true`,t=new Blob([s],{type:"text/csv"}),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="knowledge-base-template.csv",a.click(),window.URL.revokeObjectURL(r)},G=async()=>{if(n)try{j(!0);const s=await n.text(),t=B(s),a=(await P.bulkCreate({entries:t})).data;S.success(`Successfully uploaded ${a.success} entries${a.failed>0?`. Failed: ${a.failed}`:""}`),m(!1),h(null),A.invalidateQueries({queryKey:["knowledge-base"]})}catch(s){console.error("Error bulk uploading:",s),S.error("Failed to upload entries. Please check the CSV format.")}finally{j(!1)}},I=["all","security","privacy","compliance","technical","operational"];return U?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-surface-100",children:"Knowledge Base"}),e.jsx("p",{className:"mt-1 text-surface-400",children:"Pre-approved answers to common security questions"})]})}),e.jsx(Q,{count:6})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-surface-100",children:"Knowledge Base"}),e.jsx("p",{className:"mt-1 text-surface-400",children:"Pre-approved answers to common security questions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>m(!0),leftIcon:e.jsx(k,{className:"w-5 h-5"}),children:"Bulk Upload"}),e.jsx(x,{onClick:()=>g("/knowledge-base/new"),leftIcon:e.jsx(C,{className:"w-5 h-5"}),children:"New Entry"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",value:f,onChange:s=>D(s.target.value),placeholder:"Search knowledge base...",className:"w-full pl-10 pr-4 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]}),e.jsx("select",{value:u,onChange:s=>E(s.target.value),className:"px-4 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",children:I.map(s=>e.jsx("option",{value:s,children:s==="all"?"All Categories":s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),v.length===0?e.jsx(T,{variant:"book",title:"No knowledge entries yet",description:"Build your knowledge base with common questions and answers for security questionnaires.",action:{label:"New Entry",onClick:()=>g("/knowledge-base/new"),icon:e.jsx(C,{className:"w-5 h-5"})},secondaryAction:{label:"Import from CSV",onClick:()=>m(!0)}}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(s=>e.jsxs("div",{onClick:()=>g(`/knowledge-base/${s.id}`),className:"bg-surface-900 border border-surface-800 rounded-lg p-6 hover:bg-surface-800 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 flex-1",children:s.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded capitalize ${s.status==="approved"?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:s.status}),s.isPublic&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-500/20 text-blue-400 rounded",children:"Public"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded capitalize",children:s.category}),s.framework&&e.jsx("span",{className:"px-2 py-1 text-xs bg-surface-700 text-surface-300 rounded",children:s.framework}),e.jsxs("span",{className:"text-xs text-surface-500",children:["Used ",s.usageCount," times"]})]}),e.jsx("p",{className:"text-sm text-surface-400 line-clamp-2",children:s.answer})]},s.id))}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-surface-100",children:"Bulk Upload Knowledge Base Entries"}),e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-surface-700 text-surface-200 rounded-lg hover:bg-surface-600 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Download Template"]})]}),e.jsx("p",{className:"text-surface-400 mb-4",children:"Upload a CSV file with your knowledge base entries. Required columns: category, title, answer. Optional: question, tags (semicolon-separated), framework, status, isPublic."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-2",children:"CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-surface-700 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",accept:".csv",onChange:s=>h(s.target.files?.[0]||null),className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx(k,{className:"w-12 h-12 text-surface-500 mb-2"}),e.jsx("span",{className:"text-surface-300 mb-1",children:n?n.name:"Click to select CSV file"}),e.jsx("span",{className:"text-sm text-surface-500",children:"or drag and drop"})]})]})]}),e.jsxs("div",{className:"mb-4 bg-surface-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-surface-300 mb-2",children:"Example CSV Format:"}),e.jsx("pre",{className:"text-xs text-surface-400 font-mono overflow-x-auto",children:`category,title,question,answer,tags,framework,status,isPublic
security,Data Encryption at Rest,Does your platform encrypt data at rest?,"Yes, all data is encrypted at rest using AES-256 encryption. We maintain strict key management practices.",encryption;data security,SOC2,approved,true
privacy,GDPR Compliance,Are you GDPR compliant?,"We are fully GDPR compliant and maintain all necessary documentation, including DPIAs and data mapping.",GDPR;privacy;compliance,GDPR,approved,true
technical,Multi-Factor Authentication,Do you support MFA?,"Yes, we support multiple MFA methods including TOTP, SMS, and hardware tokens.",authentication;security;MFA,SOC2,approved,true`}),e.jsx("p",{className:"text-xs text-surface-500 mt-2",children:"Note: Use quotes around values containing commas. Separate multiple tags with semicolons."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>{m(!1),h(null)},disabled:w,children:"Cancel"}),e.jsx(x,{onClick:G,disabled:!n,isLoading:w,children:"Upload"})]})]})})]})}export{_ as default};
