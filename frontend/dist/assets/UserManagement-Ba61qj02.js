import{u as k,r as o,b as p,c as f,j as e,l as D,J as Q,A as E,bY as I,f as w,m as S,aD as c}from"./vendor-CWk44mA8.js";import{m as x,I as F}from"./index-CiJwl-Bo.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";function V(){const r=k(),[u,l]=o.useState(""),[m,t]=o.useState(""),[n,h]=o.useState(""),[a,d]=o.useState(null),[C,v]=o.useState(!1),[M,N]=o.useState(!1),{data:U,isLoading:q}=p({queryKey:["users",u,m,n],queryFn:()=>x.list({search:u,status:m||void 0,role:n||void 0}).then(s=>s.data)}),{data:g}=p({queryKey:["users","stats"],queryFn:()=>x.getStats().then(s=>s.data)}),{data:G}=p({queryKey:["permission-groups"],queryFn:()=>F.listGroups().then(s=>s.data)}),A=f({mutationFn:s=>x.deactivate(s),onSuccess:()=>{r.invalidateQueries({queryKey:["users"]}),c.success("User deactivated")},onError:()=>c.error("Failed to deactivate user")}),$=f({mutationFn:s=>x.reactivate(s),onSuccess:()=>{r.invalidateQueries({queryKey:["users"]}),c.success("User reactivated")},onError:()=>c.error("Failed to reactivate user")}),R=f({mutationFn:({userId:s,groupId:i})=>x.addToGroup(s,i),onSuccess:()=>{r.invalidateQueries({queryKey:["users"]}),r.invalidateQueries({queryKey:["permission-groups"]}),c.success("User added to group")},onError:()=>c.error("Failed to add user to group")}),P=f({mutationFn:({userId:s,groupId:i})=>x.removeFromGroup(s,i),onSuccess:()=>{r.invalidateQueries({queryKey:["users"]}),r.invalidateQueries({queryKey:["permission-groups"]}),c.success("User removed from group")},onError:()=>c.error("Failed to remove user from group")}),b=U?.data||[],y=G||[],K=s=>{switch(s){case"active":return"bg-emerald-500/20 text-emerald-400";case"inactive":return"bg-red-500/20 text-red-400";default:return"bg-surface-600 text-surface-300"}},L=s=>{switch(s){case"admin":return"bg-purple-500/20 text-purple-400";case"compliance_manager":return"bg-blue-500/20 text-blue-400";case"auditor":return"bg-yellow-500/20 text-yellow-400";default:return"bg-surface-600 text-surface-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Manage users, roles, and permissions"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsx("div",{className:"text-surface-400 text-sm",children:"Total Users"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-1",children:g?.total||0})]}),e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsx("div",{className:"text-surface-400 text-sm",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-400 mt-1",children:g?.active||0})]}),e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsx("div",{className:"text-surface-400 text-sm",children:"Inactive Users"}),e.jsx("div",{className:"text-2xl font-bold text-red-400 mt-1",children:g?.inactive||0})]}),e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:[e.jsx("div",{className:"text-surface-400 text-sm",children:"Permission Groups"}),e.jsx("div",{className:"text-2xl font-bold text-brand-400 mt-1",children:y.length})]})]}),e.jsx("div",{className:"bg-surface-800 rounded-lg p-4 border border-surface-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:u,onChange:s=>l(s.target.value),className:"w-full bg-surface-900 border border-surface-600 rounded-lg pl-10 pr-4 py-2 text-white placeholder:text-surface-500 focus:outline-none focus:ring-2 focus:ring-brand-500"})]})}),e.jsxs("select",{value:m,onChange:s=>t(s.target.value),className:"bg-surface-900 border border-surface-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs("select",{value:n,onChange:s=>h(s.target.value),className:"bg-surface-900 border border-surface-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"compliance_manager",children:"Compliance Manager"}),e.jsx("option",{value:"auditor",children:"Auditor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]})}),e.jsx("div",{className:"bg-surface-800 rounded-lg border border-surface-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3",children:"User"}),e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3",children:"Role"}),e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3",children:"Groups"}),e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3",children:"Last Login"}),e.jsx("th",{className:"text-right text-surface-400 font-medium px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-700",children:q?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-surface-400",children:"Loading users..."})}):b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-surface-400",children:"No users found"})}):b.map(s=>e.jsxs("tr",{className:"hover:bg-surface-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-500/20 flex items-center justify-center text-brand-400 font-medium",children:s.displayName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:s.displayName}),e.jsx("div",{className:"text-surface-400 text-sm",children:s.email})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${L(s.role)}`,children:s.role.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.groups?.length?s.groups.slice(0,2).map(i=>e.jsx("span",{className:"px-2 py-0.5 bg-surface-600 rounded text-xs text-surface-200",children:i.name},i.id)):e.jsx("span",{className:"text-surface-500 text-sm",children:"No groups"}),(s.groups?.length||0)>2&&e.jsxs("span",{className:"text-surface-400 text-xs",children:["+",(s.groups?.length||0)-2]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${K(s.status)}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-surface-400 text-sm",children:s.lastLoginAt?new Date(s.lastLoginAt).toLocaleDateString():"Never"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>{d(s),N(!0)},className:"p-2 text-surface-400 hover:text-white hover:bg-surface-700 rounded-lg transition-colors",title:"Manage Groups",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{d(s),v(!0)},className:"p-2 text-surface-400 hover:text-white hover:bg-surface-700 rounded-lg transition-colors",title:"View Permissions",children:e.jsx(E,{className:"w-5 h-5"})}),s.status==="active"?e.jsx("button",{onClick:()=>A.mutate(s.id),className:"p-2 text-surface-400 hover:text-red-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Deactivate User",children:e.jsx(I,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>$.mutate(s.id),className:"p-2 text-surface-400 hover:text-emerald-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Reactivate User",children:e.jsx(w,{className:"w-5 h-5"})})]})})]},s.id))})]})}),M&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg w-full max-w-lg mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Manage Groups - ",a.displayName]}),e.jsx("button",{onClick:()=>{N(!1),d(null)},className:"p-1 text-surface-400 hover:text-white",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"text-surface-400 text-sm",children:"Select permission groups for this user. Groups provide the initial set of permissions."}),e.jsx("div",{className:"space-y-2",children:y.map(s=>{const i=a.groups?.some(j=>j.id===s.id)||!1;return e.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${i?"bg-brand-500/20 border-brand-500":"bg-surface-700 border-surface-600 hover:border-surface-500"}`,onClick:()=>{i?(P.mutate({userId:a.id,groupId:s.id}),d({...a,groups:(a.groups||[]).filter(j=>j.id!==s.id)})):(R.mutate({userId:a.id,groupId:s.id}),d({...a,groups:[...a.groups||[],{id:s.id,name:s.name}]}))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium flex items-center gap-2",children:[s.name,s.isSystem&&e.jsx("span",{className:"text-xs bg-surface-600 text-surface-300 px-1.5 py-0.5 rounded",children:"System"})]}),e.jsx("div",{className:"text-surface-400 text-sm",children:s.description})]}),i&&e.jsx(w,{className:"w-5 h-5 text-brand-400"})]})},s.id)})})]})]})}),C&&a&&e.jsx(z,{user:a,onClose:()=>{v(!1),d(null)}})]})}function z({user:r,onClose:u}){const{data:l,isLoading:m}=p({queryKey:["user-permissions",r.id],queryFn:()=>F.getUserPermissions(r.id).then(t=>t.data)});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Permissions - ",r.displayName]}),e.jsx("button",{onClick:u,className:"p-1 text-surface-400 hover:text-white",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:m?e.jsx("div",{className:"text-center text-surface-400 py-8",children:"Loading permissions..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-300 mb-2",children:"Groups"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l?.groups?.length===0?e.jsx("span",{className:"text-surface-500",children:"No groups assigned"}):l?.groups?.map(t=>e.jsx("span",{className:"px-3 py-1 bg-surface-700 rounded-full text-sm text-white",children:t.name},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-300 mb-2",children:"Effective Permissions"}),e.jsx("div",{className:"space-y-2",children:l?.effectivePermissions?.length===0?e.jsx("span",{className:"text-surface-500",children:"No permissions"}):l?.effectivePermissions?.map((t,n)=>e.jsxs("div",{className:"bg-surface-700 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white font-medium capitalize",children:t.resource.replace("_"," ")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t.source==="group"?"bg-blue-500/20 text-blue-400":"bg-yellow-500/20 text-yellow-400"}`,children:t.source==="group"?`From: ${t.groupName}`:"Override"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.actions.map(h=>e.jsx("span",{className:"px-2 py-0.5 bg-surface-600 rounded text-xs text-surface-200",children:h},h))}),t.scope&&e.jsxs("div",{className:"mt-2 text-xs text-surface-400",children:["Scope: ",t.scope.ownership||"all",t.scope.tags?.length>0&&` | Tags: ${t.scope.tags.join(", ")}`,t.scope.categories?.length>0&&` | Categories: ${t.scope.categories.join(", ")}`]})]},n))})]}),(l?.overrides?.length??0)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-surface-300 mb-2",children:"Permission Overrides"}),e.jsx("div",{className:"space-y-1",children:l?.overrides?.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between bg-surface-700 rounded px-3 py-2",children:[e.jsx("span",{className:"text-white",children:t.permission}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t.granted?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:t.granted?"Granted":"Denied"})]},n))})]})]})})]})})}export{V as default};
