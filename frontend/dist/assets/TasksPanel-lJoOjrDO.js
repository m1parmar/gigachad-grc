import{u as E,r as f,b as k,c as b,j as e,a4 as P,aY as M,B as v,S as $,h as T,m as A,aD as p,q as K,M as U,aX as O,aC as Q,aF as I,f as L}from"./vendor-CWk44mA8.js";import{b as _,r as w,t as D,m as B}from"./index-CiJwl-Bo.js";function H({entityType:t,entityId:n}){const u=E(),{user:j}=_(),[o,h]=f.useState(""),[g,i]=f.useState(null),[l,r]=f.useState(""),{data:m=[],isLoading:x}=k({queryKey:["comments",t,n],queryFn:()=>w.list(t,n).then(s=>s.data),enabled:!!n}),d=b({mutationFn:s=>w.create({entityType:t,entityId:n,...s}),onSuccess:()=>{u.invalidateQueries({queryKey:["comments",t,n]}),h(""),i(null),r("")},onError:()=>{p.error("Failed to add comment")}}),a=b({mutationFn:({id:s,isResolved:c})=>w.update(s,{isResolved:c}),onSuccess:()=>{u.invalidateQueries({queryKey:["comments",t,n]})}}),y=b({mutationFn:s=>w.delete(s),onSuccess:()=>{u.invalidateQueries({queryKey:["comments",t,n]}),p.success("Comment deleted")},onError:()=>{p.error("Failed to delete comment")}}),R=s=>{s.preventDefault(),o.trim()&&d.mutate({content:o.trim()})},C=s=>{l.trim()&&d.mutate({content:l.trim(),parentId:s})},N=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-surface-400"}),e.jsxs("h3",{className:"text-sm font-semibold text-surface-100",children:["Comments (",m.length,")"]})]}),e.jsxs("form",{onSubmit:R,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:s=>h(s.target.value),placeholder:"Add a comment...",className:"input flex-1"}),e.jsx("button",{type:"submit",disabled:!o.trim()||d.isPending,className:"btn-primary px-3",children:e.jsx(M,{className:"w-4 h-4"})})]}),x?e.jsx("div",{className:"text-center py-4 text-surface-500",children:"Loading comments..."}):m.length===0?e.jsx("div",{className:"text-center py-4 text-surface-500 text-sm",children:"No comments yet. Be the first to comment!"}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:v("p-3 rounded-lg",s.isResolved?"bg-surface-800/50":"bg-surface-800"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-surface-200",children:s.author?.displayName||"Unknown"}),e.jsx("span",{className:"text-xs text-surface-500",children:N(s.createdAt)}),s.isResolved&&e.jsx("span",{className:"badge badge-success text-xs",children:"Resolved"})]}),e.jsx("p",{className:"text-sm text-surface-300",children:s.content})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>a.mutate({id:s.id,isResolved:!s.isResolved}),className:v("p-1 rounded hover:bg-surface-700 transition-colors",s.isResolved?"text-green-400":"text-surface-500"),title:s.isResolved?"Unresolve":"Mark as resolved",children:e.jsx($,{className:"w-4 h-4"})}),s.authorId===j?.id&&e.jsx("button",{onClick:()=>y.mutate(s.id),className:"p-1 rounded text-surface-500 hover:text-red-400 hover:bg-surface-700 transition-colors",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})]}),s.replies?.length>0&&e.jsx("div",{className:"mt-3 ml-4 pl-3 border-l-2 border-surface-700 space-y-2",children:s.replies.map(c=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-surface-300",children:c.author?.displayName||"Unknown"}),e.jsx("span",{className:"text-xs text-surface-500",children:N(c.createdAt)})]}),e.jsx("p",{className:"text-surface-400",children:c.content})]},c.id))}),g===s.id?e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:c=>r(c.target.value),placeholder:"Write a reply...",className:"input flex-1 text-sm",autoFocus:!0}),e.jsx("button",{onClick:()=>C(s.id),disabled:!l.trim(),className:"btn-primary px-2 py-1 text-sm",children:"Reply"}),e.jsx("button",{onClick:()=>{i(null),r("")},className:"p-1 text-surface-500 hover:text-surface-300",children:e.jsx(A,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:()=>i(s.id),className:"mt-2 text-xs text-surface-500 hover:text-surface-300",children:"Reply"})]},s.id))})]})}const S=[{value:"open",label:"Open",color:"text-blue-400 bg-blue-400/10"},{value:"in_progress",label:"In Progress",color:"text-yellow-400 bg-yellow-400/10"},{value:"completed",label:"Completed",color:"text-green-400 bg-green-400/10"},{value:"cancelled",label:"Cancelled",color:"text-surface-400 bg-surface-400/10"}],F=[{value:"low",label:"Low",color:"text-green-400"},{value:"medium",label:"Medium",color:"text-yellow-400"},{value:"high",label:"High",color:"text-orange-400"},{value:"critical",label:"Critical",color:"text-red-400"}];function W({entityType:t,entityId:n}){const u=E(),[j,o]=f.useState(!1),[h,g]=f.useState(null),[i,l]=f.useState({title:"",description:"",priority:"medium",assigneeId:"",dueDate:""}),{data:r=[],isLoading:m}=k({queryKey:["tasks",t,n],queryFn:()=>D.list({entityType:t,entityId:n}).then(s=>s.data),enabled:!!n}),{data:x=[]}=k({queryKey:["users"],queryFn:()=>B.list().then(s=>s.data?.data||[])}),d=b({mutationFn:s=>D.create({entityType:t,entityId:n,...s}),onSuccess:()=>{u.invalidateQueries({queryKey:["tasks",t,n]}),o(!1),l({title:"",description:"",priority:"medium",assigneeId:"",dueDate:""}),p.success("Task created")},onError:()=>{p.error("Failed to create task")}}),a=b({mutationFn:({id:s,...c})=>D.update(s,c),onSuccess:()=>{u.invalidateQueries({queryKey:["tasks",t,n]}),g(null)},onError:()=>{p.error("Failed to update task")}}),y=b({mutationFn:s=>D.delete(s),onSuccess:()=>{u.invalidateQueries({queryKey:["tasks",t,n]}),p.success("Task deleted")},onError:()=>{p.error("Failed to delete task")}}),R=s=>{s.preventDefault(),i.title.trim()&&d.mutate({title:i.title.trim(),description:i.description.trim()||void 0,priority:i.priority,assigneeId:i.assigneeId||void 0,dueDate:i.dueDate||void 0})},C=r.filter(s=>s.status==="open"||s.status==="in_progress"),N=r.filter(s=>s.status==="completed"||s.status==="cancelled");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-surface-400"}),e.jsxs("h3",{className:"text-sm font-semibold text-surface-100",children:["Tasks (",C.length," open)"]})]}),!j&&e.jsxs("button",{onClick:()=>o(!0),className:"btn-outline text-xs px-2 py-1",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Add Task"]})]}),j&&e.jsxs("form",{onSubmit:R,className:"card p-4 space-y-3",children:[e.jsx("input",{type:"text",value:i.title,onChange:s=>l({...i,title:s.target.value}),placeholder:"Task title...",className:"input w-full",autoFocus:!0}),e.jsx("textarea",{value:i.description,onChange:s=>l({...i,description:s.target.value}),placeholder:"Description (optional)",className:"input w-full h-16"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("select",{value:i.priority,onChange:s=>l({...i,priority:s.target.value}),className:"input text-sm",children:F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("select",{value:i.assigneeId,onChange:s=>l({...i,assigneeId:s.target.value}),className:"input text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),x.map(s=>e.jsx("option",{value:s.id,children:s.displayName},s.id))]}),e.jsx("input",{type:"date",value:i.dueDate,onChange:s=>l({...i,dueDate:s.target.value}),className:"input text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!i.title.trim()||d.isPending,className:"btn-primary text-sm",children:d.isPending?"Creating...":"Create Task"})]})]}),m?e.jsx("div",{className:"text-center py-4 text-surface-500",children:"Loading tasks..."}):r.length===0?e.jsx("div",{className:"text-center py-4 text-surface-500 text-sm",children:"No tasks yet. Create one to track work items."}):e.jsxs("div",{className:"space-y-2",children:[C.map(s=>e.jsx(q,{task:s,users:x,isEditing:h===s.id,onEdit:()=>g(s.id),onCancelEdit:()=>g(null),onUpdate:c=>a.mutate({id:s.id,...c}),onDelete:()=>y.mutate(s.id),isUpdating:a.isPending},s.id)),N.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsxs("summary",{className:"text-sm text-surface-500 cursor-pointer hover:text-surface-300",children:[N.length," completed task(s)"]}),e.jsx("div",{className:"mt-2 space-y-2 opacity-60",children:N.map(s=>e.jsx(q,{task:s,users:x,isEditing:!1,onEdit:()=>{},onCancelEdit:()=>{},onUpdate:()=>{},onDelete:()=>y.mutate(s.id),isUpdating:!1},s.id))})]})]})]})}function q({task:t,users:n,isEditing:u,onEdit:j,onCancelEdit:o,onUpdate:h,onDelete:g,isUpdating:i}){const[l,r]=f.useState({title:t.title,description:t.description||"",status:t.status,priority:t.priority,assigneeId:t.assigneeId||"",dueDate:t.dueDate?t.dueDate.split("T")[0]:""}),m=S.find(a=>a.value===t.status)||S[0],x=F.find(a=>a.value===t.priority)||F[1],d=t.dueDate&&new Date(t.dueDate)<new Date&&t.status!=="completed";return u?e.jsxs("div",{className:"card p-3 space-y-2",children:[e.jsx("input",{type:"text",value:l.title,onChange:a=>r({...l,title:a.target.value}),className:"input w-full text-sm"}),e.jsx("textarea",{value:l.description,onChange:a=>r({...l,description:a.target.value}),className:"input w-full h-16 text-sm",placeholder:"Description"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{value:l.status,onChange:a=>r({...l,status:a.target.value}),className:"input text-sm",children:S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("select",{value:l.priority,onChange:a=>r({...l,priority:a.target.value}),className:"input text-sm",children:F.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs("select",{value:l.assigneeId,onChange:a=>r({...l,assigneeId:a.target.value}),className:"input text-sm",children:[e.jsx("option",{value:"",children:"Unassigned"}),n.map(a=>e.jsx("option",{value:a.id,children:a.displayName},a.id))]}),e.jsx("input",{type:"date",value:l.dueDate,onChange:a=>r({...l,dueDate:a.target.value}),className:"input text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:o,className:"btn-secondary text-xs",children:"Cancel"}),e.jsx("button",{onClick:()=>h({...l,assigneeId:l.assigneeId||null,dueDate:l.dueDate||null}),disabled:i,className:"btn-primary text-xs",children:i?"Saving...":"Save"})]})]}):e.jsx("div",{className:v("card p-3 cursor-pointer hover:bg-surface-800 transition-colors",t.status==="completed"&&"opacity-60"),onClick:j,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:v("badge text-xs",m.color),children:m.label}),e.jsxs("span",{className:v("text-xs",x.color),children:[e.jsx(O,{className:"w-3 h-3 inline"})," ",x.label]})]}),e.jsx("p",{className:v("text-sm font-medium text-surface-200",t.status==="completed"&&"line-through"),children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-surface-500 mt-1 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-surface-500",children:[t.assignee&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),t.assignee.displayName]}),t.dueDate&&e.jsxs("span",{className:v("flex items-center gap-1",d&&"text-red-400"),children:[e.jsx(I,{className:"w-3 h-3"}),new Date(t.dueDate).toLocaleDateString(),d&&" (Overdue)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.status!=="completed"&&e.jsx("button",{onClick:a=>{a.stopPropagation(),h({status:"completed"})},className:"p-1 rounded text-surface-500 hover:text-green-400 hover:bg-surface-700 transition-colors",title:"Mark complete",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),g()},className:"p-1 rounded text-surface-500 hover:text-red-400 hover:bg-surface-700 transition-colors",title:"Delete",children:e.jsx(T,{className:"w-4 h-4"})})]})]})})}export{H as C,W as T};
