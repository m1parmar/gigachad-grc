import{u as B,r as u,b as F,c as C,j as e,L as A,X as k,l as K,aL as D,aD as m,B as l,S as P,az as V,aM as S,aB as R,a5 as _,aZ as O,a_ as T,A as G,V as U,am as X}from"./vendor-CWk44mA8.js";import{B as x,d as f}from"./index-CiJwl-Bo.js";import{d as Z}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const p={security:e.jsx(G,{className:"w-6 h-6"}),privacy:e.jsx(T,{className:"w-6 h-6"}),industry:e.jsx(O,{className:"w-6 h-6"}),government:e.jsx(_,{className:"w-6 h-6"})},g={security:"bg-blue-500/20 text-blue-400 border-blue-500/30",privacy:"bg-purple-500/20 text-purple-400 border-purple-500/30",industry:"bg-amber-500/20 text-amber-400 border-amber-500/30",government:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30"};function $({requirements:a,level:c=0}){const[n,i]=u.useState(new Set),d=r=>{i(o=>{const t=new Set(o);return t.has(r)?t.delete(r):t.add(r),t})};return e.jsx("div",{className:l("space-y-1",c>0&&"ml-4 border-l border-surface-700 pl-3"),children:a.map(r=>{const o=r.children&&r.children.length>0,t=n.has(r.reference);return e.jsxs("div",{children:[e.jsxs("div",{className:l("flex items-start gap-2 py-2 px-3 rounded-lg transition-colors",r.isCategory?"bg-surface-800/50 hover:bg-surface-800":"hover:bg-surface-800/30"),children:[o?e.jsx("button",{onClick:()=>d(r.reference),className:"mt-0.5 text-surface-400 hover:text-surface-200",children:t?e.jsx(U,{className:"w-4 h-4"}):e.jsx(X,{className:"w-4 h-4"})}):e.jsx("div",{className:"w-4"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:l("text-xs font-mono px-1.5 py-0.5 rounded",r.isCategory?"bg-brand-500/20 text-brand-400":"bg-surface-700 text-surface-300"),children:r.reference}),e.jsx("span",{className:l("font-medium truncate",r.isCategory?"text-surface-100":"text-surface-200"),children:r.title})]}),e.jsx("p",{className:"text-sm text-surface-400 mt-1 line-clamp-2",children:r.description})]})]}),o&&t&&e.jsx($,{requirements:r.children,level:c+1})]},r.reference)})})}function H({framework:a,onClose:c,onActivate:n,isActivating:i}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"bg-surface-900 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col shadow-2xl border border-surface-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-surface-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:l("p-3 rounded-lg border",g[a.category]||g.security),children:p[a.category]||p.security}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-surface-100",children:a.name}),e.jsxs("p",{className:"text-sm text-surface-400",children:[a.source," • Version ",a.version]})]})]}),e.jsx("button",{onClick:c,className:"p-2 text-surface-400 hover:text-surface-200 hover:bg-surface-800 rounded-lg transition-colors",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-surface-300",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("div",{className:"px-3 py-1.5 bg-surface-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-400",children:"Requirements:"}),e.jsx("span",{className:"ml-2 font-semibold text-surface-100",children:a.requirementCount})]}),e.jsxs("div",{className:"px-3 py-1.5 bg-surface-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-surface-400",children:"Categories:"}),e.jsx("span",{className:"ml-2 font-semibold text-surface-100",children:a.categoryCount})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-surface-100 mb-4",children:"Requirements Structure"}),e.jsx("div",{className:"bg-surface-800/30 rounded-lg p-4 max-h-[400px] overflow-y-auto",children:e.jsx($,{requirements:a.requirements})})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-surface-700",children:[e.jsx(x,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(x,{onClick:n,disabled:i,leftIcon:e.jsx(R,{className:"w-5 h-5"}),children:i?"Activating...":"Activate Framework"})]})]})})}function J({framework:a,onPreview:c,onActivate:n,onDeactivate:i,isActivating:d}){return e.jsxs("div",{className:l("group bg-surface-800/50 border rounded-xl p-5 transition-all duration-200",a.isActivated?"border-green-500/30 bg-green-500/5":"border-surface-700 hover:border-surface-600 hover:bg-surface-800/70"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:l("p-2.5 rounded-lg border",g[a.category]||g.security),children:p[a.category]||p.security}),a.isActivated&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-medium text-green-400 bg-green-500/10 px-2.5 py-1 rounded-full",children:[e.jsx(P,{className:"w-4 h-4"}),"Activated"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-1",children:a.name}),e.jsx("p",{className:"text-sm text-surface-400 mb-4 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-surface-400 mb-4",children:[e.jsxs("span",{children:[a.requirementCount," requirements"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[a.categoryCount," categories"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"secondary",size:"sm",onClick:c,leftIcon:e.jsx(V,{className:"w-4 h-4"}),children:"Preview"}),a.isActivated?e.jsx(x,{variant:"danger",size:"sm",onClick:i,leftIcon:e.jsx(S,{className:"w-4 h-4"}),children:"Deactivate"}):e.jsx(x,{size:"sm",onClick:n,disabled:d,leftIcon:e.jsx(R,{className:"w-4 h-4"}),children:d?"Activating...":"Activate"})]}),a.isActivated&&a.activatedFrameworkId&&e.jsx("div",{className:"mt-4 pt-4 border-t border-surface-700",children:e.jsx(A,{to:`/frameworks/${a.activatedFrameworkId}`,className:"text-sm text-brand-400 hover:text-brand-300 transition-colors",children:"View in My Frameworks →"})})]})}function te(){const a=B(),[c,n]=u.useState(""),[i,d]=u.useState("all"),[r,o]=u.useState(!1),[t,v]=u.useState(null),[w,j]=u.useState(null),{data:h,isLoading:I}=F({queryKey:["framework-catalog-status"],queryFn:()=>f.get("/api/frameworks/catalog/status").then(s=>s.data)}),{refetch:W}=F({queryKey:["framework-catalog-detail",t?.id],queryFn:()=>f.get(`/api/frameworks/catalog/${t?.id}`).then(s=>s.data),enabled:!1}),L=C({mutationFn:s=>f.post(`/api/frameworks/catalog/${s}/activate`),onSuccess:(s,y)=>{a.invalidateQueries({queryKey:["framework-catalog-status"]}),a.invalidateQueries({queryKey:["frameworks"]}),v(null),j(null),m.success("Framework activated successfully")},onError:s=>{j(null),m.error(s.response?.data?.message||"Failed to activate framework")}}),q=C({mutationFn:s=>f.delete(`/api/frameworks/catalog/${s}/deactivate`),onSuccess:()=>{a.invalidateQueries({queryKey:["framework-catalog-status"]}),a.invalidateQueries({queryKey:["frameworks"]}),m.success("Framework deactivated")},onError:s=>{m.error(s.response?.data?.message||"Failed to deactivate framework")}}),z=async s=>{try{const y=await f.get(`/api/frameworks/catalog/${s.id}`);v({...s,requirements:y.data.requirements})}catch{m.error("Failed to load framework details")}},N=s=>{j(s),L.mutate(s)},Q=s=>{confirm("Are you sure you want to deactivate this framework? Control mappings and assessments will be preserved but hidden.")&&q.mutate(s)},b=h?.filter(s=>!(c&&!s.name.toLowerCase().includes(c.toLowerCase())&&!s.description.toLowerCase().includes(c.toLowerCase())||i!=="all"&&s.category!==i||r&&!s.isActivated)),E=[...new Set(h?.map(s=>s.category)||[])],M=h?.filter(s=>s.isActivated).length||0;return I?e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Framework Library"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Browse and activate compliance frameworks for your organization"})]})}),e.jsx(Z,{count:6})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Framework Library"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Browse and activate compliance frameworks for your organization"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-surface-400",children:[M," of ",h?.length||0," frameworks activated"]}),e.jsx(A,{to:"/frameworks",children:e.jsx(x,{variant:"secondary",leftIcon:e.jsx(k,{className:"w-5 h-5"}),children:"View My Frameworks"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[250px] max-w-md",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Search frameworks...",value:c,onChange:s=>n(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 placeholder-surface-500 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-surface-400"}),e.jsxs("select",{value:i,onChange:s=>d(s.target.value),className:"px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:ring-2 focus:ring-brand-500/50",children:[e.jsx("option",{value:"all",children:"All Categories"}),E.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:s=>o(s.target.checked),className:"w-4 h-4 rounded border-surface-600 bg-surface-800 text-brand-500 focus:ring-brand-500/50"}),e.jsx("span",{className:"text-sm text-surface-300",children:"Show activated only"})]})]}),b&&b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>e.jsx(J,{framework:s,onPreview:()=>z(s),onActivate:()=>N(s.id),onDeactivate:()=>s.activatedFrameworkId&&Q(s.activatedFrameworkId),isActivating:w===s.id},s.id))}):e.jsxs("div",{className:"text-center py-16 bg-surface-800/30 rounded-xl border border-surface-700",children:[e.jsx(k,{className:"w-12 h-12 text-surface-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-surface-200 mb-2",children:"No frameworks found"}),e.jsx("p",{className:"text-surface-400",children:c||i!=="all"?"Try adjusting your search or filter criteria":"No frameworks are available in the library"})]}),t&&e.jsx(H,{framework:t,onClose:()=>v(null),onActivate:()=>N(t.id),isActivating:w===t.id})]})}export{te as default};
