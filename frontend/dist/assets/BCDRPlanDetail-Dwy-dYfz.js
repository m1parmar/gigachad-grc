import{aS as B,k as $,u as E,r as d,b as L,c as w,j as e,bT as y,aO as A,y as q,B as j,aQ as O,h as z,L as x,a8 as I,S as Q,aF as M,m as K,aD as m}from"./vendor-CWk44mA8.js";import{B as i,d as v}from"./index-CiJwl-Bo.js";import{b as H,c as _}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const b=[{value:"draft",label:"Draft",color:"bg-surface-600 text-surface-300"},{value:"in_review",label:"In Review",color:"bg-yellow-500/20 text-yellow-400"},{value:"approved",label:"Approved",color:"bg-blue-500/20 text-blue-400"},{value:"published",label:"Published",color:"bg-green-500/20 text-green-400"},{value:"archived",label:"Archived",color:"bg-surface-700 text-surface-400"}],C=[{value:"business_continuity",label:"Business Continuity"},{value:"disaster_recovery",label:"Disaster Recovery"},{value:"incident_response",label:"Incident Response"},{value:"crisis_communication",label:"Crisis Communication"},{value:"pandemic_response",label:"Pandemic Response"},{value:"it_recovery",label:"IT Recovery"},{value:"data_backup",label:"Data Backup"},{value:"other",label:"Other"}];function W(){const{id:r}=B(),u=$(),p=E(),[D,o]=d.useState(!1),[k,N]=d.useState(!1),[n,S]=d.useState("overview"),[c,l]=d.useState({title:"",description:"",plan_type:"business_continuity",status:"draft",objectives:"",scope:"",assumptions:"",activation_criteria:"",deactivation_criteria:""}),{data:a,isLoading:R,error:P}=L({queryKey:["bcdr-plan",r],queryFn:async()=>(await v.get(`/api/bcdr/plans/${r}`)).data,enabled:!!r});d.useEffect(()=>{a&&l({title:a.title||"",description:a.description||"",plan_type:a.plan_type||"business_continuity",status:a.status||"draft",objectives:a.objectives||"",scope:a.scope||"",assumptions:a.assumptions||"",activation_criteria:a.activation_criteria||"",deactivation_criteria:a.deactivation_criteria||""})},[a]);const h=w({mutationFn:async s=>(await v.patch(`/api/bcdr/plans/${r}`,s)).data,onSuccess:()=>{p.invalidateQueries({queryKey:["bcdr-plan",r]}),p.invalidateQueries({queryKey:["bcdr-plans"]}),o(!1),m.success("BC/DR plan updated successfully")},onError:()=>{m.error("Failed to update BC/DR plan")}}),f=w({mutationFn:async()=>{await v.delete(`/api/bcdr/plans/${r}`)},onSuccess:()=>{p.invalidateQueries({queryKey:["bcdr-plans"]}),m.success("BC/DR plan deleted"),u("/bcdr/plans")},onError:()=>{m.error("Failed to delete BC/DR plan")}}),F=s=>b.find(t=>t.value===s)||b[0],T=s=>C.find(t=>t.value===s)?.label||s;if(R)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(H,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(_,{})}),e.jsx("div",{children:e.jsx(_,{})})]})]});if(P||!a)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-4 text-red-400"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-2",children:"BC/DR Plan Not Found"}),e.jsx("p",{className:"text-surface-400 mb-4",children:"The requested plan could not be loaded."}),e.jsx(i,{onClick:()=>u("/bcdr/plans"),children:"Back to Plans"})]})});const g=F(a.status);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>u("/bcdr/plans"),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400 mt-1",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(q,{className:"w-8 h-8 text-brand-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:a.title}),e.jsxs("p",{className:"text-surface-400 text-sm",children:[a.plan_id," â€¢ v",a.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:j("px-3 py-1 rounded-full text-sm font-medium",g.color),children:g.label}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-surface-700 text-surface-300",children:T(a.plan_type)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"secondary",onClick:()=>o(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(i,{variant:"danger",onClick:()=>N(!0),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx("div",{className:"border-b border-surface-700",children:e.jsx("nav",{className:"flex gap-6",children:["overview","processes","tests","controls"].map(s=>e.jsx("button",{onClick:()=>S(s),className:j("pb-3 px-1 text-sm font-medium border-b-2 transition-colors capitalize",n===s?"border-brand-500 text-brand-400":"border-transparent text-surface-400 hover:text-surface-200"),children:s},s))})}),n==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Description"}),e.jsx("p",{className:"text-surface-300",children:a.description||"No description provided."})]}),a.objectives&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Objectives"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:a.objectives})]}),a.scope&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Scope"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:a.scope})]}),(a.activation_criteria||a.deactivation_criteria)&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Activation Criteria"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.activation_criteria&&e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm mb-2",children:"Activation Criteria"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:a.activation_criteria})]}),a.deactivation_criteria&&e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm mb-2",children:"Deactivation Criteria"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:a.deactivation_criteria})]})]})]}),a.assumptions&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Assumptions"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:a.assumptions})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Owner"}),e.jsx("p",{className:"text-surface-100",children:a.owner_name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Effective Date"}),e.jsx("p",{className:"text-surface-100",children:a.effective_date?new Date(a.effective_date).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Next Review"}),e.jsx("p",{className:"text-surface-100",children:a.next_review_due?new Date(a.next_review_due).toLocaleDateString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Last Reviewed"}),e.jsx("p",{className:"text-surface-100",children:a.last_reviewed_at?new Date(a.last_reviewed_at).toLocaleDateString():"Never"})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"In-Scope Processes"}),e.jsx("span",{className:"text-surface-100",children:a.in_scope_processes?.length||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"DR Tests"}),e.jsx("span",{className:"text-surface-100",children:a.dr_tests?.length||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"Linked Controls"}),e.jsx("span",{className:"text-surface-100",children:a.linked_controls?.length||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"Communication Plans"}),e.jsx("span",{className:"text-surface-100",children:a.communication_plans?.length||0})]})]})]})]})]}),n==="processes"&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"In-Scope Business Processes"}),a.in_scope_processes&&a.in_scope_processes.length>0?e.jsx("div",{className:"space-y-2",children:a.in_scope_processes.map(s=>e.jsxs(x,{to:`/bcdr/processes/${s.id}`,className:"flex items-center justify-between p-4 rounded-lg bg-surface-800/50 hover:bg-surface-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-surface-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-100 font-medium",children:s.name}),e.jsx("p",{className:"text-surface-400 text-sm",children:s.process_id})]})]}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-surface-700 text-surface-300 capitalize",children:s.criticality_tier?.replace("_"," ")})]},s.id))}):e.jsx("p",{className:"text-surface-400 text-center py-8",children:"No processes in scope"})]}),n==="tests"&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"DR Tests"}),e.jsx(x,{to:"/bcdr/tests/new",className:"btn btn-secondary btn-sm",children:"Schedule Test"})]}),a.dr_tests&&a.dr_tests.length>0?e.jsx("div",{className:"space-y-2",children:a.dr_tests.map(s=>e.jsxs(x,{to:`/bcdr/tests/${s.id}`,className:"flex items-center justify-between p-4 rounded-lg bg-surface-800/50 hover:bg-surface-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.result==="passed"?e.jsx(Q,{className:"w-5 h-5 text-green-400"}):s.result==="failed"?e.jsx(y,{className:"w-5 h-5 text-red-400"}):e.jsx(M,{className:"w-5 h-5 text-surface-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-100 font-medium",children:s.name}),e.jsx("p",{className:"text-surface-400 text-sm",children:s.scheduled_date?new Date(s.scheduled_date).toLocaleDateString():"Not scheduled"})]})]}),e.jsx("span",{className:j("px-2 py-1 rounded text-xs font-medium capitalize",s.status==="completed"?"bg-green-500/20 text-green-400":s.status==="in_progress"?"bg-yellow-500/20 text-yellow-400":"bg-surface-700 text-surface-300"),children:s.status?.replace("_"," ")})]},s.id))}):e.jsx("p",{className:"text-surface-400 text-center py-8",children:"No DR tests scheduled"})]}),n==="controls"&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Linked Controls"}),a.linked_controls&&a.linked_controls.length>0?e.jsx("div",{className:"space-y-2",children:a.linked_controls.map(s=>e.jsx(x,{to:`/controls/${s.id}`,className:"flex items-center justify-between p-4 rounded-lg bg-surface-800/50 hover:bg-surface-700/50 transition-colors",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-100 font-medium",children:s.title}),e.jsx("p",{className:"text-surface-400 text-sm",children:s.control_id})]})},s.id))}):e.jsx("p",{className:"text-surface-400 text-center py-8",children:"No controls linked"})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Edit BC/DR Plan"}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),h.mutate(c)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:c.title,onChange:s=>l(t=>({...t,title:s.target.value})),required:!0,className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Plan Type"}),e.jsx("select",{value:c.plan_type,onChange:s=>l(t=>({...t,plan_type:s.target.value})),className:"input w-full",children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Status"}),e.jsx("select",{value:c.status,onChange:s=>l(t=>({...t,status:s.target.value})),className:"input w-full",children:b.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Description"}),e.jsx("textarea",{value:c.description,onChange:s=>l(t=>({...t,description:s.target.value})),rows:3,className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Objectives"}),e.jsx("textarea",{value:c.objectives,onChange:s=>l(t=>({...t,objectives:s.target.value})),rows:3,className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Scope"}),e.jsx("textarea",{value:c.scope,onChange:s=>l(t=>({...t,scope:s.target.value})),rows:3,className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Activation Criteria"}),e.jsx("textarea",{value:c.activation_criteria,onChange:s=>l(t=>({...t,activation_criteria:s.target.value})),rows:2,className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Deactivation Criteria"}),e.jsx("textarea",{value:c.deactivation_criteria,onChange:s=>l(t=>({...t,deactivation_criteria:s.target.value})),rows:2,className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Assumptions"}),e.jsx("textarea",{value:c.assumptions,onChange:s=>l(t=>({...t,assumptions:s.target.value})),rows:2,className:"input w-full"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx(i,{variant:"secondary",type:"button",onClick:()=>o(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:h.isPending,children:h.isPending?"Saving...":"Save Changes"})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete BC/DR Plan"}),e.jsxs("p",{className:"text-surface-400 mb-6",children:['Are you sure you want to delete "',a.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(i,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(i,{variant:"danger",onClick:()=>f.mutate(),disabled:f.isPending,children:f.isPending?"Deleting...":"Delete"})]})]})})]})}export{W as default};
