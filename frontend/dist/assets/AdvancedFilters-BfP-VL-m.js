import{u as M,r as c,j as e,B as C,V as Y,aL as A,m as w,b9 as _,M as G,f as H,h as W}from"./vendor-CWk44mA8.js";import{e as V,x as P,f as T,p as Q,l as X,v as R,g as Z,B as j}from"./index-CiJwl-Bo.js";function re(){const t=M(),d=c.useCallback(r=>{t.prefetchQuery({queryKey:["control",r],queryFn:()=>V.get(r).then(x=>x.data),staleTime:60*1e3})},[t]),l=c.useCallback(r=>{t.prefetchQuery({queryKey:["risk",r],queryFn:()=>P.get(r).then(x=>x.data),staleTime:60*1e3})},[t]),u=c.useCallback(r=>{t.prefetchQuery({queryKey:["framework",r],queryFn:()=>T.get(r).then(x=>x.data),staleTime:300*1e3})},[t]),a=c.useCallback(r=>{t.prefetchQuery({queryKey:["policy",r],queryFn:()=>Q.get(r).then(x=>x.data),staleTime:60*1e3})},[t]),n=c.useCallback(r=>{t.prefetchQuery({queryKey:["evidence",r],queryFn:()=>X.get(r).then(x=>x.data),staleTime:60*1e3})},[t]),o=c.useCallback(r=>{t.prefetchQuery({queryKey:["vendor",r],queryFn:()=>R.get(r).then(x=>x.data),staleTime:60*1e3})},[t]),h=c.useCallback(()=>{t.prefetchQuery({queryKey:["controls","","","",""],queryFn:()=>V.list({limit:25}).then(r=>r.data),staleTime:30*1e3})},[t]),f=c.useCallback(()=>{t.prefetchQuery({queryKey:["risks",{},null],queryFn:()=>P.list({limit:25}).then(r=>r.data),staleTime:30*1e3})},[t]),i=c.useCallback(()=>{t.prefetchQuery({queryKey:["dashboard-summary"],queryFn:()=>Z.getSummary().then(r=>r.data),staleTime:60*1e3})},[t]),v=c.useCallback(()=>{t.prefetchQuery({queryKey:["frameworks"],queryFn:()=>T.list().then(r=>r.data),staleTime:300*1e3})},[t]),b=c.useCallback(()=>{t.prefetchQuery({queryKey:["policies"],queryFn:()=>Q.list({limit:25}).then(r=>r.data),staleTime:30*1e3})},[t]),m=c.useCallback(()=>{t.prefetchQuery({queryKey:["vendors",""],queryFn:()=>R.list({limit:25}).then(r=>r.data),staleTime:30*1e3})},[t]);return{prefetchControl:d,prefetchRisk:l,prefetchFramework:u,prefetchPolicy:a,prefetchEvidence:n,prefetchVendor:o,prefetchControlsList:h,prefetchRisksList:f,prefetchDashboard:i,prefetchFrameworks:v,prefetchPolicies:b,prefetchVendors:m}}const k={equals:{label:"equals",requiresValue:!0,types:["string","number","date","select","boolean"]},not_equals:{label:"does not equal",requiresValue:!0,types:["string","number","date","select","boolean"]},contains:{label:"contains",requiresValue:!0,types:["string"]},not_contains:{label:"does not contain",requiresValue:!0,types:["string"]},starts_with:{label:"starts with",requiresValue:!0,types:["string"]},ends_with:{label:"ends with",requiresValue:!0,types:["string"]},greater_than:{label:"greater than",requiresValue:!0,types:["number","date"]},less_than:{label:"less than",requiresValue:!0,types:["number","date"]},between:{label:"between",requiresValue:!0,types:["number","date"]},in:{label:"is any of",requiresValue:!0,types:["select","multi_select"]},not_in:{label:"is none of",requiresValue:!0,types:["select","multi_select"]},is_empty:{label:"is empty",requiresValue:!1,types:["string","select","multi_select"]},is_not_empty:{label:"is not empty",requiresValue:!1,types:["string","select","multi_select"]}},O=()=>Math.random().toString(36).substr(2,9);function ae({fields:t,onApply:d,storageKey:l,className:u}){const[a,n]=c.useState(!1),[o,h]=c.useState([]),[f,i]=c.useState([]),[v,b]=c.useState(!1),[m,r]=c.useState(""),[x,g]=c.useState(null);c.useEffect(()=>{if(l){const s=localStorage.getItem(`filters_${l}`);if(s)try{i(JSON.parse(s))}catch(p){console.error("Failed to load filter presets:",p)}}},[l]);const F=c.useCallback(s=>{l&&localStorage.setItem(`filters_${l}`,JSON.stringify(s)),i(s)},[l]),$=()=>{const s={id:O(),field:t[0]?.key||"",operator:"equals",value:""};h([...o,s]),g(null)},E=(s,p)=>{h(o.map(y=>y.id===s?{...y,...p}:y)),g(null)},K=s=>{h(o.filter(p=>p.id!==s)),g(null)},z=()=>{h([]),g(null),d([])},B=()=>{d(o),n(!1)},S=()=>{if(!m.trim())return;const s={id:O(),name:m.trim(),conditions:[...o],createdAt:new Date().toISOString()};F([...f,s]),r(""),b(!1),g(s.id)},D=s=>{h([...s.conditions]),g(s.id)},I=s=>{F(f.filter(p=>p.id!==s)),x===s&&g(null)},L=s=>t.find(p=>p.key===s),J=s=>{const p=L(s);return p?Object.entries(k).filter(([y,q])=>q.types.includes(p.type)).map(([y,q])=>({value:y,label:q.label})):[]},N=o.length;return e.jsxs("div",{className:C("relative",u),children:[e.jsx(j,{variant:N>0?"primary":"secondary",onClick:()=>n(!a),leftIcon:e.jsx(A,{className:"w-4 h-4"}),rightIcon:N>0?e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-xs bg-white/20 rounded-full",children:N}):e.jsx(Y,{className:C("w-4 h-4 transition-transform",a&&"rotate-180")}),children:"Filters"}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-[480px] bg-surface-800 border border-surface-700 rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-white",children:"Advanced Filters"}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.length>0&&e.jsx("button",{onClick:z,className:"text-sm text-surface-400 hover:text-surface-200",children:"Clear all"}),e.jsx("button",{onClick:()=>n(!1),className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(w,{className:"w-5 h-5 text-surface-400"})})]})]}),f.length>0&&e.jsxs("div",{className:"p-3 border-b border-surface-700 bg-surface-800/50",children:[e.jsx("p",{className:"text-xs text-surface-500 mb-2",children:"Saved Filters"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(s=>e.jsxs("div",{className:C("group flex items-center gap-1 px-2 py-1 rounded-lg text-sm cursor-pointer",x===s.id?"bg-brand-500/20 text-brand-400":"bg-surface-700 text-surface-300 hover:bg-surface-600"),onClick:()=>D(s),children:[e.jsx(_,{className:"w-3 h-3"}),s.name,e.jsx("button",{onClick:p=>{p.stopPropagation(),I(s.id)},className:"ml-1 opacity-0 group-hover:opacity-100 hover:text-red-400",children:e.jsx(w,{className:"w-3 h-3"})})]},s.id))})]}),e.jsxs("div",{className:"p-4 space-y-3 max-h-[400px] overflow-y-auto",children:[o.length===0?e.jsxs("div",{className:"text-center py-8 text-surface-500",children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No filters applied"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Filter" to get started'})]}):o.map((s,p)=>e.jsx(U,{condition:s,fields:t,operators:J(s.field),onUpdate:y=>E(s.id,y),onRemove:()=>K(s.id),showAndLabel:p>0},s.id)),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-3 py-2 text-sm text-brand-400 hover:text-brand-300 hover:bg-surface-700 rounded-lg w-full",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Filter"]})]}),e.jsx("div",{className:"p-4 border-t border-surface-700 flex items-center justify-between",children:v?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"text",value:m,onChange:s=>r(s.target.value),placeholder:"Filter name...",className:"flex-1 px-3 py-1.5 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white placeholder-surface-500",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&S()}),e.jsx(j,{size:"sm",onClick:S,disabled:!m.trim(),children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>b(!1),children:e.jsx(w,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>b(!0),disabled:o.length===0,leftIcon:e.jsx(_,{className:"w-4 h-4"}),children:"Save Filter"}),e.jsx(j,{onClick:B,disabled:o.length===0,children:"Apply Filters"})]})})]})]})]})}function U({condition:t,fields:d,operators:l,onUpdate:u,onRemove:a,showAndLabel:n}){const o=d.find(i=>i.key===t.field),h=k[t.operator],f=i=>{const v=d.find(m=>m.key===i),b=Object.entries(k).filter(([m,r])=>r.types.includes(v?.type||"string")).map(([m])=>m);u({field:i,operator:b.includes(t.operator)?t.operator:b[0],value:""})};return e.jsxs("div",{className:"space-y-2",children:[n&&e.jsx("span",{className:"text-xs text-surface-500 font-medium",children:"AND"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:t.field,onChange:i=>f(i.target.value),className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white",children:d.map(i=>e.jsx("option",{value:i.key,children:i.label},i.key))}),e.jsx("select",{value:t.operator,onChange:i=>u({operator:i.target.value,value:""}),className:"w-36 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white",children:l.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),h?.requiresValue&&e.jsx(ee,{field:o,operator:t.operator,value:t.value,onChange:i=>u({value:i})}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400 hover:text-red-400",children:e.jsx(W,{className:"w-4 h-4"})})]})]})}function ee({field:t,operator:d,value:l,onChange:u}){if(!t)return null;if(t.type==="boolean")return e.jsxs("select",{value:String(l||""),onChange:a=>u(a.target.value==="true"),className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]});if((t.type==="select"||t.type==="multi_select")&&t.options)if(d==="in"||d==="not_in"){const a=Array.isArray(l)?l:[];return e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-wrap gap-1 p-2 bg-surface-700 border border-surface-600 rounded-lg min-h-[38px]",children:[a.map(n=>{const o=t.options?.find(h=>h.value===n);return e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-brand-500/20 text-brand-400 rounded text-xs",children:[o?.label||n,e.jsx("button",{onClick:()=>u(a.filter(h=>h!==n)),className:"hover:text-brand-300",children:e.jsx(w,{className:"w-3 h-3"})})]},n)}),e.jsxs("select",{value:"",onChange:n=>{n.target.value&&!a.includes(n.target.value)&&u([...a,n.target.value])},className:"flex-1 min-w-[100px] bg-transparent text-sm text-white outline-none",children:[e.jsx("option",{value:"",children:"Add..."}),t.options.filter(n=>!a.includes(n.value)).map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]})]})})}else return e.jsxs("select",{value:String(l||""),onChange:a=>u(a.target.value),className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white",children:[e.jsx("option",{value:"",children:"Select..."}),t.options.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]});return t.type==="date"?e.jsx("input",{type:"date",value:String(l||""),onChange:a=>u(a.target.value),className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white"}):t.type==="number"?e.jsx("input",{type:"number",value:String(l||""),onChange:a=>u(a.target.value?Number(a.target.value):null),placeholder:"Enter value...",className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white placeholder-surface-500"}):e.jsx("input",{type:"text",value:String(l||""),onChange:a=>u(a.target.value),placeholder:"Enter value...",className:"flex-1 px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-sm text-white placeholder-surface-500"})}function le(t){const d={};return t.forEach(l=>{const u=l.field,a=Array.isArray(l.value)?l.value.join(","):String(l.value||"");l.operator==="equals"?d[u]=a:l.operator==="contains"?d[`${u}_contains`]=a:l.operator==="in"&&(d[`${u}_in`]=a)}),d}export{ae as A,le as c,re as u};
