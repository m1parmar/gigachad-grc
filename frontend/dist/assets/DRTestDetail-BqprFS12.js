import{aS as U,k as H,u as V,r as d,b as W,c as _,j as e,bT as G,aO as J,a7 as X,B as r,S as L,aQ as Z,h as ee,L as se,M as T,aC as k,aF as te,m as F,v as P,aM as ae,aD as x}from"./vendor-CWk44mA8.js";import{B as l,d as b}from"./index-CiJwl-Bo.js";import{b as le,c as E}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const C=[{value:"planned",label:"Planned",color:"bg-surface-600 text-surface-300"},{value:"scheduled",label:"Scheduled",color:"bg-blue-500/20 text-blue-400"},{value:"in_progress",label:"In Progress",color:"bg-yellow-500/20 text-yellow-400"},{value:"completed",label:"Completed",color:"bg-green-500/20 text-green-400"},{value:"cancelled",label:"Cancelled",color:"bg-red-500/20 text-red-400"},{value:"postponed",label:"Postponed",color:"bg-orange-500/20 text-orange-400"}],$=[{value:"passed",label:"Passed",color:"text-green-400",icon:L},{value:"passed_with_issues",label:"Passed with Issues",color:"text-yellow-400",icon:P},{value:"failed",label:"Failed",color:"text-red-400",icon:ae},{value:"incomplete",label:"Incomplete",color:"text-surface-400",icon:P}],A=[{value:"tabletop",label:"Tabletop Exercise"},{value:"walkthrough",label:"Walkthrough"},{value:"simulation",label:"Simulation"},{value:"parallel",label:"Parallel Test"},{value:"full_interruption",label:"Full Interruption"}],re={critical:"bg-red-500/20 text-red-400",high:"bg-orange-500/20 text-orange-400",medium:"bg-yellow-500/20 text-yellow-400",low:"bg-blue-500/20 text-blue-400"};function xe(){const{id:c}=U(),v=H(),u=V(),[M,m]=d.useState(!1),[O,S]=d.useState(!1),[q,p]=d.useState(!1),[h,I]=d.useState("overview"),[n,i]=d.useState({name:"",description:"",test_type:"tabletop",status:"planned",objectives:"",scope:""}),[f,g]=d.useState({result:"passed",actual_recovery_time_minutes:0,lessons_learned:""}),{data:t,isLoading:z,error:Q}=W({queryKey:["dr-test",c],queryFn:async()=>(await b.get(`/api/bcdr/tests/${c}`)).data,enabled:!!c});d.useEffect(()=>{t&&i({name:t.name||"",description:t.description||"",test_type:t.test_type||"tabletop",status:t.status||"planned",objectives:t.objectives||"",scope:t.scope||""})},[t]);const N=_({mutationFn:async s=>(await b.patch(`/api/bcdr/tests/${c}`,s)).data,onSuccess:()=>{u.invalidateQueries({queryKey:["dr-test",c]}),u.invalidateQueries({queryKey:["dr-tests"]}),m(!1),x.success("DR test updated successfully")},onError:()=>{x.error("Failed to update DR test")}}),y=_({mutationFn:async s=>(await b.post(`/api/bcdr/tests/${c}/complete`,{...s,status:"completed",actual_end_at:new Date().toISOString()})).data,onSuccess:()=>{u.invalidateQueries({queryKey:["dr-test",c]}),u.invalidateQueries({queryKey:["dr-tests"]}),p(!1),x.success("DR test completed")},onError:()=>{x.error("Failed to complete DR test")}}),w=_({mutationFn:async()=>{await b.delete(`/api/bcdr/tests/${c}`)},onSuccess:()=>{u.invalidateQueries({queryKey:["dr-tests"]}),x.success("DR test deleted"),v("/bcdr/tests")},onError:()=>{x.error("Failed to delete DR test")}}),K=s=>C.find(a=>a.value===s)||C[0],B=s=>$.find(a=>a.value===s),Y=s=>A.find(a=>a.value===s)?.label||s;if(z)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(le,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(E,{})}),e.jsx("div",{children:e.jsx(E,{})})]})]});if(Q||!t)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-red-400"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-2",children:"DR Test Not Found"}),e.jsx("p",{className:"text-surface-400 mb-4",children:"The requested test could not be loaded."}),e.jsx(l,{onClick:()=>v("/bcdr/tests"),children:"Back to Tests"})]})});const D=K(t.status),j=t.result?B(t.result):null,R=j?.icon,o=t.target_rto_minutes&&t.actual_recovery_time_minutes?t.actual_recovery_time_minutes<=t.target_rto_minutes:null;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>v("/bcdr/tests"),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400 mt-1",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(X,{className:"w-8 h-8 text-purple-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:t.name}),e.jsx("p",{className:"text-surface-400 text-sm",children:t.test_id})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:r("px-3 py-1 rounded-full text-sm font-medium",D.color),children:D.label}),j&&R&&e.jsxs("span",{className:r("flex items-center gap-1",j.color),children:[e.jsx(R,{className:"w-5 h-5"}),j.label]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-surface-700 text-surface-300",children:Y(t.test_type)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.status!=="completed"&&t.status!=="cancelled"&&e.jsxs(l,{variant:"success",onClick:()=>p(!0),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Complete Test"]}),e.jsxs(l,{variant:"secondary",onClick:()=>m(!0),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(l,{variant:"danger",onClick:()=>S(!0),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx("div",{className:"border-b border-surface-700",children:e.jsx("nav",{className:"flex gap-6",children:["overview","findings","participants"].map(s=>e.jsxs("button",{onClick:()=>I(s),className:r("pb-3 px-1 text-sm font-medium border-b-2 transition-colors capitalize",h===s?"border-brand-500 text-brand-400":"border-transparent text-surface-400 hover:text-surface-200"),children:[s,s==="findings"&&t.findings?.length>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 text-xs",children:t.findings.length})]},s))})}),h==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Description"}),e.jsx("p",{className:"text-surface-300",children:t.description||"No description provided."})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Recovery Metrics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-surface-800/50",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Target RTO"}),e.jsx("p",{className:"text-2xl font-bold text-surface-100",children:t.target_rto_minutes?`${t.target_rto_minutes}m`:"N/A"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-surface-800/50",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Actual Recovery Time"}),e.jsx("p",{className:r("text-2xl font-bold",o===!0?"text-green-400":o===!1?"text-red-400":"text-surface-100"),children:t.actual_recovery_time_minutes?`${t.actual_recovery_time_minutes}m`:"N/A"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-surface-800/50",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"RTO Met"}),e.jsx("p",{className:r("text-2xl font-bold",o===!0?"text-green-400":o===!1?"text-red-400":"text-surface-100"),children:o===null?"N/A":o?"Yes":"No"})]})]})]}),t.objectives&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Objectives"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:t.objectives})]}),t.lessons_learned&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Lessons Learned"}),e.jsx("p",{className:"text-surface-300 whitespace-pre-wrap",children:t.lessons_learned})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Coordinator"}),e.jsx("p",{className:"text-surface-100",children:t.coordinator_name||"-"})]}),t.plan_title&&e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"BC/DR Plan"}),e.jsx(se,{to:`/bcdr/plans/${t.bcdr_plan_id}`,className:"text-brand-400 hover:text-brand-300",children:t.plan_title})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Scheduled Date"}),e.jsx("p",{className:"text-surface-100",children:t.scheduled_date?new Date(t.scheduled_date).toLocaleString():"-"})]}),t.actual_start_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Actual Start"}),e.jsx("p",{className:"text-surface-100",children:new Date(t.actual_start_at).toLocaleString()})]}),t.actual_end_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Actual End"}),e.jsx("p",{className:"text-surface-100",children:new Date(t.actual_end_at).toLocaleString()})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"Findings"}),e.jsx("span",{className:r(t.findings?.length>0?"text-yellow-400":"text-surface-100"),children:t.findings?.length||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-400",children:"Participants"}),e.jsx("span",{className:"text-surface-100",children:t.participants?.length||0})]})]})]})]})]}),h==="findings"&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"Test Findings"}),e.jsxs(l,{variant:"secondary",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Add Finding"]})]}),t.findings&&t.findings.length>0?e.jsx("div",{className:"space-y-3",children:t.findings.map(s=>e.jsxs("div",{className:"p-4 rounded-lg bg-surface-800/50 border border-surface-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"text-surface-100 font-medium",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:r("px-2 py-0.5 rounded text-xs font-medium capitalize",re[s.severity]||"bg-surface-700 text-surface-300"),children:s.severity}),e.jsx("span",{className:r("px-2 py-0.5 rounded text-xs font-medium capitalize",s.remediation_status==="resolved"?"bg-green-500/20 text-green-400":s.remediation_status==="in_progress"?"bg-yellow-500/20 text-yellow-400":"bg-surface-700 text-surface-300"),children:s.remediation_status?.replace("_"," ")})]})]}),e.jsx("p",{className:"text-surface-400 text-sm mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-surface-500",children:[s.assigned_to_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4"}),s.assigned_to_name]}),s.remediation_due_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4"}),"Due: ",new Date(s.remediation_due_date).toLocaleDateString()]})]})]},s.id))}):e.jsx("p",{className:"text-surface-400 text-center py-8",children:"No findings recorded"})]}),h==="participants"&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"Test Participants"}),e.jsxs(l,{variant:"secondary",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Add Participant"]})]}),t.participants&&t.participants.length>0?e.jsx("div",{className:"space-y-2",children:t.participants.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-surface-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-surface-700 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-surface-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-100 font-medium",children:s.user_name}),e.jsx("p",{className:"text-surface-400 text-sm",children:s.role})]})]}),e.jsx("span",{className:r("px-2 py-1 rounded text-xs font-medium",s.attended?"bg-green-500/20 text-green-400":"bg-surface-700 text-surface-400"),children:s.attended?"Attended":"Not Attended"})]},s.id))}):e.jsx("p",{className:"text-surface-400 text-center py-8",children:"No participants added"})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Edit DR Test"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(F,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),N.mutate(n)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>i(a=>({...a,name:s.target.value})),required:!0,className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Test Type"}),e.jsx("select",{value:n.test_type,onChange:s=>i(a=>({...a,test_type:s.target.value})),className:"input w-full",children:A.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Status"}),e.jsx("select",{value:n.status,onChange:s=>i(a=>({...a,status:s.target.value})),className:"input w-full",children:C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>i(a=>({...a,description:s.target.value})),rows:3,className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Objectives"}),e.jsx("textarea",{value:n.objectives,onChange:s=>i(a=>({...a,objectives:s.target.value})),rows:3,className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Scope"}),e.jsx("textarea",{value:n.scope,onChange:s=>i(a=>({...a,scope:s.target.value})),rows:2,className:"input w-full"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx(l,{variant:"secondary",type:"button",onClick:()=>m(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:N.isPending,children:N.isPending?"Saving...":"Save Changes"})]})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-6 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Complete DR Test"}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(F,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y.mutate(f)},className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Result *"}),e.jsx("select",{value:f.result,onChange:s=>g(a=>({...a,result:s.target.value})),className:"input w-full",children:$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Actual Recovery Time (minutes)"}),e.jsx("input",{type:"number",value:f.actual_recovery_time_minutes,onChange:s=>g(a=>({...a,actual_recovery_time_minutes:parseInt(s.target.value)||0})),min:"0",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Lessons Learned"}),e.jsx("textarea",{value:f.lessons_learned,onChange:s=>g(a=>({...a,lessons_learned:s.target.value})),rows:4,className:"input w-full",placeholder:"Document key takeaways from this test..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx(l,{variant:"secondary",type:"button",onClick:()=>p(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:y.isPending,children:y.isPending?"Completing...":"Complete Test"})]})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete DR Test"}),e.jsxs("p",{className:"text-surface-400 mb-6",children:['Are you sure you want to delete "',t.name,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{variant:"secondary",onClick:()=>S(!1),children:"Cancel"}),e.jsx(l,{variant:"danger",onClick:()=>w.mutate(),disabled:w.isPending,children:w.isPending?"Deleting...":"Delete"})]})]})})]})}export{xe as default};
