import{r as n,b,j as e,bT as D,L as m,M as L,l as $,ay as k,a7 as A,v as g,aM as M,S as q,B as v}from"./vendor-CWk44mA8.js";import{d as w}from"./index-CiJwl-Bo.js";import{u as E}from"./useDebounce-BWtFJvQ9.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const I={planned:"bg-surface-600 text-surface-300",scheduled:"bg-blue-500/20 text-blue-400",in_progress:"bg-yellow-500/20 text-yellow-400",completed:"bg-green-500/20 text-green-400",cancelled:"bg-red-500/20 text-red-400",postponed:"bg-orange-500/20 text-orange-400"},y={passed:{bg:"text-green-400",icon:q},passed_with_issues:{bg:"text-yellow-400",icon:g},failed:{bg:"text-red-400",icon:M},incomplete:{bg:"text-surface-400",icon:g}},_={tabletop:"Tabletop Exercise",walkthrough:"Walkthrough",simulation:"Simulation",parallel:"Parallel Test",full_interruption:"Full Interruption"};function U(){const[u,S]=n.useState(""),[a,F]=n.useState(""),[l,R]=n.useState(""),[r,x]=n.useState(1),d=E(u,300);n.useEffect(()=>{x(1)},[d,a,l]);const{data:p,isLoading:T,error:h,refetch:f}=b({queryKey:["dr-tests",d,a,l,r],queryFn:async()=>{const s=new URLSearchParams;return d&&s.append("search",d),a&&s.append("testType",a),l&&s.append("status",l),s.append("page",r.toString()),s.append("limit","25"),(await w.get(`/api/bcdr/tests?${s}`)).data},retry:1}),{data:t,isLoading:i}=b({queryKey:["dr-tests-stats"],queryFn:async()=>(await w.get("/api/bcdr/tests/stats")).data,staleTime:3e4}),j=p?.data||[],o=p?.totalPages||1,N=Number(t?.completed_count)||0,C=Number(t?.passed_count)||0,P=N>0?Math.round(C/N*100):0;return h?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(D,{className:"w-12 h-12 mx-auto mb-4 text-red-400"}),e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-2",children:"Failed to load DR Tests"}),e.jsx("p",{className:"text-surface-400 mb-4",children:h.message||"An unexpected error occurred"}),e.jsx("button",{onClick:()=>f(),className:"btn btn-primary",children:"Try Again"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"DR Tests"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Schedule and track disaster recovery tests"})]}),e.jsxs(m,{to:"/bcdr/tests/new",className:"btn btn-primary",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Schedule Test"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Total Tests"}),i?e.jsx("div",{className:"h-8 w-16 bg-surface-700 rounded animate-pulse mt-1"}):e.jsx("p",{className:"text-2xl font-bold text-surface-100",children:t?.total||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Pass Rate"}),i?e.jsx("div",{className:"h-8 w-16 bg-surface-700 rounded animate-pulse mt-1"}):e.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[P,"%"]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Open Findings"}),i?e.jsx("div",{className:"h-8 w-16 bg-surface-700 rounded animate-pulse mt-1"}):e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:t?.openFindingsCount||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-surface-400 text-sm",children:"Avg Recovery Time"}),i?e.jsx("div",{className:"h-8 w-16 bg-surface-700 rounded animate-pulse mt-1"}):e.jsx("p",{className:"text-2xl font-bold text-surface-100",children:t?.avg_recovery_time?`${Math.round(Number(t.avg_recovery_time))}m`:"N/A"})]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Search tests...",className:"form-input pl-10 w-full",value:u,onChange:s=>S(s.target.value)})]})}),e.jsx("div",{className:"w-40",children:e.jsxs("select",{className:"form-select w-full",value:a,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),Object.entries(_).map(([s,c])=>e.jsx("option",{value:s,children:c},s))]})}),e.jsx("div",{className:"w-36",children:e.jsxs("select",{className:"form-select w-full",value:l,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),e.jsx("button",{onClick:()=>f(),className:"btn btn-secondary",children:e.jsx(k,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"card overflow-hidden",children:[T?e.jsx("div",{className:"p-8 text-center text-surface-400",children:"Loading..."}):j.length===0?e.jsxs("div",{className:"p-8 text-center text-surface-400",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No DR tests found"}),e.jsx(m,{to:"/bcdr/tests/new",className:"text-brand-400 hover:text-brand-300 mt-2 inline-block",children:"Schedule your first test â†’"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Test"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Result"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Date"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Findings"}),e.jsx("th",{className:"text-left p-4 text-surface-300 font-medium",children:"Coordinator"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-700",children:j.map(s=>{const c=s.result?y[s.result]?.icon:null;return e.jsxs("tr",{className:"hover:bg-surface-800/30 transition-colors",children:[e.jsxs("td",{className:"p-4",children:[e.jsx(m,{to:`/bcdr/tests/${s.id}`,className:"text-surface-100 font-medium hover:text-brand-400 transition-colors",children:s.name}),e.jsx("div",{className:"text-surface-400 text-sm",children:s.test_id}),s.plan_title&&e.jsxs("div",{className:"text-surface-500 text-xs mt-1",children:["Plan: ",s.plan_title]})]}),e.jsx("td",{className:"p-4 text-surface-300 text-sm",children:_[s.test_type]||s.test_type}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:v("px-2 py-1 rounded-full text-xs font-medium",I[s.status]),children:s.status.replace("_"," ")})}),e.jsx("td",{className:"p-4",children:s.result?e.jsxs("div",{className:v("flex items-center gap-1",y[s.result]?.bg),children:[c&&e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm capitalize",children:s.result.replace("_"," ")})]}):e.jsx("span",{className:"text-surface-500 text-sm",children:"-"})}),e.jsx("td",{className:"p-4 text-surface-300 text-sm",children:s.actual_end_at?new Date(s.actual_end_at).toLocaleDateString():s.scheduled_date?new Date(s.scheduled_date).toLocaleDateString():"-"}),e.jsx("td",{className:"p-4",children:s.finding_count>0?e.jsxs("span",{className:"px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-400 text-xs font-medium",children:[s.finding_count," findings"]}):e.jsx("span",{className:"text-surface-500 text-sm",children:"-"})}),e.jsx("td",{className:"p-4 text-surface-300 text-sm",children:s.coordinator_name||"-"})]},s.id)})})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-surface-700",children:[e.jsx("button",{onClick:()=>x(s=>Math.max(1,s-1)),disabled:r===1,className:"btn btn-secondary btn-sm",children:"Previous"}),e.jsxs("span",{className:"text-surface-400 text-sm",children:["Page ",r," of ",o]}),e.jsx("button",{onClick:()=>x(s=>Math.min(o,s+1)),disabled:r===o,className:"btn btn-secondary btn-sm",children:"Next"})]})]})]})}export{U as default};
