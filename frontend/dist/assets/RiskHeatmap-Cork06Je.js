const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-CWk44mA8.js","assets/vendor-C9-ySRfk.css"])))=>i.map(i=>d[i]);
import{k as q,r as x,b as I,an as w,j as e,bo as K,bu as V,bv as W,bw as B,bi as U,bx as X}from"./vendor-CWk44mA8.js";import{x as D}from"./index-CiJwl-Bo.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const F=["rare","unlikely","possible","likely","almost_certain"],P=["negligible","minor","moderate","major","severe"],S={rare:"Rare",unlikely:"Unlikely",possible:"Possible",likely:"Likely",almost_certain:"Almost Certain"},T={negligible:"Negligible",minor:"Minor",moderate:"Moderate",major:"Major",severe:"Severe"};function Y(o,c){const d=(o+1)*(c+1);return d>=16?"critical":d>=9?"high":d>=4?"medium":"low"}function Q(o,c){switch(Y(o,c)){case"critical":return"bg-red-500/40 hover:bg-red-500/60";case"high":return"bg-orange-500/40 hover:bg-orange-500/60";case"medium":return"bg-amber-500/40 hover:bg-amber-500/60";case"low":return"bg-emerald-500/40 hover:bg-emerald-500/60";default:return"bg-surface-700 hover:bg-surface-600"}}function te(){const o=q(),[c,d]=x.useState(null),[b,f]=x.useState(!1),[j,p]=x.useState(!1),m=x.useRef(null),{data:$,isLoading:M}=I({queryKey:["risks","heatmap"],queryFn:async()=>(await D.getHeatmap()).data}),{data:i}=I({queryKey:["risks","dashboard"],queryFn:async()=>(await D.getDashboard()).data}),y=new Map;$?.matrix.forEach(s=>{y.set(`${s.likelihood}-${s.impact}`,s)});const H=(s,n)=>y.get(`${s}-${n}`),A=x.useCallback(async()=>{if(m.current){f(!0),p(!1);try{const s=(await w(async()=>{const{default:u}=await import("./vendor-CWk44mA8.js").then(r=>r.ci);return{default:u}},__vite__mapDeps([0,1]))).default,n=await s(m.current,{backgroundColor:"#1f2937",scale:2,logging:!1}),a=document.createElement("a");a.download=`risk-heatmap-${new Date().toISOString().split("T")[0]}.png`,a.href=n.toDataURL("image/png"),a.click()}catch(s){console.error("Failed to export PNG:",s),alert("Failed to export heatmap as PNG. Please try again.")}finally{f(!1)}}},[]),O=x.useCallback(async()=>{if(m.current){f(!0),p(!1);try{const[s,{jsPDF:n}]=await Promise.all([w(()=>import("./vendor-CWk44mA8.js").then(l=>l.ci),__vite__mapDeps([0,1])).then(l=>l.default),w(()=>import("./vendor-CWk44mA8.js").then(l=>l.cj),__vite__mapDeps([0,1]))]),a=await s(m.current,{backgroundColor:"#1f2937",scale:2,logging:!1}),u=a.toDataURL("image/png"),r=a.width,g=a.height,h=297,k=210,C=Math.min((h-20)/r,(k-40)/g),t=new n({orientation:"landscape",unit:"mm",format:"a4"});t.setFontSize(18),t.setTextColor(255,255,255),t.setFillColor(31,41,55),t.rect(0,0,h,k,"F"),t.setTextColor(255,255,255),t.text("Risk Heatmap",10,15),t.setFontSize(10),t.setTextColor(156,163,175),t.text(`Generated: ${new Date().toLocaleString()}`,10,22);const L=r*C,_=g*C,z=(h-L)/2;t.addImage(u,"PNG",z,28,L,_);const N=28+_+5;t.setFontSize(9),t.setTextColor(255,255,255);const G=[{color:"#10b981",label:"Low Risk"},{color:"#f59e0b",label:"Medium Risk"},{color:"#f97316",label:"High Risk"},{color:"#ef4444",label:"Critical Risk"}];let v=10;if(G.forEach(l=>{t.setFillColor(l.color),t.rect(v,N,4,4,"F"),t.text(l.label,v+6,N+3),v+=35}),i){t.setFontSize(8),t.setTextColor(156,163,175);const l=N+10;t.text(`Total Risks: ${i.totalRisks||0}`,10,l);let R=60;i.byRiskLevel?.forEach(E=>{t.text(`${E.level}: ${E.count}`,R,l),R+=30})}t.save(`risk-heatmap-${new Date().toISOString().split("T")[0]}.pdf`)}catch(s){console.error("Failed to export PDF:",s),alert("Failed to export heatmap as PDF. Please try again.")}finally{f(!1)}}},[i]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>o("/risks"),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Risk Heatmap"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Visual distribution of risks by likelihood and impact"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>p(!j),disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg transition-colors disabled:opacity-50",children:[b?e.jsx(V,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]}),j&&!b&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-surface-800 border border-surface-700 rounded-lg shadow-xl z-10",children:[e.jsxs("button",{onClick:A,className:"w-full flex items-center gap-3 px-4 py-3 text-left text-surface-300 hover:bg-surface-700 transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Export as PNG"}),e.jsx("div",{className:"text-xs text-surface-500",children:"High-resolution image"})]})]}),e.jsxs("button",{onClick:O,className:"w-full flex items-center gap-3 px-4 py-3 text-left text-surface-300 hover:bg-surface-700 transition-colors border-t border-surface-700",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Export as PDF"}),e.jsx("div",{className:"text-xs text-surface-500",children:"With metadata & legend"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-surface-800 rounded-xl border border-surface-700 p-6",children:M?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"text-surface-400",children:"Loading heatmap..."})}):e.jsxs("div",{ref:m,className:"space-y-4 p-4","data-export":"true",children:[e.jsxs("div",{className:"flex items-center justify-end gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-emerald-500/40 rounded"}),e.jsx("span",{className:"text-surface-400",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-amber-500/40 rounded"}),e.jsx("span",{className:"text-surface-400",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-500/40 rounded"}),e.jsx("span",{className:"text-surface-400",children:"High"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500/40 rounded"}),e.jsx("span",{className:"text-surface-400",children:"Critical"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 top-1/2 -translate-y-1/2 -rotate-90 text-surface-400 text-sm font-medium whitespace-nowrap",children:"LIKELIHOOD →"}),e.jsxs("div",{className:"ml-8",children:[e.jsxs("div",{className:"flex mb-2",children:[e.jsx("div",{className:"w-24 shrink-0"})," ",P.map(s=>e.jsx("div",{className:"flex-1 text-center text-xs text-surface-400 font-medium",children:T[s]},s))]}),[...F].reverse().map((s,n)=>e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-24 shrink-0 flex items-center text-xs text-surface-400 font-medium pr-2",children:S[s]}),P.map((a,u)=>{const r=H(s,a),g=F.length-1-n,h=u;return e.jsx("button",{onClick:()=>r&&r.count>0&&d(r),className:`flex-1 aspect-square m-0.5 rounded-lg transition-all flex items-center justify-center ${Q(g,h)} ${r&&r.count>0?"cursor-pointer":"cursor-default"}`,children:r&&r.count>0&&e.jsx("span",{className:"text-white font-bold text-lg",children:r.count})},`${s}-${a}`)})]},s)),e.jsx("div",{className:"text-center text-surface-400 text-sm font-medium mt-4",children:"IMPACT →"})]})]}),e.jsxs("div",{className:"text-xs text-surface-500 text-right mt-4",children:["Generated: ",new Date().toLocaleString()]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:c?"Selected Risks":"Click a Cell"}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-surface-400",children:"Likelihood:"}),e.jsx("span",{className:"text-white ml-2 capitalize",children:S[c.likelihood]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-surface-400",children:"Impact:"}),e.jsx("span",{className:"text-white ml-2 capitalize",children:T[c.impact]})]})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.risks.map(s=>e.jsxs("button",{onClick:()=>o(`/risks/${s.id}`),className:"w-full p-3 bg-surface-700 rounded-lg text-left hover:bg-surface-600 transition-colors",children:[e.jsx("span",{className:"text-brand-400 font-mono text-sm",children:s.riskId}),e.jsx("p",{className:"text-white mt-1",children:s.title})]},s.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-8 h-8 text-surface-500 mx-auto mb-2"}),e.jsx("p",{className:"text-surface-400",children:"Click on any cell with risks to see the details"})]})]}),i&&e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Risk Distribution"}),e.jsx("div",{className:"space-y-3",children:i.byRiskLevel?.map(s=>{const n={low:"bg-emerald-500",medium:"bg-amber-500",high:"bg-orange-500",critical:"bg-red-500"},a=i.totalRisks?Math.round(s.count/i.totalRisks*100):0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-300 capitalize",children:s.level}),e.jsxs("span",{className:"text-surface-400",children:[s.count," (",a,"%)"]})]}),e.jsx("div",{className:"h-2 bg-surface-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${n[s.level]||"bg-surface-500"}`,style:{width:`${a}%`}})})]},s.level)})})]}),i&&e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"By Category"}),e.jsx("div",{className:"space-y-2",children:i.byCategory?.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-surface-700 rounded",children:[e.jsx("span",{className:"text-surface-300 capitalize",children:s.category}),e.jsx("span",{className:"text-white font-medium",children:s.count})]},s.category))})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>p(!1)})]})}export{te as default};
