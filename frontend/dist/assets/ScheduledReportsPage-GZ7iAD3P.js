import{r as h,j as e,M as D,aa as N,B as f,a1 as w,bF as O,aP as M,S as C,c1 as q,aQ as T,h as F,aD as x}from"./vendor-CWk44mA8.js";import{B as b}from"./index-CiJwl-Bo.js";import{M as E}from"./Modal-BXiMOSLX.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const R=[{value:"risk-register",label:"Risk Register"},{value:"risk-summary",label:"Risk Summary"},{value:"control-status",label:"Control Status"},{value:"compliance-summary",label:"Compliance Summary"},{value:"vendor-assessment",label:"Vendor Assessment"},{value:"policy-review",label:"Policy Review Status"},{value:"evidence-audit",label:"Evidence Audit Trail"},{value:"executive-summary",label:"Executive Summary"}],$=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"}],S=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}];function W({className:s}){const[c,r]=h.useState(!1),[d,a]=h.useState(null),[n,o]=h.useState(()=>{const l=localStorage.getItem("scheduled_reports");return l?JSON.parse(l):[]}),t=l=>{localStorage.setItem("scheduled_reports",JSON.stringify(l)),o(l)},m=l=>{const u={...l,id:Math.random().toString(36).substr(2,9),createdAt:new Date().toISOString(),nextRun:j(l.schedule)};t([...n,u]),x.success("Scheduled report created")},i=(l,u)=>{const v=n.map(y=>y.id===l?{...y,...u,nextRun:u.schedule?j(u.schedule):y.nextRun}:y);t(v),x.success("Report updated")},p=l=>{t(n.filter(u=>u.id!==l)),x.success("Scheduled report deleted")},g=l=>{const u=n.find(v=>v.id===l);u&&i(l,{enabled:!u.enabled})},k=l=>{x.success(`Running ${l.name}...`),i(l.id,{lastRun:new Date().toISOString()})};return e.jsxs("div",{className:s,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Scheduled Reports"}),e.jsx("p",{className:"text-surface-400 text-sm mt-1",children:"Automate report generation and delivery"})]}),e.jsx(b,{onClick:()=>r(!0),leftIcon:e.jsx(D,{className:"w-4 h-4"}),children:"New Schedule"})]}),n.length===0?e.jsxs("div",{className:"text-center py-12 bg-surface-800 border border-surface-700 rounded-xl",children:[e.jsx(N,{className:"w-12 h-12 mx-auto text-surface-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-surface-300 mb-2",children:"No scheduled reports"}),e.jsx("p",{className:"text-surface-500 mb-4",children:"Set up automated reports to be delivered on a schedule"}),e.jsx(b,{onClick:()=>r(!0),children:"Create Your First Schedule"})]}):e.jsx("div",{className:"space-y-4",children:n.map(l=>e.jsx(I,{report:l,onEdit:()=>a(l),onDelete:()=>p(l.id),onToggle:()=>g(l.id),onRunNow:()=>k(l)},l.id))}),e.jsx(P,{isOpen:c||!!d,onClose:()=>{r(!1),a(null)},report:d,onSave:l=>{d?i(d.id,l):m(l),r(!1),a(null)}})]})}function I({report:s,onEdit:c,onDelete:r,onToggle:d,onRunNow:a}){const n=R.find(o=>o.value===s.reportType);return e.jsx("div",{className:f("bg-surface-800 border rounded-xl p-4",s.enabled?"border-surface-700":"border-surface-700/50 opacity-60"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:f("p-2 rounded-lg",s.enabled?"bg-brand-500/20":"bg-surface-700"),children:e.jsx(w,{className:f("w-6 h-6",s.enabled?"text-brand-400":"text-surface-500")})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-surface-100",children:s.name}),e.jsxs("p",{className:"text-sm text-surface-400 mt-1",children:[n?.label||s.reportType," â€¢ ",s.format.toUpperCase()]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-surface-500",children:[e.jsx(N,{className:"w-4 h-4"}),_(s.schedule)]}),e.jsxs("span",{className:"flex items-center gap-1 text-surface-500",children:[e.jsx(O,{className:"w-4 h-4"}),s.recipients.length," recipient",s.recipients.length!==1?"s":""]})]}),s.nextRun&&s.enabled&&e.jsxs("p",{className:"text-xs text-surface-500 mt-2",children:["Next run: ",new Date(s.nextRun).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:a,leftIcon:e.jsx(M,{className:"w-4 h-4"}),children:"Run Now"}),e.jsx("button",{onClick:d,className:f("p-2 rounded-lg transition-colors",s.enabled?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-surface-700 text-surface-500 hover:bg-surface-600"),title:s.enabled?"Disable":"Enable",children:s.enabled?e.jsx(C,{className:"w-5 h-5"}):e.jsx(q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400 hover:text-red-400",children:e.jsx(F,{className:"w-5 h-5"})})]})]})})}function P({isOpen:s,onClose:c,report:r,onSave:d}){const[a,n]=h.useState({name:"",reportType:"risk-register",format:"pdf",frequency:"weekly",dayOfWeek:1,dayOfMonth:1,time:"09:00",recipients:"",enabled:!0});h.useEffect(()=>{n(r?{name:r.name,reportType:r.reportType,format:r.format,frequency:r.schedule.frequency,dayOfWeek:r.schedule.dayOfWeek||1,dayOfMonth:r.schedule.dayOfMonth||1,time:r.schedule.time,recipients:r.recipients.join(", "),enabled:r.enabled}:{name:"",reportType:"risk-register",format:"pdf",frequency:"weekly",dayOfWeek:1,dayOfMonth:1,time:"09:00",recipients:"",enabled:!0})},[r,s]);const o=t=>{t.preventDefault();const m=a.recipients.split(",").map(i=>i.trim()).filter(i=>i);if(!a.name||m.length===0){x.error("Please fill in all required fields");return}d({name:a.name,reportType:a.reportType,format:a.format,schedule:{frequency:a.frequency,dayOfWeek:a.frequency==="weekly"?a.dayOfWeek:void 0,dayOfMonth:a.frequency==="monthly"||a.frequency==="quarterly"?a.dayOfMonth:void 0,time:a.time},recipients:m,enabled:a.enabled})};return e.jsx(E,{isOpen:s,onClose:c,title:r?"Edit Scheduled Report":"New Scheduled Report",size:"lg",children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Report Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>n({...a,name:t.target.value}),placeholder:"Weekly Risk Summary",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Report Type"}),e.jsx("select",{value:a.reportType,onChange:t=>n({...a,reportType:t.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:R.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Format"}),e.jsx("div",{className:"flex gap-2",children:["pdf","csv","xlsx"].map(t=>e.jsx("button",{type:"button",onClick:()=>n({...a,format:t}),className:f("px-4 py-2 rounded-lg text-sm",a.format===t?"bg-brand-500 text-white":"bg-surface-700 text-surface-300 hover:bg-surface-600"),children:t.toUpperCase()},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Frequency"}),e.jsx("select",{value:a.frequency,onChange:t=>n({...a,frequency:t.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),a.frequency==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Day of Week"}),e.jsx("select",{value:a.dayOfWeek,onChange:t=>n({...a,dayOfWeek:Number(t.target.value)}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:S.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),(a.frequency==="monthly"||a.frequency==="quarterly")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Day of Month"}),e.jsx("select",{value:a.dayOfMonth,onChange:t=>n({...a,dayOfMonth:Number(t.target.value)}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:Array.from({length:31},(t,m)=>m+1).map(t=>e.jsxs("option",{value:t,children:[t,t>28?"*":""]},t))}),e.jsx("p",{className:"text-xs text-surface-500 mt-1",children:"* Days 29-31 will run on the last day of shorter months"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Time"}),e.jsx("input",{type:"time",value:a.time,onChange:t=>n({...a,time:t.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Recipients * (comma-separated emails)"}),e.jsx("input",{type:"text",value:a.recipients,onChange:t=>n({...a,recipients:t.target.value}),placeholder:"john@example.com, jane@example.com",className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx(b,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(b,{type:"submit",children:r?"Update Schedule":"Create Schedule"})]})]})})}function _(s){const c=s.time;switch(s.frequency){case"daily":return`Daily at ${c}`;case"weekly":return`Every ${S.find(d=>d.value===s.dayOfWeek)?.label||""} at ${c}`;case"monthly":return`Monthly on day ${s.dayOfMonth} at ${c}`;case"quarterly":return`Quarterly on day ${s.dayOfMonth} at ${c}`;default:return s.frequency}}function j(s){const c=new Date,[r,d]=s.time.split(":").map(Number);let a=new Date(c);if(a.setHours(r,d,0,0),a<=c)switch(s.frequency){case"daily":a.setDate(a.getDate()+1);break;case"weekly":{const n=s.dayOfWeek||0,o=c.getDay(),t=(n-o+7)%7||7;a.setDate(a.getDate()+t);break}case"monthly":case"quarterly":{const n=s.dayOfMonth||1,o=s.frequency==="quarterly"?3:1;if(a.setDate(n),a<=c){const t=c.getMonth()+o,m=c.getFullYear()+Math.floor(t/12),i=t%12,p=new Date(m,i+1,0).getDate(),g=Math.min(n,p);a=new Date(m,i,g,r,d,0,0)}break}}return a.toISOString()}function B(){return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-surface-100 flex items-center gap-3",children:[e.jsx(w,{className:"w-8 h-8 text-brand-500"}),"Report Scheduling"]}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Configure automated report generation and email delivery"})]})}),e.jsx(W,{})]})}export{B as default};
