import{r as c,j as e,B as D,X as R,m as L,l as K,ay as _,bZ as H,aa as J,R as M,a3 as O,aD as C,aS as W,k as V,aO as X,aQ as G,h as Y,b_ as U,am as Z,f as ee}from"./vendor-CWk44mA8.js";import{b as se,G as $,q as I,B as q}from"./index-CiJwl-Bo.js";import{b as te,c as B}from"./Skeleton-DVOICtGK.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";function ae({questionText:a,onSelectAnswer:w,onClose:l,isOpen:u,className:E}){const{user:b}=se(),[o,S]=c.useState(""),[g,j]=c.useState([]),[v,N]=c.useState(!1),[i,m]=c.useState(!1),[r,f]=c.useState(null),F=b?.organizationId||"default-org",k=c.useCallback(async t=>{if(!t.trim()||t.length<3){j([]);return}N(!0);try{const h=await $.search(F,t);j(h.data||[])}catch(h){console.error("Error searching knowledge base:",h);try{const A=await $.list({organizationId:F,search:t,status:"approved"});j(A.data||[])}catch(A){console.error("Fallback search failed:",A),j([])}}finally{N(!1)}},[F]);c.useEffect(()=>{if(u&&a&&!i){const t=a.slice(0,100).toLowerCase().replace(/[?.,!]/g,"").split(" ").filter(h=>h.length>3&&!["what","when","where","which","does","have","your","this","that","with","from","into"].includes(h)).slice(0,5).join(" ");t&&(S(t),k(t),m(!0))}},[u,a,i,k]),c.useEffect(()=>{u||(m(!1),f(null))},[u]),c.useEffect(()=>{const t=setTimeout(()=>{o.length>=3&&k(o)},300);return()=>clearTimeout(t)},[o,k]);const n=async t=>{w(t.answer||"",t.id);try{await $.incrementUsage(t.id)}catch(h){console.error("Error incrementing usage:",h)}C.success("Answer applied from Knowledge Base")},x=t=>{navigator.clipboard.writeText(t.answer||""),C.success("Answer copied to clipboard")};return u?e.jsxs("div",{className:D("bg-surface-900 border border-surface-700 rounded-xl shadow-xl overflow-hidden",E),children:[e.jsxs("div",{className:"bg-surface-800 px-4 py-3 flex items-center justify-between border-b border-surface-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-brand-400"}),e.jsx("h3",{className:"font-semibold text-surface-100",children:"Knowledge Base"})]}),l&&e.jsx("button",{onClick:l,className:"p-1 text-surface-400 hover:text-surface-200 rounded transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-3 border-b border-surface-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"}),e.jsx("input",{type:"text",value:o,onChange:t=>S(t.target.value),placeholder:"Search knowledge base...",className:"w-full pl-9 pr-3 py-2 bg-surface-800 border border-surface-600 rounded-lg text-surface-100 text-sm focus:outline-none focus:border-brand-500 placeholder:text-surface-500"}),v&&e.jsx(_,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400 animate-spin"})]}),e.jsx("p",{className:"text-xs text-surface-500 mt-2",children:g.length>0?`Found ${g.length} matching entries`:o.length>0&&o.length<3?"Type at least 3 characters to search":"Search by keywords, tags, or categories"})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[g.length===0&&!v&&o.length>=3&&e.jsxs("div",{className:"p-6 text-center text-surface-400",children:[e.jsx(R,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No matching entries found"}),e.jsx("p",{className:"text-xs mt-1",children:"Try different keywords"})]}),g.map(t=>e.jsxs("div",{className:D("border-b border-surface-700 last:border-b-0 transition-colors",r?.id===t.id?"bg-brand-500/10":"hover:bg-surface-800"),children:[e.jsx("button",{onClick:()=>f(r?.id===t.id?null:t),className:"w-full p-3 text-left",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-surface-100 truncate",children:t.title}),t.status==="approved"&&e.jsx(H,{className:"w-4 h-4 text-green-400 flex-shrink-0",title:"Approved"})]}),t.question&&e.jsxs("p",{className:"text-xs text-surface-400 line-clamp-1 mb-1",children:["Q: ",t.question]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:[t.category&&e.jsx("span",{className:"px-1.5 py-0.5 bg-surface-700 rounded",children:t.category}),t.usageCount&&t.usageCount>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Used ",t.usageCount,"x"]})]})]})})}),r?.id===t.id&&e.jsxs("div",{className:"px-3 pb-3 space-y-3",children:[e.jsx("div",{className:"bg-surface-800 rounded-lg p-3 border border-surface-600",children:e.jsx("p",{className:"text-sm text-surface-200 whitespace-pre-wrap",children:t.answer||"No answer content"})}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((h,A)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-surface-700 text-surface-300 rounded",children:h},A))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>n(t),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-brand-600 hover:bg-brand-500 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Use This Answer"]}),e.jsx("button",{onClick:()=>x(t),className:"px-3 py-2 bg-surface-700 hover:bg-surface-600 text-surface-200 text-sm rounded-lg transition-colors",title:"Copy to clipboard",children:e.jsx(O,{className:"w-4 h-4"})})]})]})]},t.id))]}),e.jsx("div",{className:"px-4 py-2 bg-surface-800 border-t border-surface-700",children:e.jsx("p",{className:"text-xs text-surface-500 text-center",children:'Click an entry to preview, then "Use This Answer" to apply'})})]}):null}function ue(){const{id:a}=W(),w=V(),[l,u]=c.useState(null),[E,b]=c.useState(!0),[o,S]=c.useState(!1),[g,j]=c.useState(!1),[v,N]=c.useState(!1),[i,m]=c.useState({title:"",requesterName:"",requesterEmail:"",company:"",priority:"medium",dueDate:"",description:""}),[r,f]=c.useState({title:"",requesterName:"",requesterEmail:"",company:"",description:"",priority:"medium",dueDate:"",questionsText:""}),[F,k]=c.useState(null),[n,x]=c.useState(!1);c.useEffect(()=>{a&&a!=="new"?t():b(!1)},[a]),c.useEffect(()=>{l&&m({title:l.title||"",requesterName:l.requesterName||"",requesterEmail:l.requesterEmail||"",company:l.company||"",priority:l.priority||"medium",dueDate:l.dueDate?l.dueDate.split("T")[0]:"",description:l.description||""})},[l]);const t=async()=>{try{const s=await I.get(a);u(s.data)}catch(s){console.error("Error fetching questionnaire:",s)}finally{b(!1)}},h=async(s,d)=>{try{await fetch(`/api/questionnaires/questions/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json","x-user-id":"system"},body:JSON.stringify({answerText:d,status:"answered"})}),t()}catch(T){console.error("Error updating answer:",T)}},A=async s=>{x(!0),k(s);try{const d=await s.text();let T=[];if(s.name.endsWith(".csv")){const p=d.split(`
`).filter(Q=>Q.trim()),y=p[0]?.toLowerCase().includes("question")?1:0;T=p.slice(y).map(Q=>{const P=Q.match(/^"([^"]*)"|^([^,]*)/);return P?(P[1]||P[2]).trim():Q.trim()}).filter(Q=>Q.length>0)}else s.name.endsWith(".txt")?T=d.split(`
`).map(p=>p.trim()).filter(p=>p.length>0):T=d.split(`
`).map(p=>p.replace(/^\s*(\d+[.)]|Q\d+[.)]?)\s*/,"").trim()).filter(p=>p.length>0);f({...r,questionsText:T.join(`
`)}),C.success(`Successfully parsed ${T.length} questions from ${s.name}`)}catch(d){console.error("Error parsing file:",d),C.error("Failed to parse file. Please check the format or paste questions manually.")}finally{x(!1)}},z=async s=>{s.preventDefault(),S(!0);try{const d=r.questionsText.split(`
`).map(y=>y.trim()).filter(y=>y.length>0),p=await(await fetch("/api/questionnaires",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"system"},body:JSON.stringify({organizationId:"default-org",title:r.title,requesterName:r.requesterName,requesterEmail:r.requesterEmail,company:r.company||void 0,description:r.description||void 0,priority:r.priority,dueDate:r.dueDate?new Date(r.dueDate).toISOString():void 0,status:"pending"})})).json();for(let y=0;y<d.length;y++)await fetch("/api/questionnaires/questions",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"system"},body:JSON.stringify({questionnaireId:p.id,questionText:d[y],questionNumber:`${y+1}`,status:"pending"})});C.success(`Successfully created questionnaire with ${d.length} questions!`),w(`/questionnaires/${p.id}`)}catch(d){console.error("Error creating questionnaire:",d),C.error("Failed to create questionnaire. Please try again.")}finally{S(!1)}};return E?e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{}),e.jsx(B,{title:!0}),e.jsx(B,{title:!0})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>w("/questionnaires"),className:"p-2 text-surface-400 hover:text-surface-100 hover:bg-surface-800 rounded-lg transition-colors",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-surface-100",children:a==="new"?"Log Incoming Questionnaire":l?.title||"Customer Questionnaire"}),l&&e.jsxs("p",{className:"mt-1 text-surface-400",children:["Received from ",l.requesterName," ",l.company&&`at ${l.company}`]})]})]}),l&&a!=="new"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"outline",onClick:()=>j(!0),leftIcon:e.jsx(G,{className:"w-5 h-5"}),children:"Edit"}),e.jsx(q,{variant:"danger",onClick:()=>N(!0),leftIcon:e.jsx(Y,{className:"w-5 h-5"}),children:"Delete"})]})]}),a==="new"?e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-surface-100",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Requester Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.requesterName,onChange:s=>f({...r,requesterName:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Requester Email ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"email",required:!0,value:r.requesterEmail,onChange:s=>f({...r,requesterEmail:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"john@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Company"}),e.jsx("input",{type:"text",value:r.company,onChange:s=>f({...r,company:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"Acme Corp"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:["Title ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:r.title,onChange:s=>f({...r,title:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"Security Assessment 2025"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Priority"}),e.jsxs("select",{value:r.priority,onChange:s=>f({...r,priority:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:r.dueDate,onChange:s=>f({...r,dueDate:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:s=>f({...r,description:s.target.value}),rows:2,className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",placeholder:"Additional context about this questionnaire..."})]})]}),e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-surface-100",children:["Upload Questionnaire ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("p",{className:"text-sm text-surface-400",children:"Upload the questionnaire file you received from the customer. Supports CSV, Excel, Word, PDF, and text files."}),r.questionsText?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-surface-800 rounded-lg border border-surface-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-6 h-6 text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-surface-100 font-medium",children:F?.name}),e.jsxs("p",{className:"text-sm text-surface-400",children:[r.questionsText.split(`
`).filter(s=>s.trim()).length," questions parsed"]})]})]}),e.jsx("button",{type:"button",onClick:()=>{f({...r,questionsText:""}),k(null)},className:"px-3 py-1.5 text-sm bg-surface-700 text-surface-200 rounded hover:bg-surface-600 transition-colors",children:"Replace File"})]}),e.jsxs("div",{className:"border border-surface-700 rounded-lg p-4 max-h-60 overflow-y-auto",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-400 mb-2",children:"Parsed Questions Preview:"}),e.jsxs("ol",{className:"space-y-1 text-sm text-surface-300",children:[r.questionsText.split(`
`).filter(s=>s.trim()).slice(0,10).map((s,d)=>e.jsxs("li",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-surface-500 min-w-[2rem]",children:[d+1,"."]}),e.jsx("span",{children:s})]},d)),r.questionsText.split(`
`).filter(s=>s.trim()).length>10&&e.jsxs("li",{className:"text-surface-500 italic",children:["... and ",r.questionsText.split(`
`).filter(s=>s.trim()).length-10," more questions"]})]})]})]}):e.jsxs("div",{className:"border-2 border-dashed border-surface-700 rounded-lg p-12",children:[e.jsx("input",{type:"file",accept:".csv,.txt,.xlsx,.xls,.doc,.docx,.pdf",onChange:s=>{const d=s.target.files?.[0];d&&A(d)},className:"hidden",id:"questionnaire-file-upload",disabled:n}),e.jsxs("label",{htmlFor:"questionnaire-file-upload",className:"cursor-pointer flex flex-col items-center",children:[e.jsx(U,{className:"w-16 h-16 text-surface-500 mb-3"}),e.jsx("span",{className:"text-surface-100 text-lg mb-2",children:n?"Parsing file...":"Click to upload questionnaire"}),e.jsx("span",{className:"text-sm text-surface-400 mb-1",children:"or drag and drop"}),e.jsx("span",{className:"text-xs text-surface-500",children:"CSV, Excel, Word, PDF, or TXT"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{variant:"secondary",type:"button",onClick:()=>w("/questionnaires"),disabled:o,children:"Cancel"}),e.jsx(q,{type:"submit",isLoading:o,children:"Create Questionnaire"})]})]}):l?e.jsx(re,{questionnaire:l,onUpdateAnswer:h,onRefresh:t}):null,g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 max-w-2xl w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Edit Questionnaire Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:i.title,onChange:s=>m({...i,title:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Requester Name"}),e.jsx("input",{type:"text",value:i.requesterName,onChange:s=>m({...i,requesterName:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Requester Email"}),e.jsx("input",{type:"email",value:i.requesterEmail,onChange:s=>m({...i,requesterEmail:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Company"}),e.jsx("input",{type:"text",value:i.company,onChange:s=>m({...i,company:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Priority"}),e.jsxs("select",{value:i.priority,onChange:s=>m({...i,priority:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:i.dueDate,onChange:s=>m({...i,dueDate:s.target.value}),className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400 mb-1",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>m({...i,description:s.target.value}),rows:3,className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(q,{variant:"secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx(q,{onClick:async()=>{try{await I.update(a,{...i,dueDate:i.dueDate?new Date(i.dueDate).toISOString():void 0}),C.success("Questionnaire updated successfully"),j(!1),t()}catch(s){console.error("Error updating questionnaire:",s),C.error("Failed to update questionnaire")}},children:"Save Changes"})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100 mb-2",children:"Delete Questionnaire"}),e.jsxs("p",{className:"text-surface-400 mb-6",children:['Are you sure you want to delete "',l?.title,'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(q,{variant:"danger",onClick:async()=>{try{await I.delete(a),C.success("Questionnaire deleted successfully"),w("/questionnaires")}catch(s){console.error("Error deleting questionnaire:",s),C.error("Failed to delete questionnaire")}},children:"Delete"})]})]})})]})}function re({questionnaire:a,onUpdateAnswer:w,onRefresh:l}){const[u,E]=c.useState(a.questions.find(n=>n.status==="pending")?.id||a.questions[0]?.id||null),[b,o]=c.useState(!0),[S,g]=c.useState(()=>{const n={};return a.questions.forEach(x=>{n[x.id]=x.answerText||""}),n}),j=a.questions.find(n=>n.id===u),v=a.questions.filter(n=>n.status==="answered"||n.status==="approved").length,N=a.questions.filter(n=>n.status==="pending").length,i=a.questions.length,m=i>0?Math.round(v/i*100):0,r=(n,x)=>{u&&g(t=>({...t,[u]:n}))},f=(n,x)=>{g(t=>({...t,[n]:x}))},F=async(n,x,t)=>{await w(n,x,t),l()},k=()=>{const n=a.questions.findIndex(t=>t.id===u),x=a.questions.find((t,h)=>h>n&&t.status==="pending");x&&E(x.id)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-900 border border-surface-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Progress"}),e.jsxs("p",{className:"text-sm text-surface-400",children:[v," of ",i," questions answered"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:D("px-2 py-1 text-xs font-medium rounded-full capitalize",a.status==="completed"?"bg-green-500/20 text-green-400":a.status==="in_progress"?"bg-blue-500/20 text-blue-400":"bg-amber-500/20 text-amber-400"),children:a.status.replace("_"," ")}),e.jsxs("span",{className:D("px-2 py-1 text-xs font-medium rounded-full capitalize",a.priority==="urgent"?"bg-red-500/20 text-red-400":a.priority==="high"?"bg-orange-500/20 text-orange-400":"bg-surface-700 text-surface-300"),children:[a.priority," priority"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.dueDate&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-surface-500",children:"Due Date"}),e.jsx("p",{className:"text-sm font-medium text-surface-200",children:new Date(a.dueDate).toLocaleDateString()})]}),e.jsxs("button",{onClick:()=>o(!b),className:D("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",b?"bg-brand-600 text-white":"bg-surface-700 text-surface-200 hover:bg-surface-600"),children:[e.jsx(R,{className:"w-4 h-4"}),b?"Hide":"Show"," KB"]})]})]}),e.jsx("div",{className:"relative h-2 bg-surface-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-brand-600 to-brand-400 transition-all duration-500",style:{width:`${m}%`}})}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-surface-500",children:[e.jsxs("span",{children:[m,"% complete"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),v," answered"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-amber-500"}),N," pending"]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:D("space-y-3 transition-all",b?"w-2/3":"w-full"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-surface-100",children:"Questions"}),N>0&&e.jsx("button",{onClick:k,className:"text-sm text-brand-400 hover:text-brand-300 transition-colors",children:"Jump to next pending →"})]}),e.jsx("div",{className:"space-y-3 max-h-[calc(100vh-380px)] overflow-y-auto pr-2",children:a.questions.map((n,x)=>e.jsx(ne,{question:n,index:x,onUpdateAnswer:F,isActive:u===n.id,onSelect:()=>E(n.id),onAnswerChange:t=>f(n.id,t),currentAnswer:S[n.id]||""},n.id))})]}),b&&e.jsx("div",{className:"w-1/3 sticky top-4",children:e.jsx(ae,{questionText:j?.questionText||"",onSelectAnswer:r,onClose:()=>o(!1),isOpen:!0,className:"h-[calc(100vh-380px)]"})})]})]})}function ne({question:a,index:w,onUpdateAnswer:l,isActive:u,onSelect:E,onAnswerChange:b,currentAnswer:o}){const[S,g]=c.useState(!1),j=async()=>{g(!0),await l(a.id,o),g(!1)},v={answered:"bg-green-500/20 text-green-400 border-green-500/30",approved:"bg-green-500/20 text-green-400 border-green-500/30",in_progress:"bg-blue-500/20 text-blue-400 border-blue-500/30",pending:"bg-amber-500/20 text-amber-400 border-amber-500/30",rejected:"bg-red-500/20 text-red-400 border-red-500/30"};return e.jsx("div",{className:D("bg-surface-900 border rounded-lg transition-all cursor-pointer",u?"border-brand-500 ring-2 ring-brand-500/20":"border-surface-800 hover:border-surface-600"),onClick:E,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 text-xs font-bold bg-surface-700 text-surface-300 rounded-full",children:a.questionNumber||w+1}),a.category&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-surface-700 text-surface-300 rounded",children:a.category}),e.jsx("span",{className:D("px-2 py-0.5 text-xs rounded-full capitalize border",v[a.status]||v.pending),children:a.status.replace("_"," ")})]}),e.jsx("p",{className:"text-surface-100 font-medium leading-relaxed",children:a.questionText})]}),e.jsx(Z,{className:D("w-5 h-5 text-surface-400 transition-transform flex-shrink-0 ml-2",u&&"rotate-90")})]}),u&&e.jsxs("div",{className:"space-y-3 mt-4 pt-4 border-t border-surface-700",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-surface-400",children:"Your Answer"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-surface-500",children:[e.jsx(R,{className:"w-4 h-4"}),"Use KB panel to find answers →"]})]}),e.jsx("textarea",{value:o,onChange:N=>b(N.target.value),rows:5,className:"w-full px-3 py-2 bg-surface-800 border border-surface-700 rounded-lg text-surface-100 focus:outline-none focus:border-brand-500 resize-y",placeholder:"Enter your answer here, or use the Knowledge Base panel to find a pre-approved answer..."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-surface-500",children:o.length>0&&e.jsxs("span",{children:[o.split(/\s+/).filter(Boolean).length," words"]})}),e.jsxs(q,{onClick:j,disabled:o===(a.answerText||""),isLoading:S,size:"sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Save Answer"]})]})]})]})})}export{ue as default};
