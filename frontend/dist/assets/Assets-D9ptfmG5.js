import{k as K,u as R,aK as $,r as j,b as y,c as D,j as e,bG as w,b2 as Q,bs as N,bd as B,b3 as H,b8 as W,bH as J,bI as O,bJ as U,bK as V,bL as I,bM as Y,aD as M,b7 as F}from"./vendor-CWk44mA8.js";import{B as v,y as g,j as _}from"./index-CiJwl-Bo.js";import{a as G}from"./Skeleton-DVOICtGK.js";import{E as X}from"./ExportDropdown-ClBGGM80.js";import{e as Z}from"./export-DqfI3kh9.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const S=[{value:"server",label:"Server",icon:J},{value:"workstation",label:"Workstation",icon:O},{value:"mobile",label:"Mobile",icon:U},{value:"network",label:"Network",icon:V},{value:"application",label:"Application",icon:I},{value:"data",label:"Data",icon:I},{value:"cloud",label:"Cloud",icon:Y}],C=[{value:"low",label:"Low",color:"bg-surface-500"},{value:"medium",label:"Medium",color:"bg-amber-500"},{value:"high",label:"High",color:"bg-orange-500"},{value:"critical",label:"Critical",color:"bg-red-500"}],P=[{value:"active",label:"Active",color:"bg-emerald-500/20 text-emerald-400"},{value:"inactive",label:"Inactive",color:"bg-surface-500/20 text-surface-400"},{value:"decommissioned",label:"Decommissioned",color:"bg-red-500/20 text-red-400"}];function de(){const r=K(),n=R(),[c,h]=$(),[i,a]=j.useState(!1),[f,x]=j.useState(!1),[l,o]=j.useState({name:"",type:"workstation",category:"",criticality:"medium",owner:"",location:"",department:""}),t={search:c.get("search")||"",source:c.get("source")||"",type:c.get("type")||"",status:c.get("status")||"",criticality:c.get("criticality")||"",page:parseInt(c.get("page")||"1",10)},m=(s,p)=>{const d=new URLSearchParams(c);p?d.set(s,p):d.delete(s),s!=="page"&&d.set("page","1"),h(d)},{data:u,isLoading:A}=y({queryKey:["assets",t],queryFn:async()=>{const s={page:t.page,limit:25};return t.search&&(s.search=t.search),t.source&&(s.source=t.source),t.type&&(s.type=t.type),t.status&&(s.status=t.status),t.criticality&&(s.criticality=t.criticality),(await g.list(s)).data}}),{data:b}=y({queryKey:["assets","stats"],queryFn:async()=>(await g.getStats()).data}),{data:T}=y({queryKey:["assets","sources"],queryFn:async()=>(await g.getSources()).data}),k=D({mutationFn:async s=>(await g.create(s)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["assets"]}),a(!1),o({name:"",type:"workstation",category:"",criticality:"medium",owner:"",location:"",department:""}),M.success("Asset created successfully")},onError:()=>{M.error("Failed to create asset")}}),q=s=>C.find(d=>d.value===s)?.color||"bg-surface-500",E=s=>P.find(d=>d.value===s)?.color||"bg-surface-500/20 text-surface-400",L=s=>{const d=S.find(z=>z.value===s)?.icon||N;return e.jsx(d,{className:"w-5 h-5 text-surface-400"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Asset Inventory"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"View and manage organizational assets synced from integrations"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{data:u?.assets||[],columns:Z.assets,filename:"assets",sheetName:"Assets",disabled:A||!u?.assets?.length}),e.jsx(v,{variant:"secondary",onClick:()=>x(!0),leftIcon:e.jsx(w,{className:"w-4 h-4"}),children:"Sync Assets"}),e.jsx(v,{onClick:()=>a(!0),leftIcon:e.jsx(Q,{className:"w-4 h-4"}),children:"Add Asset"})]})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-500/20 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-brand-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Total Assets"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.totalAssets})]})]})}),e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(B,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Active"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.byStatus?.find(s=>s.status==="active")?.count||0})]})]})}),e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Critical"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.byCriticality?.find(s=>s.criticality==="critical")?.count||0})]})]})}),e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/20 rounded-lg",children:e.jsx(w,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Recently Synced"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.recentlySynced||0})]})]})})]}),e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Search assets...",value:t.search,onChange:s=>m("search",s.target.value),className:"w-full pl-10 pr-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:t.source,onChange:s=>m("source",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Sources"}),T?.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:t.type,onChange:s=>m("type",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Types"}),S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{value:t.criticality,onChange:s=>m("criticality",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Criticality"}),C.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{value:t.status,onChange:s=>m("status",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),P.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]})}),e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 overflow-hidden",children:[A?e.jsx(G,{rows:10,columns:7,className:"border-none"}):u?.assets.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(N,{className:"w-12 h-12 text-surface-500 mx-auto mb-4"}),e.jsx("p",{className:"text-surface-400",children:"No assets found"}),e.jsx("p",{className:"text-surface-500 text-sm mt-2",children:"Sync assets from integrations or add them manually"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-surface-700",children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Asset"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Type"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Source"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Criticality"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Status"}),e.jsx("th",{className:"text-center px-4 py-3 text-sm font-medium text-surface-400",children:"Risks"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Last Synced"})]})}),e.jsx("tbody",{children:u?.assets.map(s=>e.jsxs("tr",{onClick:()=>r(`/assets/${s.id}`),className:"border-b border-surface-700 hover:bg-surface-700/50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[L(s.type),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.name}),s.owner&&e.jsx("p",{className:"text-surface-400 text-sm",children:s.owner})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-surface-300 capitalize",children:s.type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-surface-300 capitalize",children:s.source})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${q(s.criticality||"")}`}),e.jsx("span",{className:"text-surface-300 capitalize",children:s.criticality})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${E(s.status||"")}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-center",children:(s.riskCount??0)>0?e.jsx("span",{className:"px-2 py-1 bg-red-500/20 text-red-400 rounded text-sm",children:s.riskCount??0}):e.jsx("span",{className:"text-surface-500",children:"—"})}),e.jsx("td",{className:"px-4 py-3",children:s.lastSyncAt?e.jsx("span",{className:"text-surface-400 text-sm",children:new Date(s.lastSyncAt).toLocaleDateString()}):e.jsx("span",{className:"text-surface-500",children:"—"})})]},s.id))})]}),u&&u.total>25&&e.jsxs("div",{className:"px-4 py-3 border-t border-surface-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-surface-400",children:["Showing ",(t.page-1)*25+1," to"," ",Math.min(t.page*25,u.total)," of ",u.total," assets"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m("page",String(t.page-1)),disabled:t.page===1,className:"px-3 py-1 bg-surface-700 rounded text-surface-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-surface-600",children:"Previous"}),e.jsx("button",{onClick:()=>m("page",String(t.page+1)),disabled:t.page*25>=u.total,className:"px-3 py-1 bg-surface-700 rounded text-surface-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-surface-600",children:"Next"})]})]})]}),i&&e.jsx(ee,{asset:l,onChange:o,onSubmit:()=>k.mutate(l),onClose:()=>a(!1),isPending:k.isPending}),f&&e.jsx(se,{onClose:()=>x(!1),onSuccess:()=>{n.invalidateQueries({queryKey:["assets"]}),x(!1)}})]})}function ee({asset:r,onChange:n,onSubmit:c,onClose:h,isPending:i}){return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Add Manual Asset"}),e.jsx("button",{onClick:h,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(F,{className:"w-5 h-5 text-surface-400"})})]}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),c()},className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:a=>n({...r,name:a.target.value}),required:!0,className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"e.g., Production Server 1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Type *"}),e.jsx("select",{value:r.type,onChange:a=>n({...r,type:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Criticality"}),e.jsx("select",{value:r.criticality,onChange:a=>n({...r,criticality:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",children:C.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Category"}),e.jsx("input",{type:"text",value:r.category,onChange:a=>n({...r,category:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"e.g., Web Server, Database"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Owner"}),e.jsx("input",{type:"text",value:r.owner,onChange:a=>n({...r,owner:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Department"}),e.jsx("input",{type:"text",value:r.department,onChange:a=>n({...r,department:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Location"}),e.jsx("input",{type:"text",value:r.location,onChange:a=>n({...r,location:a.target.value}),className:"w-full px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white",placeholder:"e.g., AWS us-east-1, Office HQ"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(v,{variant:"secondary",type:"button",onClick:h,children:"Cancel"}),e.jsx(v,{type:"submit",isLoading:i,children:"Create Asset"})]})]})]})})}function se({onClose:r,onSuccess:n}){const[c,h]=j.useState(""),[i,a]=j.useState(null),{data:f}=y({queryKey:["integrations","asset-sources"],queryFn:async()=>((await _.list({status:"active"})).data||[]).filter(o=>["jamf"].includes(o.type))}),x=D({mutationFn:async()=>{const l=f?.find(t=>t.id===c);if(!l)throw new Error("Integration not found");return(await g.syncFromSource(l.type,l.id)).data},onSuccess:l=>{a(l)}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Sync Assets from Integration"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-surface-700 rounded",children:e.jsx(F,{className:"w-5 h-5 text-surface-400"})})]}),e.jsx("div",{className:"p-4 space-y-4",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${i.itemsFailed===0?"bg-emerald-500/20":"bg-amber-500/20"}`,children:[e.jsx("h4",{className:`font-medium ${i.itemsFailed===0?"text-emerald-400":"text-amber-400"}`,children:"Sync Complete"}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("p",{className:"text-surface-300",children:["Items processed: ",i.itemsProcessed]}),e.jsxs("p",{className:"text-surface-300",children:["Items created/updated: ",i.itemsCreated]}),e.jsxs("p",{className:"text-surface-300",children:["Items failed: ",i.itemsFailed]}),e.jsxs("p",{className:"text-surface-300",children:["Duration: ",i.duration,"ms"]})]}),i.errors?.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-red-400 text-sm font-medium",children:"Errors:"}),e.jsx("ul",{className:"text-red-300 text-sm mt-1 list-disc list-inside",children:i.errors.slice(0,5).map((l,o)=>e.jsx("li",{children:l},o))})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:n,className:"px-4 py-2 bg-brand-500 text-white rounded-lg",children:"Done"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-2",children:"Select Integration"}),f?.length===0?e.jsx("p",{className:"text-surface-500 py-4",children:"No integrations available for asset sync. Configure a Jamf integration first."}):e.jsx("div",{className:"space-y-2",children:f?.map(l=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${c===l.id?"bg-brand-500/20 border border-brand-500":"bg-surface-700 border border-surface-600 hover:bg-surface-600"}`,children:[e.jsx("input",{type:"radio",name:"integration",value:l.id,checked:c===l.id,onChange:o=>h(o.target.value),className:"sr-only"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:l.name}),e.jsx("p",{className:"text-surface-400 text-sm capitalize",children:l.type})]})]},l.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-surface-700 text-surface-300 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:()=>x.mutate(),disabled:!c||x.isPending,className:"px-4 py-2 bg-brand-500 text-white rounded-lg disabled:opacity-50 flex items-center gap-2",children:[x.isPending&&e.jsx(w,{className:"w-4 h-4 animate-spin"}),x.isPending?"Syncing...":"Start Sync"]})]})]})})]})})}export{de as default};
