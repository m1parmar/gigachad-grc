import{j as e,c6 as me,r as g,b as P,B as E,aj as he,ay as xe,aQ as X,h as Q,c7 as fe,m as q,aP as be,a5 as pe,y as ge,c8 as I,c9 as je,by as Y,ab as M,Z as ve,E as Ne,ca as we,u as B,c as k,cb as Z,M as O,f as ye,cc as ee,a3 as G,g as J,aD as v,az as Ce}from"./vendor-CWk44mA8.js";import{h as N}from"./index-CiJwl-Bo.js";import{u as _}from"./LazyCharts-CLuWtu1O.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";var S=(s=>(s.KPI_CARD="kpi_card",s.PIE_CHART="pie_chart",s.DONUT_CHART="donut_chart",s.BAR_CHART="bar_chart",s.LINE_CHART="line_chart",s.TABLE="table",s.HEATMAP="heatmap",s.PROGRESS="progress",s.LIST="list",s.GAUGE="gauge",s.MARKDOWN="markdown",s.IFRAME="iframe",s))(S||{}),se=(s=>(s.CONTROLS="controls",s.RISKS="risks",s.POLICIES="policies",s.VENDORS="vendors",s.EVIDENCE="evidence",s.EMPLOYEES="employees",s.AUDITS="audits",s.INTEGRATIONS="integrations",s.FRAMEWORKS="frameworks",s))(se||{}),F=(s=>(s.EQ="eq",s.NEQ="neq",s.GT="gt",s.GTE="gte",s.LT="lt",s.LTE="lte",s.CONTAINS="contains",s.IN="in",s.NOT_IN="not_in",s.IS_NULL="is_null",s.IS_NOT_NULL="is_not_null",s))(F||{});const R={kpi_card:{type:"kpi_card",name:"KPI Card",description:"Single metric with optional trend comparison",icon:"hashtag",category:"metrics",defaultSize:{w:3,h:2},minSize:{w:2,h:2},maxSize:{w:6,h:3},configOptions:["metricField","comparisonPeriod","thresholds","valueFormat"],requiresDataSource:!0},pie_chart:{type:"pie_chart",name:"Pie Chart",description:"Distribution chart showing proportions",icon:"chart-pie",category:"charts",defaultSize:{w:4,h:3},minSize:{w:3,h:2},maxSize:{w:6,h:4},configOptions:["colors","showLegend","showValues"],requiresDataSource:!0},donut_chart:{type:"donut_chart",name:"Donut Chart",description:"Ring chart with center value",icon:"chart-pie",category:"charts",defaultSize:{w:4,h:3},minSize:{w:3,h:2},maxSize:{w:6,h:4},configOptions:["colors","showLegend","showValues","metricField"],requiresDataSource:!0},bar_chart:{type:"bar_chart",name:"Bar Chart",description:"Comparison chart with bars",icon:"chart-bar",category:"charts",defaultSize:{w:6,h:3},minSize:{w:4,h:2},maxSize:{w:12,h:5},configOptions:["colors","orientation","xAxisField","yAxisField","showValues"],requiresDataSource:!0},line_chart:{type:"line_chart",name:"Line Chart",description:"Time series or trend chart",icon:"chart-line",category:"charts",defaultSize:{w:6,h:3},minSize:{w:4,h:2},maxSize:{w:12,h:5},configOptions:["colors","xAxisField","yAxisField","showValues"],requiresDataSource:!0},table:{type:"table",name:"Data Table",description:"Sortable and filterable data table",icon:"table",category:"tables",defaultSize:{w:6,h:4},minSize:{w:4,h:3},maxSize:{w:12,h:8},configOptions:["columns","pageSize","linkTemplate"],requiresDataSource:!0},heatmap:{type:"heatmap",name:"Heat Map",description:"Matrix visualization for risk or priority",icon:"grid",category:"charts",defaultSize:{w:4,h:3},minSize:{w:3,h:2},maxSize:{w:6,h:5},configOptions:["xAxisField","yAxisField","colors"],requiresDataSource:!0},progress:{type:"progress",name:"Progress Bar",description:"Goal progress visualization",icon:"progress",category:"metrics",defaultSize:{w:4,h:2},minSize:{w:3,h:1},maxSize:{w:8,h:3},configOptions:["targetValue","thresholds","valueFormat"],requiresDataSource:!0},list:{type:"list",name:"List",description:"Ranked or recent items list",icon:"list",category:"tables",defaultSize:{w:4,h:4},minSize:{w:3,h:2},maxSize:{w:6,h:8},configOptions:["columns","linkTemplate"],requiresDataSource:!0},gauge:{type:"gauge",name:"Gauge",description:"Percentage or score gauge",icon:"gauge",category:"metrics",defaultSize:{w:3,h:2},minSize:{w:2,h:2},maxSize:{w:4,h:3},configOptions:["maxValue","thresholds","valueFormat"],requiresDataSource:!0},markdown:{type:"markdown",name:"Text / Markdown",description:"Static text, notes, or instructions",icon:"document-text",category:"content",defaultSize:{w:4,h:2},minSize:{w:2,h:1},maxSize:{w:12,h:8},configOptions:["markdownContent"],requiresDataSource:!1},iframe:{type:"iframe",name:"Embedded Content",description:"Embed external content via URL",icon:"globe",category:"content",defaultSize:{w:6,h:4},minSize:{w:4,h:3},maxSize:{w:12,h:8},configOptions:["iframeUrl"],requiresDataSource:!1}},W={default:["#6366f1","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#84cc16"]};function $(){return e.jsx("div",{className:"flex items-center justify-center h-full animate-pulse bg-surface-700/30 rounded-lg",children:e.jsx("div",{className:"text-surface-500 text-sm",children:"Loading chart..."})})}function Se({widget:s,data:t}){const{widgetType:n,config:l}=s;switch(n){case S.KPI_CARD:return e.jsx(ke,{data:t,config:l});case S.PIE_CHART:return e.jsx(De,{data:t,config:l});case S.DONUT_CHART:return e.jsx(Fe,{data:t,config:l});case S.BAR_CHART:return e.jsx(Re,{data:t,config:l});case S.LINE_CHART:return e.jsx(ze,{data:t,config:l});case S.TABLE:return e.jsx(Ae,{data:t,config:l});case S.PROGRESS:return e.jsx(Le,{data:t,config:l});case S.LIST:return e.jsx(Te,{data:t,config:l});case S.GAUGE:return e.jsx(Ee,{data:t,config:l});case S.HEATMAP:return e.jsx(Me,{data:t,config:l});case S.MARKDOWN:return e.jsx(Pe,{config:l});case S.IFRAME:return e.jsx(qe,{config:l});default:return e.jsx("div",{className:"flex items-center justify-center h-full text-surface-500",children:"Unknown widget type"})}}function ke({data:s,config:t}){const n=g.useMemo(()=>{if(s.length===0)return 0;const i=t?.metricField||"count";return s[0]?.[i]!==void 0?s.reduce((a,r)=>a+(r[i]||0),0):s[0]?.count!==void 0?s.reduce((a,r)=>a+(r.count||0),0):s.length},[s,t?.metricField]),l=t?.valueFormat?t.valueFormat.replace("{value}",n.toString()):n.toString();let c="#6366f1";if(t?.thresholds){for(const i of t.thresholds.sort((a,r)=>r.value-a.value))if(n>=i.value){c=i.color;break}}return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"text-4xl font-bold",style:{color:c},children:l}),t?.comparisonPeriod&&e.jsxs("div",{className:"text-sm text-surface-400 mt-2",children:["vs ",t.comparisonPeriod]})]})}function De({data:s,config:t}){const n=t?.colors||W.default,l=_(),c=g.useMemo(()=>s.map((x,f)=>({name:K(Object.keys(x).find(h=>h!=="count")?x[Object.keys(x).find(h=>h!=="count")]:`Item ${f+1}`),value:x.count||x.value||1})),[s]);if(c.length===0)return e.jsx(A,{});if(!l)return e.jsx($,{});const{PieChart:i,Pie:a,Cell:r,Tooltip:o,ResponsiveContainer:u,Legend:b}=l;return e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(i,{children:[e.jsx(a,{data:c,cx:"50%",cy:"50%",outerRadius:"80%",dataKey:"value",label:t?.showValues?({name:x,value:f})=>`${x}: ${f}`:!1,children:c.map((x,f)=>e.jsx(r,{fill:n[f%n.length]},`cell-${f}`))}),e.jsx(o,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}}),t?.showLegend&&e.jsx(b,{})]})})}function Fe({data:s,config:t}){const n=t?.colors||W.default,l=_(),c=g.useMemo(()=>s.map((f,h)=>({name:K(Object.keys(f).find(w=>w!=="count")?f[Object.keys(f).find(w=>w!=="count")]:`Item ${h+1}`),value:f.count||f.value||1})),[s]),i=c.reduce((f,h)=>f+h.value,0);if(c.length===0)return e.jsx(A,{});if(!l)return e.jsx($,{});const{PieChart:a,Pie:r,Cell:o,Tooltip:u,ResponsiveContainer:b,Legend:x}=l;return e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(a,{children:[e.jsx(r,{data:c,cx:"50%",cy:"50%",innerRadius:"50%",outerRadius:"80%",dataKey:"value",children:c.map((f,h)=>e.jsx(o,{fill:n[h%n.length]},`cell-${h}`))}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"middle",className:"fill-surface-100 text-2xl font-bold",children:i}),e.jsx(u,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}}),t?.showLegend&&e.jsx(x,{})]})})}function Re({data:s,config:t}){const n=t?.colors||W.default,l=t?.orientation==="horizontal",c=_(),i=g.useMemo(()=>s.map((h,w)=>{const j=Object.keys(h).find(D=>D!=="count");return{name:K(j?h[j]:`Item ${w+1}`),value:h.count||h.value||0}}),[s]);if(i.length===0)return e.jsx(A,{});if(!c)return e.jsx($,{});const{BarChart:a,Bar:r,Cell:o,XAxis:u,YAxis:b,Tooltip:x,ResponsiveContainer:f}=c;return e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(a,{data:i,layout:l?"vertical":"horizontal",margin:{left:l?80:10,right:20,top:10,bottom:10},children:[l?e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"number",stroke:"#71717a"}),e.jsx(b,{type:"category",dataKey:"name",stroke:"#71717a",width:70,tick:{fill:"#a1a1aa",fontSize:11}})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{dataKey:"name",stroke:"#71717a",tick:{fill:"#a1a1aa",fontSize:11}}),e.jsx(b,{stroke:"#71717a"})]}),e.jsx(x,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}}),e.jsx(r,{dataKey:"value",radius:[4,4,0,0],children:i.map((h,w)=>e.jsx(o,{fill:n[w%n.length]},`cell-${w}`))})]})})}function ze({data:s,config:t}){const n=t?.colors||W.default,l=_(),c=g.useMemo(()=>s.map((x,f)=>{const h=t?.xAxisField||Object.keys(x).find(j=>j!=="count"&&j!=="value"),w=t?.yAxisField||"count";return{name:h?x[h]:`Point ${f+1}`,value:x[w]||x.count||x.value||0}}),[s,t?.xAxisField,t?.yAxisField]);if(c.length===0)return e.jsx(A,{});if(!l)return e.jsx($,{});const{LineChart:i,Line:a,XAxis:r,YAxis:o,Tooltip:u,ResponsiveContainer:b}=l;return e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(i,{data:c,margin:{left:10,right:20,top:10,bottom:10},children:[e.jsx(r,{dataKey:"name",stroke:"#71717a",tick:{fill:"#a1a1aa",fontSize:11}}),e.jsx(o,{stroke:"#71717a"}),e.jsx(u,{contentStyle:{backgroundColor:"#27272a",border:"1px solid #3f3f46",borderRadius:"8px"}}),e.jsx(a,{type:"monotone",dataKey:"value",stroke:n[0],strokeWidth:2,dot:{fill:n[0],strokeWidth:2}})]})})}function Ae({data:s,config:t}){const n=t?.columns||(s.length>0?Object.keys(s[0]).map(i=>({field:i,header:K(i)})):[]),l=t?.pageSize||10,c=s.slice(0,l);return s.length===0?e.jsx(A,{}):e.jsxs("div",{className:"overflow-auto h-full",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-surface-700",children:n.map(i=>e.jsx("th",{className:"text-left py-2 px-3 font-medium text-surface-300",style:{width:i.width},children:i.header},i.field))})}),e.jsx("tbody",{children:c.map((i,a)=>e.jsx("tr",{className:"border-b border-surface-800 hover:bg-surface-800/50",children:n.map(r=>e.jsx("td",{className:"py-2 px-3 text-surface-400",children:U(i[r.field])},r.field))},a))})]}),s.length>l&&e.jsxs("div",{className:"text-xs text-surface-500 mt-2 text-center",children:["Showing ",l," of ",s.length," rows"]})]})}function Le({data:s,config:t}){const n=g.useMemo(()=>s.length===0?0:s[0]?.count!==void 0?s.reduce((a,r)=>a+(r.count||0),0):s.length,[s]),l=t?.targetValue||100,c=Math.min(Math.round(n/l*100),100);let i="#6366f1";if(t?.thresholds){for(const a of t.thresholds.sort((r,o)=>o.value-r.value))if(c>=a.value){i=a.color;break}}return e.jsxs("div",{className:"flex flex-col justify-center h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-surface-400 text-sm",children:[n," / ",l]}),e.jsxs("span",{className:"text-surface-200 font-medium",children:[c,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-surface-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${c}%`,backgroundColor:i}})})]})}function Te({data:s,config:t}){const n=s.slice(0,10);return s.length===0?e.jsx(A,{}):e.jsx("div",{className:"space-y-2 overflow-auto h-full",children:n.map((l,c)=>{const i=Object.entries(l).slice(0,2);return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-surface-800/50 rounded hover:bg-surface-800",children:[e.jsx("span",{className:"text-surface-200 truncate",children:U(i[0]?.[1])}),i[1]&&e.jsx("span",{className:"text-surface-400 text-sm",children:U(i[1][1])})]},c)})})}function Ee({data:s,config:t}){const n=g.useMemo(()=>{if(s.length===0)return 0;if(s[0]?.count!==void 0){const a=s.reduce((o,u)=>o+(u.count||0),0),r=s.find(o=>o.status==="implemented")?.count||0;return a>0?Math.round(r/a*100):0}return s.length},[s]),l=t?.maxValue||100,c=Math.min(n/l*100,100);let i="#6366f1";if(t?.thresholds){for(const a of t.thresholds.sort((r,o)=>o.value-r.value))if(n>=a.value){i=a.color;break}}return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"relative w-32 h-16 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 border-8 border-surface-700 rounded-t-full",style:{borderBottomWidth:0}}),e.jsx("div",{className:"absolute inset-0 border-8 rounded-t-full transition-all duration-500",style:{borderColor:i,borderBottomWidth:0,clipPath:`polygon(0 100%, ${c}% 100%, ${c}% 0, 0 0)`}})]}),e.jsxs("div",{className:"text-2xl font-bold text-surface-100 mt-2",children:[n,"%"]})]})}function Me({data:s,config:t}){if(s.length===0)return e.jsx(A,{});const n=t?.xAxisField||"likelihood",l=t?.yAxisField||"impact",c=["Rare","Unlikely","Possible","Likely","Almost Certain"],i=["Negligible","Minor","Moderate","Major","Severe"];return e.jsx("div",{className:"flex flex-col h-full",children:e.jsx("div",{className:"flex-1 grid grid-cols-5 gap-1",children:i.reverse().map((a,r)=>c.map((o,u)=>{const b=s.filter(h=>h[n]?.toLowerCase()===o.toLowerCase()&&h[l]?.toLowerCase()===a.toLowerCase()).length,x=Math.min(b/5,1),f=u+(4-r)>=6?"#ef4444":u+(4-r)>=4?"#f59e0b":"#22c55e";return e.jsx("div",{className:"flex items-center justify-center text-xs rounded",style:{backgroundColor:b>0?f:"#27272a",opacity:b>0?.3+x*.7:.3},title:`${o} / ${a}: ${b}`,children:b>0&&b},`${u}-${r}`)}))})})}function Pe({config:s}){const t=s?.markdownContent||"*No content*";return e.jsx("div",{className:"prose prose-sm prose-invert max-w-none h-full overflow-auto",children:e.jsx(me,{children:t})})}function qe({config:s}){const t=s?.iframeUrl;return t?e.jsx("iframe",{src:t,className:"w-full h-full border-0 rounded",sandbox:"allow-scripts allow-same-origin",title:"Embedded content"}):e.jsx("div",{className:"flex items-center justify-center h-full text-surface-500",children:"No URL configured"})}function A(){return e.jsx("div",{className:"flex items-center justify-center h-full text-surface-500 text-sm",children:"No data available"})}function K(s){return s==null?"Unknown":String(s).replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^\w/,n=>n.toUpperCase())}function U(s){return s==null?"-":s instanceof Date?s.toLocaleDateString():typeof s=="boolean"?s?"Yes":"No":typeof s=="object"?JSON.stringify(s):String(s)}function Oe({widget:s,dashboardId:t,isEditing:n,onEdit:l,onDelete:c,onRefresh:i}){const a=R[s.widgetType],{data:r,isLoading:o,error:u,refetch:b}=P({queryKey:["widget-data",t,s.id],queryFn:()=>a?.requiresDataSource?N.getWidgetData(t,s.id).then(f=>f.data):Promise.resolve({data:[]}),enabled:!!s.dataSource?.source||!a?.requiresDataSource,refetchInterval:s.refreshRate?s.refreshRate*1e3:!1,staleTime:3e4}),x=()=>{b(),i()};return e.jsxs("div",{className:E("h-full w-full bg-surface-900 border border-surface-700 rounded-lg overflow-hidden flex flex-col",n&&"ring-2 ring-brand-500/30"),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-surface-700 bg-surface-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx("div",{className:"widget-drag-handle cursor-move p-1 hover:bg-surface-700 rounded",children:e.jsx(he,{className:"w-4 h-4 text-surface-400"})}),e.jsx("h3",{className:"text-sm font-medium text-surface-200 truncate",children:s.title})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a?.requiresDataSource&&e.jsx("button",{onClick:x,className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-surface-200 transition-colors",title:"Refresh data",children:e.jsx(xe,{className:E("w-4 h-4",o&&"animate-spin")})}),n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l,className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-surface-200 transition-colors",title:"Edit widget",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-red-500/20 rounded text-surface-400 hover:text-red-400 transition-colors",title:"Delete widget",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"flex-1 p-4 overflow-auto",children:u?e.jsx("div",{className:"flex items-center justify-center h-full text-red-400 text-sm",children:"Failed to load data"}):o&&a?.requiresDataSource?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-surface-600 rounded-full border-t-brand-500"})}):e.jsx(Se,{widget:s,data:r?.data||[]})})]})}function _e({widgets:s,isEditing:t,onLayoutChange:n,onWidgetEdit:l,onWidgetDelete:c,onWidgetRefresh:i,dashboardId:a}){const r=g.useMemo(()=>s.map(u=>({i:u.id,x:u.position.x,y:u.position.y,w:u.position.w,h:u.position.h,minW:R[u.widgetType]?.minSize.w||2,minH:R[u.widgetType]?.minSize.h||1,maxW:R[u.widgetType]?.maxSize.w||12,maxH:R[u.widgetType]?.maxSize.h||8,static:!t})),[s,t]),o=g.useCallback(u=>{t&&n(u)},[t,n]);return e.jsx("div",{className:"dashboard-grid",children:e.jsx(fe,{className:"layout",layout:r,cols:12,rowHeight:80,width:1200,onLayoutChange:o,isDraggable:t,isResizable:t,compactType:"vertical",preventCollision:!1,margin:[16,16],containerPadding:[0,0],useCSSTransforms:!0,draggableHandle:".widget-drag-handle",children:s.map(u=>e.jsx("div",{children:e.jsx(Oe,{widget:u,dashboardId:a,isEditing:t,onEdit:()=>l(u),onDelete:()=>c(u.id),onRefresh:()=>i(u.id)})},u.id))})})}function We({widget:s,onSave:t,onClose:n}){const[l,c]=g.useState(s.title),[i,a]=g.useState(s.dataSource||{source:se.CONTROLS}),[r,o]=g.useState(s.config||{}),[u,b]=g.useState("data"),[x,f]=g.useState(null),[h,w]=g.useState(!1),j=R[s.widgetType],{data:D}=P({queryKey:["data-sources"],queryFn:()=>N.getDataSources().then(d=>d.data)}),L=async()=>{if(i.source){w(!0);try{const d=await N.executeQuery(i,!0);f(d.data)}catch(d){console.error("Preview failed:",d)}finally{w(!1)}}},T=()=>{t({title:l,dataSource:i,config:r})},y=D?.find(d=>d.type===i.source)?.fields||[];return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Configure Widget"}),e.jsx("p",{className:"text-sm text-surface-400",children:j?.name})]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-surface-200",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-surface-700",children:[e.jsx("button",{onClick:()=>b("data"),className:E("px-4 py-2 text-sm font-medium transition-colors",u==="data"?"text-brand-400 border-b-2 border-brand-400":"text-surface-400 hover:text-surface-200"),children:"Data Source"}),e.jsx("button",{onClick:()=>b("appearance"),className:E("px-4 py-2 text-sm font-medium transition-colors",u==="appearance"?"text-brand-400 border-b-2 border-brand-400":"text-surface-400 hover:text-surface-200"),children:"Appearance"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Widget Title"}),e.jsx("input",{type:"text",value:l,onChange:d=>c(d.target.value),className:"input w-full",placeholder:"Enter widget title"})]}),u==="data"&&j?.requiresDataSource&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Data Source"}),e.jsxs("select",{value:i.source||"",onChange:d=>a({...i,source:d.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:"Select a data source"}),D?.map(d=>e.jsx("option",{value:d.type,children:d.name},d.type))]})]}),y.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Group By (for charts)"}),e.jsxs("select",{value:i.groupBy||"",onChange:d=>a({...i,groupBy:d.target.value||void 0}),className:"input w-full",children:[e.jsx("option",{value:"",children:"No grouping"}),y.filter(d=>d.aggregatable).map(d=>e.jsx("option",{value:d.name,children:d.label},d.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Filters"}),e.jsx($e,{filters:i.filters||[],onChange:d=>a({...i,filters:d}),availableFields:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Limit Results"}),e.jsx("input",{type:"number",value:i.limit||"",onChange:d=>a({...i,limit:d.target.value?parseInt(d.target.value):void 0}),className:"input w-32",placeholder:"No limit",min:1,max:1e3})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:L,disabled:!i.source||h,className:"btn btn-ghost btn-sm",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),h?"Loading...":"Preview Data"]})}),x&&e.jsxs("div",{className:"bg-surface-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-surface-300 mb-2",children:["Preview (",x.length," results)"]}),e.jsx("pre",{className:"text-xs text-surface-400 overflow-auto max-h-48",children:JSON.stringify(x.slice(0,5),null,2)})]})]}),u==="appearance"&&e.jsxs("div",{className:"space-y-6",children:[j?.configOptions.includes("showLegend")&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"showLegend",checked:r.showLegend||!1,onChange:d=>o({...r,showLegend:d.target.checked}),className:"w-4 h-4 rounded border-surface-600 bg-surface-800 text-brand-500 focus:ring-brand-500"}),e.jsx("label",{htmlFor:"showLegend",className:"text-sm text-surface-300",children:"Show Legend"})]}),j?.configOptions.includes("showValues")&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"showValues",checked:r.showValues||!1,onChange:d=>o({...r,showValues:d.target.checked}),className:"w-4 h-4 rounded border-surface-600 bg-surface-800 text-brand-500 focus:ring-brand-500"}),e.jsx("label",{htmlFor:"showValues",className:"text-sm text-surface-300",children:"Show Values on Chart"})]}),j?.configOptions.includes("orientation")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Chart Orientation"}),e.jsxs("select",{value:r.orientation||"vertical",onChange:d=>o({...r,orientation:d.target.value}),className:"input w-48",children:[e.jsx("option",{value:"vertical",children:"Vertical"}),e.jsx("option",{value:"horizontal",children:"Horizontal"})]})]}),j?.configOptions.includes("valueFormat")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Value Format"}),e.jsx("input",{type:"text",value:r.valueFormat||"",onChange:d=>o({...r,valueFormat:d.target.value}),className:"input w-full",placeholder:"{value} or {value}%"}),e.jsxs("p",{className:"text-xs text-surface-500 mt-1",children:["Use ","{value}"," as placeholder for the actual value"]})]}),j?.configOptions.includes("targetValue")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Target Value"}),e.jsx("input",{type:"number",value:r.targetValue||"",onChange:d=>o({...r,targetValue:d.target.value?parseInt(d.target.value):void 0}),className:"input w-32",placeholder:"100"})]}),j?.configOptions.includes("maxValue")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Max Value"}),e.jsx("input",{type:"number",value:r.maxValue||"",onChange:d=>o({...r,maxValue:d.target.value?parseInt(d.target.value):void 0}),className:"input w-32",placeholder:"100"})]}),j?.configOptions.includes("markdownContent")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Content (Markdown)"}),e.jsx("textarea",{value:r.markdownContent||"",onChange:d=>o({...r,markdownContent:d.target.value}),className:"input w-full h-32 font-mono text-sm",placeholder:"# Heading\\n\\nSome **bold** text..."})]}),j?.configOptions.includes("iframeUrl")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Embed URL"}),e.jsx("input",{type:"url",value:r.iframeUrl||"",onChange:d=>o({...r,iframeUrl:d.target.value}),className:"input w-full",placeholder:"https://..."})]}),j?.configOptions.includes("pageSize")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Rows per Page"}),e.jsx("input",{type:"number",value:r.pageSize||10,onChange:d=>o({...r,pageSize:parseInt(d.target.value)||10}),className:"input w-32",min:5,max:100})]})]}),u==="appearance"&&!j?.requiresDataSource&&e.jsx("div",{className:"text-surface-500 text-sm",children:"This widget doesn't require data configuration."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-surface-700",children:[e.jsx("button",{onClick:n,className:"btn btn-ghost",children:"Cancel"}),e.jsx("button",{onClick:T,className:"btn btn-primary",children:"Save Changes"})]})]})})}function $e({filters:s,onChange:t,availableFields:n}){const l=()=>{t([...s,{field:"",operator:F.EQ,value:""}])},c=(a,r)=>{const o=[...s];o[a]={...o[a],...r},t(o)},i=a=>{t(s.filter((r,o)=>o!==a))};return e.jsxs("div",{className:"space-y-2",children:[s.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:a.field,onChange:o=>c(r,{field:o.target.value}),className:"input flex-1",children:[e.jsx("option",{value:"",children:"Select field"}),n.filter(o=>o.filterable).map(o=>e.jsx("option",{value:o.name,children:o.label},o.name))]}),e.jsxs("select",{value:a.operator,onChange:o=>c(r,{operator:o.target.value}),className:"input w-32",children:[e.jsx("option",{value:F.EQ,children:"equals"}),e.jsx("option",{value:F.NEQ,children:"not equals"}),e.jsx("option",{value:F.GT,children:"greater than"}),e.jsx("option",{value:F.LT,children:"less than"}),e.jsx("option",{value:F.CONTAINS,children:"contains"}),e.jsx("option",{value:F.IN,children:"in list"})]}),e.jsx("input",{type:"text",value:a.value,onChange:o=>c(r,{value:o.target.value}),className:"input flex-1",placeholder:"Value"}),e.jsx("button",{onClick:()=>i(r),className:"p-2 text-red-400 hover:text-red-300",children:e.jsx(q,{className:"w-4 h-4"})})]},r)),e.jsx("button",{onClick:l,className:"btn btn-ghost btn-sm",children:"+ Add Filter"})]})}const Ke={kpi_card:we,pie_chart:I,donut_chart:I,bar_chart:Ne,line_chart:Y,table:ve,heatmap:M,progress:Y,list:je,gauge:I,markdown:ge,iframe:pe};function Ve({onSelect:s,onClose:t}){const n={};Object.values(R).forEach(c=>{n[c.category]||(n[c.category]=[]),n[c.category].push(c)});const l={metrics:"Metrics",charts:"Charts",tables:"Tables & Lists",content:"Content"};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Add Widget"}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-surface-200",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:Object.entries(n).map(([c,i])=>e.jsxs("div",{className:"mb-6 last:mb-0",children:[e.jsx("h3",{className:"text-sm font-medium text-surface-400 uppercase tracking-wider mb-3",children:l[c]||c}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:i.map(a=>{const r=Ke[a.type]||M;return e.jsxs("button",{onClick:()=>s(a.type),className:E("flex flex-col items-center p-4 rounded-lg border border-surface-700","bg-surface-800 hover:bg-surface-700 hover:border-brand-500/50","transition-all duration-200 text-left"),children:[e.jsx("div",{className:"p-2 bg-surface-700 rounded-lg mb-2",children:e.jsx(r,{className:"w-6 h-6 text-brand-400"})}),e.jsx("span",{className:"text-sm font-medium text-surface-200",children:a.name}),e.jsx("span",{className:"text-xs text-surface-500 text-center mt-1",children:a.description}),e.jsxs("span",{className:"text-xs text-surface-600 mt-2",children:["Default: ",a.defaultSize.w,"x",a.defaultSize.h]})]},a.type)})})]},c))}),e.jsx("div",{className:"p-4 border-t border-surface-700 bg-surface-800/50",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Click a widget to add it to your dashboard. You can configure it after adding."})})]})})}function Ie({dashboardId:s,onBack:t}){const n=B(),[l,c]=g.useState(!1),[i,a]=g.useState(!1),[r,o]=g.useState(null),[u,b]=g.useState(!1),[x,f]=g.useState(null),{data:h,isLoading:w}=P({queryKey:["dashboard",s],queryFn:()=>N.get(s).then(p=>p.data)}),j=k({mutationFn:p=>N.update(s,p),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboard",s]}),n.invalidateQueries({queryKey:["dashboards"]}),v.success("Dashboard saved")},onError:()=>v.error("Failed to save dashboard")}),D=k({mutationFn:p=>N.addWidget(s,p),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboard",s]}),v.success("Widget added")},onError:p=>{console.error("Add widget error:",p?.response?.data||p);const C=p?.response?.data?.message||"Failed to add widget";v.error(Array.isArray(C)?C[0]:C)}}),L=k({mutationFn:({widgetId:p,data:C})=>N.updateWidget(s,p,C),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboard",s]}),v.success("Widget updated")},onError:()=>v.error("Failed to update widget")}),T=k({mutationFn:p=>N.deleteWidget(s,p),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboard",s]}),v.success("Widget deleted")},onError:()=>v.error("Failed to delete widget")}),m=k({mutationFn:()=>N.setDefault(s),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboards"]}),n.invalidateQueries({queryKey:["dashboard",s]}),v.success("Set as default dashboard")},onError:()=>v.error("Failed to set as default")}),y=k({mutationFn:()=>N.duplicate(s),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboards"]}),v.success("Dashboard duplicated")},onError:()=>v.error("Failed to duplicate dashboard")}),d=k({mutationFn:()=>N.delete(s),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboards"]}),v.success("Dashboard deleted"),t()},onError:()=>v.error("Failed to delete dashboard")}),te=g.useCallback(p=>{f(p)},[]),ae=async()=>{if(x&&h){const p=h.widgets.map(C=>{const z=x.find(V=>V.i===C.id);return z?{...C,position:{x:z.x,y:z.y,w:z.w,h:z.h}}:C});await j.mutateAsync({widgets:p}),f(null)}c(!1)},re=()=>{f(null),c(!1)},ne=p=>{o(p),a(!0)},ie=async p=>{confirm("Delete this widget?")&&await T.mutateAsync(p)},le=p=>{n.invalidateQueries({queryKey:["widget-data",s,p]})},ce=async p=>{const C=R[p],z=h?.widgets?.reduce((de,H)=>{const ue=(H.position?.y||0)+(H.position?.h||2);return Math.max(de,ue)},0)||0,V={widgetType:p,title:C.name,position:{x:0,y:z,w:C.defaultSize.w,h:C.defaultSize.h}};await D.mutateAsync(V),b(!1)},oe=async p=>{r&&await L.mutateAsync({widgetId:r.id,data:p}),a(!1),o(null)};return w?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-surface-700 rounded-full border-t-brand-500"})}):h?e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:t,className:"text-surface-400 hover:text-surface-200 transition-colors",children:"â† Back to dashboards"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:h.name}),h.isDefault&&e.jsx(Z,{className:"w-5 h-5 text-yellow-400",title:"Default dashboard"}),h.isTemplate&&e.jsx("span",{className:"badge badge-sm badge-info",children:"Template"})]}),h.description&&e.jsx("p",{className:"text-surface-400 mt-1",children:h.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>b(!0),className:"btn btn-ghost btn-sm",children:[e.jsx(O,{className:"w-4 h-4 mr-1"})," Add Widget"]}),e.jsxs("button",{onClick:re,className:"btn btn-ghost btn-sm",children:[e.jsx(q,{className:"w-4 h-4 mr-1"})," Cancel"]}),e.jsxs("button",{onClick:ae,className:"btn btn-primary btn-sm",disabled:j.isPending,children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),j.isPending?"Saving...":"Save"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-ghost btn-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-1"})," Edit"]}),!h.isDefault&&e.jsxs("button",{onClick:()=>m.mutate(),className:"btn btn-ghost btn-sm",disabled:m.isPending,children:[e.jsx(ee,{className:"w-4 h-4 mr-1"})," Set Default"]}),e.jsxs("button",{onClick:()=>y.mutate(),className:"btn btn-ghost btn-sm",disabled:y.isPending,children:[e.jsx(G,{className:"w-4 h-4 mr-1"})," Duplicate"]}),e.jsxs("button",{onClick:()=>{confirm("Delete this dashboard?")&&d.mutate()},className:"btn btn-ghost btn-sm text-red-400 hover:text-red-300",disabled:d.isPending,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"})," Delete"]})]})})]}),l&&e.jsxs("div",{className:"bg-brand-500/10 border border-brand-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand-400",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Edit Mode"})]}),e.jsx("p",{className:"text-surface-400 text-sm mt-1",children:"Drag widgets to reposition, resize by dragging edges, or click the edit button to configure."})]}),h.widgets.length===0?e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx("div",{className:"text-surface-500 mb-4",children:e.jsx(J,{className:"w-12 h-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-surface-200 mb-2",children:"No widgets yet"}),e.jsx("p",{className:"text-surface-400 mb-4",children:"Add widgets to customize your dashboard"}),e.jsxs("button",{onClick:()=>b(!0),className:"btn btn-primary",children:[e.jsx(O,{className:"w-4 h-4 mr-1"})," Add Widget"]})]}):e.jsx(_e,{widgets:h.widgets,isEditing:l,onLayoutChange:te,onWidgetEdit:ne,onWidgetDelete:ie,onWidgetRefresh:le,dashboardId:s}),u&&e.jsx(Ve,{onSelect:ce,onClose:()=>b(!1)}),i&&r&&e.jsx(We,{widget:r,onSave:oe,onClose:()=>{a(!1),o(null)}})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-surface-400",children:"Dashboard not found"}),e.jsx("button",{onClick:t,className:"btn btn-primary mt-4",children:"Go Back"})]})}function Ue({onClose:s,onSelectTemplate:t}){const n=B(),{data:l,isLoading:c}=P({queryKey:["dashboard-templates"],queryFn:()=>N.getTemplates().then(a=>a.data)}),i=k({mutationFn:a=>N.duplicate(a),onSuccess:a=>{n.invalidateQueries({queryKey:["dashboards"]}),v.success("Template applied! You can now customize your new dashboard."),s(),t(a.data.id)},onError:()=>v.error("Failed to apply template")});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100",children:"Dashboard Templates"}),e.jsx("p",{className:"text-sm text-surface-400",children:"Choose a template to get started quickly"})]}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-surface-200",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-surface-700 rounded-full border-t-brand-500"})}):l?.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-surface-400",children:"No templates available yet"}),e.jsx("p",{className:"text-sm text-surface-500 mt-2",children:"Templates are created by admins and shared across the organization"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l?.map(a=>e.jsxs("div",{className:"bg-surface-800 border border-surface-700 rounded-lg p-4 hover:border-brand-500/50 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-surface-200",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-surface-400 mt-1",children:a.description})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-surface-500 mb-4",children:[e.jsxs("span",{children:[a.widgets?.length||0," widgets"]}),e.jsxs("span",{children:["Created by ",a.creator?.displayName||"Unknown"]})]}),e.jsx("div",{className:"bg-surface-900 rounded p-3 mb-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-1 h-20",children:a.widgets?.slice(0,8).map((r,o)=>e.jsx("div",{className:"bg-surface-700 rounded",style:{gridColumn:`span ${Math.min(r.position.w,2)}`,gridRow:`span ${Math.min(r.position.h,1)}`},title:r.title},r.id||o))})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>t(a.id),className:"btn btn-ghost btn-sm flex-1",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"})," Preview"]}),e.jsxs("button",{onClick:()=>i.mutate(a.id),disabled:i.isPending,className:"btn btn-primary btn-sm flex-1",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),i.isPending?"Applying...":"Use Template"]})]})]},a.id))})}),e.jsx("div",{className:"p-4 border-t border-surface-700 bg-surface-800/50",children:e.jsx("p",{className:"text-sm text-surface-500",children:"Using a template will create a copy that you can customize."})})]})})}function Je(){const s=B(),[t,n]=g.useState(null),[l,c]=g.useState(!1),[i,a]=g.useState(!1),[r,o]=g.useState(""),[u,b]=g.useState(""),{data:x,isLoading:f}=P({queryKey:["dashboards"],queryFn:()=>N.list().then(m=>m.data)}),h=k({mutationFn:m=>N.create(m),onSuccess:m=>{s.invalidateQueries({queryKey:["dashboards"]}),v.success("Dashboard created"),c(!1),o(""),b(""),n(m.data.id)},onError:()=>v.error("Failed to create dashboard")}),w=k({mutationFn:m=>N.delete(m),onSuccess:()=>{s.invalidateQueries({queryKey:["dashboards"]}),v.success("Dashboard deleted")},onError:()=>v.error("Failed to delete dashboard")}),j=k({mutationFn:m=>N.setDefault(m),onSuccess:()=>{s.invalidateQueries({queryKey:["dashboards"]}),v.success("Default dashboard updated")},onError:()=>v.error("Failed to set default")}),D=m=>{m.preventDefault(),r.trim()&&h.mutate({name:r.trim(),description:u.trim()||void 0})};if(t)return e.jsx(Ie,{dashboardId:t,onBack:()=>n(null)});const L=x?.filter(m=>!m.isTemplate)||[],T=x?.filter(m=>m.isTemplate)||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Custom Dashboards"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Create and customize your own dashboard views"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(!0),className:"btn btn-ghost",children:[e.jsx(M,{className:"w-4 h-4 mr-1"})," Browse Templates"]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(O,{className:"w-4 h-4 mr-1"})," New Dashboard"]})]})]}),f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-surface-700 rounded-full border-t-brand-500"})}):L.length===0?e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(M,{className:"w-12 h-12 mx-auto text-surface-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-surface-200 mb-2",children:"No dashboards yet"}),e.jsx("p",{className:"text-surface-400 mb-6",children:"Create a custom dashboard or start from a template"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary",children:[e.jsx(O,{className:"w-4 h-4 mr-1"})," Create Dashboard"]}),e.jsxs("button",{onClick:()=>a(!0),className:"btn btn-ghost",children:[e.jsx(M,{className:"w-4 h-4 mr-1"})," Browse Templates"]})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(m=>e.jsxs("div",{className:E("card p-4 cursor-pointer transition-all hover:border-brand-500/50",m.isDefault&&"ring-2 ring-brand-500/30"),onClick:()=>n(m.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-surface-200",children:m.name}),m.isDefault&&e.jsx(Z,{className:"w-4 h-4 text-yellow-400",title:"Default"})]}),e.jsxs("div",{className:"flex items-center gap-1",onClick:y=>y.stopPropagation(),children:[!m.isDefault&&e.jsx("button",{onClick:()=>j.mutate(m.id),className:"p-1 hover:bg-surface-700 rounded text-surface-400 hover:text-yellow-400",title:"Set as default",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{confirm("Delete this dashboard?")&&w.mutate(m.id)},className:"p-1 hover:bg-red-500/20 rounded text-surface-400 hover:text-red-400",title:"Delete",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),m.description&&e.jsx("p",{className:"text-sm text-surface-400 mb-3 line-clamp-2",children:m.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-surface-500",children:[e.jsxs("span",{children:[m.widgets?.length||0," widgets"]}),e.jsxs("span",{children:["Updated ",new Date(m.updatedAt).toLocaleDateString()]})]}),e.jsx("div",{className:"mt-3 bg-surface-800 rounded p-2",children:e.jsx("div",{className:"grid grid-cols-6 gap-1 h-12",children:m.widgets?.slice(0,6).map((y,d)=>e.jsx("div",{className:"bg-surface-700 rounded",style:{gridColumn:`span ${Math.min(y.position.w,2)}`}},y.id||d))})})]},m.id))}),T.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-200 mb-4",children:"Organization Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.slice(0,3).map(m=>e.jsxs("div",{className:"card p-4 cursor-pointer transition-all hover:border-brand-500/50 opacity-75",onClick:()=>n(m.id),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"badge badge-sm badge-info",children:"Template"}),e.jsx("h3",{className:"font-medium text-surface-200",children:m.name})]}),e.jsxs("p",{className:"text-sm text-surface-400 mb-2",children:[m.widgets?.length||0," widgets"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),N.duplicate(m.id).then(()=>{s.invalidateQueries({queryKey:["dashboards"]}),v.success("Template copied to your dashboards")})},className:"btn btn-ghost btn-sm w-full",children:[e.jsx(G,{className:"w-4 h-4 mr-1"})," Use Template"]})]},m.id))})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-900 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-surface-100 mb-4",children:"Create New Dashboard"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Dashboard Name"}),e.jsx("input",{type:"text",value:r,onChange:m=>o(m.target.value),className:"input w-full",placeholder:"My Custom Dashboard",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Description (optional)"}),e.jsx("textarea",{value:u,onChange:m=>b(m.target.value),className:"input w-full h-20",placeholder:"Dashboard for tracking..."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"btn btn-ghost",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!r.trim()||h.isPending,className:"btn btn-primary",children:h.isPending?"Creating...":"Create"})]})]})]})}),i&&e.jsx(Ue,{onClose:()=>a(!1),onSelectTemplate:m=>{a(!1),n(m)}})]})}export{Je as default};
