import{u as J,r as c,b as R,c as h,j as e,a0 as X,M as Y,l as Z,v as G,a$ as ee,bA as se,a3 as te,aQ as ae,h as re,E as le}from"./vendor-CWk44mA8.js";import{B as N,A as u}from"./index-CiJwl-Bo.js";import{M as P}from"./Modal-BXiMOSLX.js";import{a as ie}from"./Skeleton-DVOICtGK.js";import{E as ne}from"./EmptyState-DqJSE5Oy.js";import{u as oe}from"./useToast-oJzujiun.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const T=[{value:"external_attacker",label:"External Attacker"},{value:"insider_malicious",label:"Malicious Insider"},{value:"insider_negligent",label:"Negligent Insider"},{value:"nation_state",label:"Nation State"},{value:"organized_crime",label:"Organized Crime"},{value:"hacktivist",label:"Hacktivist"},{value:"competitor",label:"Competitor"},{value:"natural_disaster",label:"Natural Disaster"}],$=[{value:"phishing",label:"Phishing"},{value:"malware",label:"Malware"},{value:"social_engineering",label:"Social Engineering"},{value:"brute_force",label:"Brute Force"},{value:"supply_chain",label:"Supply Chain"},{value:"physical",label:"Physical Access"},{value:"insider_access",label:"Insider Access"},{value:"web_application",label:"Web Application"},{value:"network",label:"Network Attack"},{value:"api",label:"API Exploitation"}],F=["Data Breach","System Compromise","Service Disruption","Financial Fraud","Compliance Violation","Reputation Damage","Physical Security","Third Party Risk","Cloud Security","AI/ML Risk","Remote Work","IoT/OT Security"],ce=[{value:"rare",label:"Rare"},{value:"unlikely",label:"Unlikely"},{value:"possible",label:"Possible"},{value:"likely",label:"Likely"},{value:"almost_certain",label:"Almost Certain"}],de=[{value:"negligible",label:"Negligible"},{value:"minor",label:"Minor"},{value:"moderate",label:"Moderate"},{value:"major",label:"Major"},{value:"severe",label:"Severe"}],A=l=>{switch(l){case"critical":return"text-red-500 bg-red-500/20";case"high":return"text-orange-500 bg-orange-500/20";case"medium":return"text-yellow-500 bg-yellow-500/20";case"low":return"text-green-500 bg-green-500/20";default:return"text-surface-400 bg-surface-500/20"}};function ve(){const l=J(),n=oe(),[x,r]=c.useState(""),[i,y]=c.useState(""),[t,g]=c.useState(""),[f,K]=c.useState(!1),[V,b]=c.useState(!1),[p,j]=c.useState(null),[d,E]=c.useState(null),[o,k]=c.useState(null),[m,S]=c.useState({controlEffectiveness:50,mitigations:[]}),{data:z,isLoading:B}=R({queryKey:["risk-scenarios",x,i,t,f],queryFn:async()=>(await u.list({search:x||void 0,category:i||void 0,threatActor:t||void 0,isTemplate:f||void 0})).data}),{data:Q}=R({queryKey:["risk-scenario-library"],queryFn:async()=>(await u.getLibraryByCategory()).data}),{data:U}=R({queryKey:["risk-scenario-stats"],queryFn:async()=>(await u.getStatistics()).data}),M=h({mutationFn:s=>u.create(s),onSuccess:()=>{l.invalidateQueries({queryKey:["risk-scenarios"]}),l.invalidateQueries({queryKey:["risk-scenario-stats"]}),b(!1),n.success("Scenario created successfully")},onError:s=>{n.error(s.message||"Failed to create scenario")}}),q=h({mutationFn:({id:s,data:a})=>u.update(s,a),onSuccess:()=>{l.invalidateQueries({queryKey:["risk-scenarios"]}),j(null),n.success("Scenario updated successfully")},onError:s=>{n.error(s.message||"Failed to update scenario")}}),H=h({mutationFn:s=>u.delete(s),onSuccess:()=>{l.invalidateQueries({queryKey:["risk-scenarios"]}),l.invalidateQueries({queryKey:["risk-scenario-stats"]}),n.success("Scenario deleted successfully")},onError:s=>{n.error(s.message||"Failed to delete scenario")}}),I=h({mutationFn:({id:s,newTitle:a})=>u.clone(s,a),onSuccess:()=>{l.invalidateQueries({queryKey:["risk-scenarios"]}),n.success("Scenario cloned successfully")},onError:s=>{n.error(s.message||"Failed to clone scenario")}}),O=h({mutationFn:({id:s,params:a})=>u.simulate(s,a),onSuccess:s=>{k(s.data)},onError:s=>{n.error(s.message||"Failed to run simulation")}}),L=z?.data||[],C=Q||[],v=U||{total:0,templates:0,byCategory:[],byRiskLevel:[]},W=()=>{d&&O.mutate({id:d.id,params:m})},w=s=>T.find(a=>a.value===s)?.label||s,_=s=>$.find(a=>a.value===s)?.label||s;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(X,{className:"h-7 w-7 text-brand-400"}),"Risk Scenarios"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage risk scenarios and run simulations to analyze potential threats"})]}),e.jsx(N,{onClick:()=>b(!0),leftIcon:e.jsx(Y,{className:"h-5 w-5"}),children:"New Scenario"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Scenarios"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:v.total})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Templates"}),e.jsx("p",{className:"text-2xl font-bold text-brand-400",children:v.templates})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"High/Critical Risk"}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:v.byRiskLevel?.filter(s=>["high","critical"].includes(s.level)).reduce((s,a)=>s+a.count,0)||0})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:v.byCategory?.length||0})]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search scenarios...",value:x,onChange:s=>r(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground"})]})}),e.jsxs("select",{value:i,onChange:s=>y(s.target.value),className:"px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:[e.jsx("option",{value:"",children:"All Categories"}),F.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:t,onChange:s=>g(s.target.value),className:"px-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:[e.jsx("option",{value:"",children:"All Threat Actors"}),T.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("label",{className:"flex items-center gap-2 text-foreground",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>K(s.target.checked),className:"rounded border-surface-600"}),"Templates Only"]})]})}),B?e.jsx(ie,{rows:8,columns:6}):L.length===0?e.jsx(ne,{variant:"chart",title:"No scenarios found",description:"Create your first risk scenario or import from the template library.",action:{label:"Create Scenario",onClick:()=>b(!0)}}):e.jsx("div",{className:"grid gap-4",children:L.map(s=>e.jsx("div",{className:"card p-4 hover:border-brand-500/50 transition-colors cursor-pointer",onClick:()=>j(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.title}),s.isTemplate&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-brand-500/20 text-brand-400 rounded-full",children:"Template"}),s.riskLevel&&e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${A(s.riskLevel)}`,children:s.riskLevel.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4"}),w(s.threatActor)]}),e.jsx("span",{children:_(s.attackVector)}),e.jsx("span",{className:"bg-surface-700 px-2 py-0.5 rounded",children:s.category}),s.tags?.slice(0,3).map(a=>e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),a]},a)),(s.usageCount??0)>0&&e.jsxs("span",{children:["Used ",s.usageCount,"x"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:()=>{E(s),k(null),S({controlEffectiveness:50,mitigations:[]})},className:"p-2 text-surface-400 hover:text-brand-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Run Simulation",children:e.jsx(se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>I.mutate({id:s.id}),className:"p-2 text-surface-400 hover:text-brand-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Clone",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>j(s),className:"p-2 text-surface-400 hover:text-brand-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Edit",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this scenario?")&&H.mutate(s.id)},className:"p-2 text-surface-400 hover:text-red-400 hover:bg-surface-700 rounded-lg transition-colors",title:"Delete",children:e.jsx(re,{className:"h-5 w-5"})})]})]})},s.id))}),C.length>0&&!f&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Scenario Library"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Browse pre-built risk scenarios organized by category. Clone any scenario to customize it for your organization."})]}),e.jsxs("span",{className:"text-xs bg-brand-500/20 text-brand-400 px-2 py-1 rounded-full",children:[C.reduce((s,a)=>s+a.templates.length,0)," scenarios"]})]}),e.jsx("div",{className:"space-y-6",children:C.map(s=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-surface-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-brand-500 rounded-full"}),s.category,e.jsxs("span",{className:"text-xs text-surface-500",children:["(",s.templates.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.templates.map(a=>e.jsxs("div",{className:"bg-surface-700/50 hover:bg-surface-700 rounded-lg p-4 transition-colors group",children:[e.jsx("h5",{className:"font-medium text-foreground text-sm line-clamp-1",children:a.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags?.slice(0,3).map(D=>e.jsx("span",{className:"text-xs bg-surface-600 text-surface-300 px-1.5 py-0.5 rounded",children:D},D))}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-surface-600",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:w(a.threatActor)}),(a.usageCount??0)>0&&e.jsxs("span",{children:["• Used ",a.usageCount,"x"]})]}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>I.mutate({id:a.id}),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:"Use"})]})]},a.id))})]},s.category))})]}),e.jsx(P,{isOpen:V||!!p,onClose:()=>{b(!1),j(null)},title:p?"Edit Scenario":"Create Scenario",size:"lg",children:e.jsx(ue,{scenario:p,onSubmit:s=>{p?q.mutate({id:p.id,data:s}):M.mutate(s)},isLoading:M.isPending||q.isPending})}),e.jsx(P,{isOpen:!!d,onClose:()=>{E(null),k(null)},title:"Risk Simulation",size:"lg",children:d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface-700/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-foreground",children:d.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Threat: ",e.jsx("span",{className:"text-foreground",children:w(d.threatActor)})]}),e.jsxs("span",{className:"text-muted-foreground",children:["Vector: ",e.jsx("span",{className:"text-foreground",children:_(d.attackVector)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:["Control Effectiveness: ",m.controlEffectiveness,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:m.controlEffectiveness,onChange:s=>S({...m,controlEffectiveness:parseInt(s.target.value)}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Mitigations (comma-separated)"}),e.jsx("input",{type:"text",placeholder:"e.g., MFA, Employee Training, Network Segmentation",value:m.mitigations.join(", "),onChange:s=>S({...m,mitigations:s.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground"})]}),e.jsxs(N,{onClick:W,isLoading:O.isPending,children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Run Simulation"]})]}),o&&e.jsxs("div",{className:"bg-surface-800 rounded-lg p-6 border border-surface-700",children:[e.jsx("h4",{className:"font-semibold text-foreground mb-4",children:"Simulation Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Inherent Risk"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-foreground",children:o.inherentRisk.score}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${A(o.inherentRisk.level)}`,children:o.inherentRisk.level.toUpperCase()})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Residual Risk"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-foreground",children:o.residualRisk.score}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${A(o.residualRisk.level)}`,children:o.residualRisk.level.toUpperCase()})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Risk Reduction"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 h-2 bg-surface-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all",style:{width:`${o.riskReduction}%`}})}),e.jsxs("span",{className:"text-green-400 font-semibold",children:[o.riskReduction,"%"]})]})]}),o.recommendations.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Recommendations"}),e.jsx("ul",{className:"space-y-1",children:o.recommendations.map((s,a)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[e.jsx("span",{className:"text-brand-400",children:"•"}),s]},a))})]})]})]})})]})}function ue({scenario:l,onSubmit:n,isLoading:x}){const[r,i]=c.useState({title:l?.title||"",description:l?.description||"",category:l?.category||F[0],threatActor:l?.threatActor||"external_attacker",attackVector:l?.attackVector||"phishing",targetAssets:l?.targetAssets?.join(", ")||"",likelihood:l?.likelihood||"possible",impact:l?.impact||"moderate",tags:l?.tags?.join(", ")||"",isTemplate:l?.isTemplate||!1,mitigationStrategy:l?.mitigationStrategy||"",businessContext:l?.businessContext||"",complianceImpact:l?.complianceImpact||""}),y=t=>{t.preventDefault(),n({...r,targetAssets:r.targetAssets.split(",").map(g=>g.trim()).filter(Boolean),tags:r.tags.split(",").map(g=>g.trim()).filter(Boolean)})};return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Title *"}),e.jsx("input",{type:"text",required:!0,value:r.title,onChange:t=>i({...r,title:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",placeholder:"e.g., Phishing Attack on Employees"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Description *"}),e.jsx("textarea",{required:!0,rows:3,value:r.description,onChange:t=>i({...r,description:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",placeholder:"Describe the risk scenario in detail..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Category *"}),e.jsx("select",{required:!0,value:r.category,onChange:t=>i({...r,category:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:F.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Threat Actor *"}),e.jsx("select",{required:!0,value:r.threatActor,onChange:t=>i({...r,threatActor:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:T.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Attack Vector *"}),e.jsx("select",{required:!0,value:r.attackVector,onChange:t=>i({...r,attackVector:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Target Assets"}),e.jsx("input",{type:"text",value:r.targetAssets,onChange:t=>i({...r,targetAssets:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",placeholder:"e.g., Email System, Database (comma-separated)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Likelihood *"}),e.jsx("select",{required:!0,value:r.likelihood,onChange:t=>i({...r,likelihood:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:ce.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Impact *"}),e.jsx("select",{required:!0,value:r.impact,onChange:t=>i({...r,impact:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",children:de.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Tags"}),e.jsx("input",{type:"text",value:r.tags,onChange:t=>i({...r,tags:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",placeholder:"e.g., critical, compliance, data (comma-separated)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Mitigation Strategy"}),e.jsx("textarea",{rows:2,value:r.mitigationStrategy,onChange:t=>i({...r,mitigationStrategy:t.target.value}),className:"w-full px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-foreground",placeholder:"Describe how this risk can be mitigated..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isTemplate",checked:r.isTemplate,onChange:t=>i({...r,isTemplate:t.target.checked}),className:"rounded border-surface-600"}),e.jsx("label",{htmlFor:"isTemplate",className:"text-sm text-foreground",children:"Save as template (available for reuse)"})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:e.jsx(N,{type:"submit",isLoading:x,children:l?"Update Scenario":"Create Scenario"})})]})}export{ve as default};
