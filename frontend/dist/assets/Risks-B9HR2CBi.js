import{k as Z,u as ee,aK as se,r as o,b0 as ae,b as O,c as te,j as e,b1 as V,b2 as re,B as h,b3 as z,b4 as le,b5 as ie,b6 as ne,b7 as C,b8 as ce}from"./vendor-CWk44mA8.js";import{a as oe,o as de,b as ue,n as K,s as m}from"./vendor-zod-BDhom4hV.js";import{n as me,w as xe,B as g,x as R}from"./index-CiJwl-Bo.js";import{u as pe}from"./useToast-oJzujiun.js";import{u as be}from"./useDebounce-BWtFJvQ9.js";import{u as he,A as ge,c as fe}from"./AdvancedFilters-BfP-VL-m.js";import{F as d,I as N,T as ve,S as _}from"./Form-uXUmRGSk.js";import{e as je,a as ye}from"./Skeleton-DVOICtGK.js";import{E as Ne}from"./ExportDropdown-ClBGGM80.js";import{e as ke}from"./export-DqfI3kh9.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const we=[{key:"title",label:"Title",type:"string"},{key:"category",label:"Category",type:"select",options:[{value:"security",label:"Security"},{value:"compliance",label:"Compliance"},{value:"operational",label:"Operational"},{value:"financial",label:"Financial"},{value:"strategic",label:"Strategic"},{value:"reputational",label:"Reputational"}]},{key:"status",label:"Status",type:"select",options:[{value:"identified",label:"Identified"},{value:"assessing",label:"Assessing"},{value:"treating",label:"Treating"},{value:"monitoring",label:"Monitoring"},{value:"closed",label:"Closed"}]},{key:"riskLevel",label:"Risk Level",type:"select",options:[{value:"critical",label:"Critical"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}]},{key:"likelihood",label:"Likelihood",type:"select",options:[{value:"rare",label:"Rare"},{value:"unlikely",label:"Unlikely"},{value:"possible",label:"Possible"},{value:"likely",label:"Likely"},{value:"almost_certain",label:"Almost Certain"}]},{key:"impact",label:"Impact",type:"select",options:[{value:"negligible",label:"Negligible"},{value:"minor",label:"Minor"},{value:"moderate",label:"Moderate"},{value:"significant",label:"Significant"},{value:"severe",label:"Severe"}]},{key:"owner",label:"Owner",type:"string"}],Se=de({title:m().min(1,"Title is required").max(200,"Title must be less than 200 characters"),description:m().min(1,"Description is required").max(2e3,"Description must be less than 2000 characters"),category:m().min(1,"Category is required"),likelihood:m().min(1,"Likelihood is required"),impact:m().min(1,"Impact is required"),likelihoodPct:K().min(0).max(100).optional().nullable(),impactValue:K().min(0).optional().nullable(),tags:ue(m()).optional()}),$=[{value:"operational",label:"Operational"},{value:"strategic",label:"Strategic"},{value:"compliance",label:"Compliance"},{value:"security",label:"Security"},{value:"financial",label:"Financial"}],Ce=[{value:"risk_identified",label:"Identified",stage:"intake"},{value:"not_a_risk",label:"Not a Risk",stage:"intake"},{value:"actual_risk",label:"Validated",stage:"intake"},{value:"risk_analysis_in_progress",label:"Analysis In Progress",stage:"assessment"},{value:"risk_analyzed",label:"Analyzed",stage:"assessment"},{value:"open",label:"Open",stage:"intake"},{value:"in_treatment",label:"In Treatment",stage:"treatment"},{value:"accepted",label:"Accepted",stage:"treatment"},{value:"mitigated",label:"Mitigated",stage:"treatment"},{value:"closed",label:"Closed",stage:"complete"}],H=[{value:"very_low",label:"Very Low",color:"bg-emerald-600"},{value:"low",label:"Low",color:"bg-emerald-500"},{value:"medium",label:"Medium",color:"bg-amber-500"},{value:"high",label:"High",color:"bg-orange-500"},{value:"very_high",label:"Very High",color:"bg-red-600"},{value:"critical",label:"Critical",color:"bg-red-500"}],Re=[{value:"rare",label:"Rare"},{value:"unlikely",label:"Unlikely"},{value:"possible",label:"Possible"},{value:"likely",label:"Likely"},{value:"almost_certain",label:"Almost Certain"}],_e=[{value:"negligible",label:"Negligible"},{value:"minor",label:"Minor"},{value:"moderate",label:"Moderate"},{value:"major",label:"Major"},{value:"severe",label:"Severe"}];function $e(){const k=Z(),U=ee(),[i,w]=se(),I=pe(),f=me(),{prefetchRisk:Q}=he(),{isModuleEnabled:B}=xe(),L=B("ai"),[Ie,Le]=o.useState(!1),[G,v]=o.useState(!1),[a,x]=o.useState("all"),[j,T]=o.useState(""),[S,y]=o.useState([]),[A,W]=o.useState(i.get("search")||""),p=be(A,300),t=ae({resolver:oe(Se),defaultValues:{title:"",description:"",category:"security",likelihood:"possible",impact:"moderate",likelihoodPct:null,impactValue:null,tags:[]}}),r=o.useMemo(()=>({search:p,category:i.get("category")||"",status:i.get("status")||"",riskLevel:i.get("riskLevel")||"",page:parseInt(i.get("page")||"1",10),statFilter:a}),[p,i,a]),u=o.useCallback((s,c)=>{const l=new URLSearchParams(i);c?l.set(s,c):l.delete(s),s!=="page"&&l.set("page","1"),w(l)},[i,w]);o.useEffect(()=>{const s=i.get("search")||"";p!==s&&u("search",p)},[p]);const{data:n,isLoading:M}=O({queryKey:["risks",r,f],queryFn:async()=>{const s={page:r.page,limit:25};return r.search&&(s.search=r.search),r.category&&(s.category=r.category),r.status&&(s.status=r.status),r.riskLevel&&(s.riskLevel=r.riskLevel),f&&(s.workspaceId=f),a==="open"?s.isOpen="true":a==="mitigated"?s.status="mitigated":a==="reviews_due"&&(s.reviewsDue="true"),(await R.list(s)).data}}),{data:b}=O({queryKey:["risks","dashboard",f],queryFn:async()=>(await R.getDashboard()).data}),P=te({mutationFn:async s=>{const c={...s,likelihoodPct:s.likelihoodPct??void 0,impactValue:s.impactValue??void 0,tags:S};return(await R.create(c)).data},onSuccess:s=>{U.invalidateQueries({queryKey:["risks"]}),v(!1),t.reset(),y([]),I.success(`Risk "${s.riskId}" created successfully`)},onError:s=>{I.error(s)}}),X=s=>{P.mutate(s)},E=s=>H.find(l=>l.value===s)?.color||"bg-gray-500",J=s=>{switch(s){case"risk_identified":return"bg-purple-500/20 text-purple-400";case"not_a_risk":return"bg-surface-500/20 text-surface-400";case"actual_risk":return"bg-blue-500/20 text-blue-400";case"risk_analysis_in_progress":return"bg-cyan-500/20 text-cyan-400";case"risk_analyzed":return"bg-indigo-500/20 text-indigo-400";case"open":return"bg-red-500/20 text-red-400";case"in_treatment":return"bg-amber-500/20 text-amber-400";case"accepted":return"bg-blue-500/20 text-blue-400";case"mitigated":return"bg-emerald-500/20 text-emerald-400";case"closed":return"bg-surface-500/20 text-surface-400";default:return"bg-surface-500/20 text-surface-400"}},F=()=>{j.trim()&&!S.includes(j.trim())&&(y(s=>[...s,j.trim()]),T(""))},Y=s=>{y(c=>c.filter(l=>l!==s))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Risk Register"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Identify, assess, and manage organizational risks"}),L&&e.jsx("p",{className:"text-xs text-brand-400 mt-1",children:"AI assistance is available for risk analysis and treatment planning."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ge,{fields:we,onApply:s=>{const c=fe(s),l=new URLSearchParams(i);Object.entries(c).forEach(([q,D])=>{D?l.set(q,D):l.delete(q)}),w(l,{replace:!0})},storageKey:"risks"}),e.jsx(Ne,{data:n?.risks||[],columns:ke.risks,filename:"risks",sheetName:"Risks",disabled:M||!n?.risks?.length}),L&&e.jsxs(g,{type:"button",variant:"secondary",onClick:()=>{k("/tools/ai-risk-assistant")},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"AI Risk Assistant"]}),e.jsx(g,{onClick:()=>v(!0),leftIcon:e.jsx(re,{className:"w-4 h-4"}),className:"bg-brand-500 hover:bg-brand-600",children:"Add Risk"})]})]}),b?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>x("all"),className:h("bg-surface-800 rounded-xl border p-4 text-left transition-all",a==="all"?"border-brand-500 ring-2 ring-brand-500":"border-surface-700 hover:bg-surface-700/50 cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-500/20 rounded-lg",children:e.jsx(z,{className:"w-5 h-5 text-brand-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Total Risks"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.totalRisks})]})]}),a!=="all"&&e.jsx("p",{className:"text-xs text-brand-400 mt-2",children:"Click to show all"})]}),e.jsxs("button",{onClick:()=>x(a==="open"?"all":"open"),className:h("bg-surface-800 rounded-xl border p-4 text-left transition-all",a==="open"?"border-red-500 ring-2 ring-red-500":"border-surface-700 hover:bg-surface-700/50 cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/20 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Open Risks"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.openRisks})]})]}),a==="open"&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:"Click to clear filter"})]}),e.jsxs("button",{onClick:()=>x(a==="reviews_due"?"all":"reviews_due"),className:h("bg-surface-800 rounded-xl border p-4 text-left transition-all",a==="reviews_due"?"border-amber-500 ring-2 ring-amber-500":"border-surface-700 hover:bg-surface-700/50 cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/20 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Reviews Due"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.upcomingReviews?.length||0})]})]}),a==="reviews_due"&&e.jsx("p",{className:"text-xs text-amber-400 mt-2",children:"Click to clear filter"})]}),e.jsxs("button",{onClick:()=>x(a==="mitigated"?"all":"mitigated"),className:h("bg-surface-800 rounded-xl border p-4 text-left transition-all",a==="mitigated"?"border-emerald-500 ring-2 ring-emerald-500":"border-surface-700 hover:bg-surface-700/50 cursor-pointer"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-surface-400",children:"Mitigated"}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:b.byStatus?.find(s=>s.status==="mitigated")?.count||0})]})]}),a==="mitigated"&&e.jsx("p",{className:"text-xs text-emerald-400 mt-2",children:"Click to clear filter"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(je,{className:"bg-surface-800 border border-surface-700"},s))}),a!=="all"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-surface-400",children:"Filtering by:"}),e.jsxs("span",{className:h("px-2 py-1 rounded-full text-xs font-medium",a==="open"&&"bg-red-500/20 text-red-400",a==="reviews_due"&&"bg-amber-500/20 text-amber-400",a==="mitigated"&&"bg-emerald-500/20 text-emerald-400"),children:[a==="open"&&"Open Risks",a==="reviews_due"&&"Reviews Due",a==="mitigated"&&"Mitigated Risks"]}),e.jsxs("span",{className:"text-surface-500",children:["(",n?.total||0," results)"]}),e.jsx("button",{onClick:()=>x("all"),className:"text-surface-400 hover:text-surface-100 ml-2",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-surface-800 rounded-xl border border-surface-700 p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-400"}),e.jsx("input",{type:"text",placeholder:"Search risks...",value:A,onChange:s=>W(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white placeholder-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:r.category,onChange:s=>u("category",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Categories"}),$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{value:r.status,onChange:s=>u("status",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),Ce.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{value:r.riskLevel,onChange:s=>u("riskLevel",s.target.value),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:"All Risk Levels"}),H.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("button",{onClick:()=>k("/risks/heatmap"),className:"px-3 py-2 bg-surface-700 border border-surface-600 rounded-lg text-surface-300 hover:text-white hover:bg-surface-600 transition-colors flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Heatmap"]})]})]})}),e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 overflow-hidden",children:[M?e.jsx(ye,{rows:8,columns:8,className:"border-none shadow-none"}):n?.risks.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(z,{className:"w-12 h-12 text-surface-500 mx-auto mb-4"}),e.jsx("p",{className:"text-surface-400",children:"No risks found"}),e.jsx("p",{className:"text-surface-500 text-sm mt-2",children:"Create your first risk to get started"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-surface-700",children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Risk ID"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Title"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Category"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Inherent Risk"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-surface-400",children:"Residual Risk"}),e.jsx("th",{className:"text-center px-4 py-3 text-sm font-medium text-surface-400",children:"Assets"}),e.jsx("th",{className:"text-center px-4 py-3 text-sm font-medium text-surface-400",children:"Controls"})]})}),e.jsx("tbody",{children:n?.risks.map(s=>e.jsxs("tr",{onClick:()=>k(`/risks/${s.id}`),onMouseEnter:()=>Q(s.id),className:"border-b border-surface-700 hover:bg-surface-700/50 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-brand-400 font-mono text-sm",children:s.riskId})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.title}),e.jsx("p",{className:"text-surface-400 text-sm truncate max-w-md",children:s.description})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-surface-300 capitalize",children:s.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${J(s.status)}`,children:s.status.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${E(s.inherentRisk||"")}`}),e.jsx("span",{className:"text-surface-300 capitalize",children:s.inherentRisk})]})}),e.jsx("td",{className:"px-4 py-3",children:s.residualRisk?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${E(s.residualRisk)}`}),e.jsx("span",{className:"text-surface-300 capitalize",children:s.residualRisk})]}):e.jsx("span",{className:"text-surface-500",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-surface-300",children:s.assetCount})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-surface-300",children:s.controlCount})})]},s.id))})]}),n&&n.total>25&&e.jsxs("div",{className:"px-4 py-3 border-t border-surface-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-surface-400",children:["Showing ",(r.page-1)*25+1," to"," ",Math.min(r.page*25,n.total)," of ",n.total," risks"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("page",String(r.page-1)),disabled:r.page===1,className:"px-3 py-1 bg-surface-700 rounded text-surface-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-surface-600",children:"Previous"}),e.jsx("button",{onClick:()=>u("page",String(r.page+1)),disabled:r.page*25>=n.total,className:"px-3 py-1 bg-surface-700 rounded text-surface-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-surface-600",children:"Next"})]})]})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-xl border border-surface-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Create New Risk"}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-surface-700 rounded-lg text-surface-400",children:e.jsx(C,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:t.handleSubmit(X),className:"p-6 space-y-4",children:[e.jsx(d,{label:"Title",error:t.formState.errors.title,required:!0,children:e.jsx(N,{...t.register("title"),error:!!t.formState.errors.title,placeholder:"e.g., Data breach from unauthorized access"})}),e.jsx(d,{label:"Description",error:t.formState.errors.description,required:!0,children:e.jsx(ve,{...t.register("description"),rows:3,error:!!t.formState.errors.description,placeholder:"Describe the risk in detail..."})}),e.jsx(d,{label:"Category",error:t.formState.errors.category,required:!0,children:e.jsx(_,{...t.register("category"),error:!!t.formState.errors.category,children:$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Likelihood",error:t.formState.errors.likelihood,required:!0,children:e.jsx(_,{...t.register("likelihood"),error:!!t.formState.errors.likelihood,children:Re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx(d,{label:"Impact",error:t.formState.errors.impact,required:!0,children:e.jsx(_,{...t.register("impact"),error:!!t.formState.errors.impact,children:_e.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Likelihood % (Optional)",hint:"0-100",children:e.jsx(N,{type:"number",min:"0",max:"100",...t.register("likelihoodPct",{valueAsNumber:!0}),placeholder:"0-100"})}),e.jsx(d,{label:"Impact Value $ (Optional)",children:e.jsx(N,{type:"number",min:"0",...t.register("impactValue",{valueAsNumber:!0}),placeholder:"Dollar amount"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-2",children:"Tags"}),e.jsx("div",{className:"flex gap-2 mb-2 flex-wrap",children:S.map(s=>e.jsxs("span",{className:"px-2 py-1 bg-brand-500/20 text-brand-400 rounded text-sm flex items-center gap-1",children:[s,e.jsx("button",{type:"button",onClick:()=>Y(s),className:"hover:text-brand-300",children:e.jsx(C,{className:"w-3 h-3"})})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{type:"text",value:j,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),F()),placeholder:"Add tag...",className:"flex-1"}),e.jsx(g,{type:"button",variant:"secondary",onClick:F,children:"Add"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-surface-700",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:()=>{v(!1),t.reset(),y([])},children:"Cancel"}),e.jsx(g,{type:"submit",isLoading:P.isPending,loadingText:"Creating...",children:"Create Risk"})]})]})]})})]})}export{$e as default};
