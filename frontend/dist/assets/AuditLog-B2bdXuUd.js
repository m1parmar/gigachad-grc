import{aK as I,r as b,b as y,j as e,aJ as A,l as E,B as D,aL as L,ay as F,m as $,bQ as o,aa as U,au as O,aC as M,aR as P,V as _,bR as B,am as q,aD as T}from"./vendor-CWk44mA8.js";import{z as f}from"./index-CiJwl-Bo.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const z={created:{color:"text-green-400",bg:"bg-green-500/10"},uploaded:{color:"text-green-400",bg:"bg-green-500/10"},updated:{color:"text-blue-400",bg:"bg-blue-500/10"},deleted:{color:"text-red-400",bg:"bg-red-500/10"},linked:{color:"text-purple-400",bg:"bg-purple-500/10"},unlinked:{color:"text-orange-400",bg:"bg-orange-500/10"},status_changed:{color:"text-yellow-400",bg:"bg-yellow-500/10"},reviewed:{color:"text-cyan-400",bg:"bg-cyan-500/10"},approved:{color:"text-green-400",bg:"bg-green-500/10"},rejected:{color:"text-red-400",bg:"bg-red-500/10"},synced:{color:"text-indigo-400",bg:"bg-indigo-500/10"},tested:{color:"text-teal-400",bg:"bg-teal-500/10"},version_created:{color:"text-blue-400",bg:"bg-blue-500/10"},bulk_uploaded:{color:"text-green-400",bg:"bg-green-500/10"}},J={control:o,evidence:o,policy:o,framework:o,integration:F,task:U,comment:o};function v(a){return new Date(a).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function K(a){const u=new Date,p=new Date(a),x=u.getTime()-p.getTime(),m=Math.floor(x/6e4),h=Math.floor(x/36e5),s=Math.floor(x/864e5);return m<1?"Just now":m<60?`${m}m ago`:h<24?`${h}h ago`:s<7?`${s}d ago`:v(a)}function Y(){const[a,u]=I(),[p,x]=b.useState(!1),[m,h]=b.useState(null),s=b.useMemo(()=>({search:a.get("search")||"",entityType:a.get("entityType")||"",action:a.get("action")||"",userId:a.get("userId")||"",startDate:a.get("startDate")||"",endDate:a.get("endDate")||"",page:parseInt(a.get("page")||"1"),limit:parseInt(a.get("limit")||"50")}),[a]),n=(t,i)=>{const c=new URLSearchParams(a);i===""||i===0?c.delete(t):c.set(t,String(i)),t!=="page"&&c.delete("page"),u(c)},R=()=>{u(new URLSearchParams)},{data:w,isLoading:S,refetch:C}=y({queryKey:["audit-logs",s],queryFn:()=>f.list(s).then(t=>t.data)}),{data:j}=y({queryKey:["audit-filters"],queryFn:()=>f.getFilters().then(t=>t.data)}),{data:d}=y({queryKey:["audit-stats",s.startDate,s.endDate],queryFn:()=>f.getStats(s.startDate,s.endDate).then(t=>t.data)}),k=async()=>{try{const t=await f.export({entityType:s.entityType||void 0,action:s.action||void 0,userId:s.userId||void 0,startDate:s.startDate||void 0,endDate:s.endDate||void 0}),i=new Blob([t.data],{type:"text/csv"}),c=window.URL.createObjectURL(i),l=document.createElement("a");l.href=c,l.download=`audit-log-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(c),T.success("Audit log exported successfully")}catch{T.error("Failed to export audit log")}},g=w?.data||[],r=w?.pagination||{page:1,limit:50,total:0,pages:1},N=s.entityType||s.action||s.userId||s.startDate||s.endDate;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-surface-100",children:"Audit Log"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Track all actions and changes across your GRC platform"})]}),e.jsxs("button",{onClick:k,className:"btn-secondary flex items-center gap-2",disabled:g.length===0,children:[e.jsx(A,{className:"w-4 h-4"}),"Export CSV"]})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-sm text-surface-400",children:"Total Events"}),e.jsx("div",{className:"text-2xl font-bold text-surface-100 mt-1",children:d.totalLogs?.toLocaleString()})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-sm text-surface-400",children:"Top Action"}),e.jsx("div",{className:"text-2xl font-bold text-surface-100 mt-1 capitalize",children:d.actionBreakdown?.[0]?.action||"-"}),e.jsxs("div",{className:"text-xs text-surface-500",children:[d.actionBreakdown?.[0]?.count?.toLocaleString()," events"]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-sm text-surface-400",children:"Top Entity Type"}),e.jsx("div",{className:"text-2xl font-bold text-surface-100 mt-1 capitalize",children:d.entityTypeBreakdown?.[0]?.entityType||"-"}),e.jsxs("div",{className:"text-xs text-surface-500",children:[d.entityTypeBreakdown?.[0]?.count?.toLocaleString()," events"]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"text-sm text-surface-400",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-bold text-surface-100 mt-1",children:d.topUsers?.length||0})]})]}),e.jsxs("div",{className:"card p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-500"}),e.jsx("input",{type:"text",placeholder:"Search by description or entity name...",value:s.search,onChange:t=>n("search",t.target.value),className:"input pl-10 w-full"})]}),e.jsxs("button",{onClick:()=>x(!p),className:D("btn-secondary flex items-center gap-2",N&&"ring-2 ring-brand-500"),children:[e.jsx(L,{className:"w-4 h-4"}),"Filters",N&&e.jsx("span",{className:"bg-brand-500 text-white text-xs px-1.5 rounded-full",children:[s.entityType,s.action,s.userId,s.startDate].filter(Boolean).length})]}),e.jsx("button",{onClick:()=>C(),className:"btn-secondary p-2",title:"Refresh",children:e.jsx(F,{className:"w-5 h-5"})})]}),p&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 pt-4 border-t border-surface-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"Entity Type"}),e.jsxs("select",{value:s.entityType,onChange:t=>n("entityType",t.target.value),className:"input w-full",children:[e.jsx("option",{value:"",children:"All Types"}),j?.entityTypes?.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"Action"}),e.jsxs("select",{value:s.action,onChange:t=>n("action",t.target.value),className:"input w-full",children:[e.jsx("option",{value:"",children:"All Actions"}),j?.actions?.map(t=>e.jsx("option",{value:t,children:t.replace("_"," ").charAt(0).toUpperCase()+t.replace("_"," ").slice(1)},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"User"}),e.jsxs("select",{value:s.userId,onChange:t=>n("userId",t.target.value),className:"input w-full",children:[e.jsx("option",{value:"",children:"All Users"}),j?.users?.map(t=>e.jsx("option",{value:t.id,children:t.name||t.email},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:s.startDate,onChange:t=>n("startDate",t.target.value),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>n("endDate",t.target.value),className:"input w-full"})]}),N&&e.jsx("div",{className:"md:col-span-5 flex justify-end",children:e.jsxs("button",{onClick:R,className:"text-sm text-surface-400 hover:text-surface-200 flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),"Clear all filters"]})})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-surface-800",children:[e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3",children:"Timestamp"}),e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3",children:"User"}),e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3",children:"Action"}),e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3",children:"Entity"}),e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3",children:"Description"}),e.jsx("th",{className:"text-left text-sm font-medium text-surface-400 px-4 py-3 w-10"})]})}),e.jsx("tbody",{children:S?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-12 text-surface-500",children:"Loading..."})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-12 text-surface-500",children:"No audit logs found"})}):g.map(t=>{const i=z[t.action]||{color:"text-surface-400",bg:"bg-surface-800"},c=J[t.entityType]||o,l=m===t.id;return e.jsxs(O.Fragment,{children:[e.jsxs("tr",{className:"border-b border-surface-800/50 hover:bg-surface-800/30 transition-colors cursor-pointer",onClick:()=>h(l?null:t.id),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm text-surface-200",title:v(t.timestamp),children:K(t.timestamp)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-surface-700 flex items-center justify-center",children:e.jsx(M,{className:"w-4 h-4 text-surface-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-surface-200",children:t.userName||"System"}),t.userEmail&&e.jsx("div",{className:"text-xs text-surface-500",children:t.userEmail})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:D("px-2 py-1 rounded text-xs font-medium",i.bg,i.color),children:t.action.replace("_"," ")})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-surface-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-surface-300 capitalize",children:t.entityType}),t.entityName&&e.jsx("div",{className:"text-xs text-surface-500 truncate max-w-[200px]",title:t.entityName,children:t.entityName})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm text-surface-300 truncate max-w-[300px]",title:t.description,children:t.description})}),e.jsx("td",{className:"px-4 py-3",children:l?e.jsx(P,{className:"w-4 h-4 text-surface-500"}):e.jsx(_,{className:"w-4 h-4 text-surface-500"})})]}),l&&e.jsx("tr",{className:"bg-surface-800/20",children:e.jsx("td",{colSpan:6,className:"px-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-surface-300",children:"Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-500",children:"Event ID:"}),e.jsx("span",{className:"text-surface-300 font-mono text-xs",children:t.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-500",children:"Timestamp:"}),e.jsx("span",{className:"text-surface-300",children:v(t.timestamp)})]}),t.ipAddress&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-500",children:"IP Address:"}),e.jsx("span",{className:"text-surface-300 font-mono",children:t.ipAddress})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-surface-500",children:"Entity ID:"}),e.jsx("span",{className:"text-surface-300 font-mono text-xs",children:t.entityId})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[t.changes&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-sm font-medium text-surface-300",children:"Changes"}),e.jsx("pre",{className:"text-xs text-surface-400 bg-surface-900/50 p-3 rounded-lg overflow-auto max-h-[200px]",children:JSON.stringify(t.changes,null,2)})]}),t.metadata&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-sm font-medium text-surface-300",children:"Metadata"}),e.jsx("pre",{className:"text-xs text-surface-400 bg-surface-900/50 p-3 rounded-lg overflow-auto max-h-[200px]",children:JSON.stringify(t.metadata,null,2)})]})]})]})})})]},t.id)})})]})}),r.pages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-surface-800",children:[e.jsxs("div",{className:"text-sm text-surface-500",children:["Showing ",(r.page-1)*r.limit+1," to"," ",Math.min(r.page*r.limit,r.total)," of"," ",r.total.toLocaleString()," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n("page",r.page-1),disabled:r.page<=1,className:"btn-secondary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-surface-400",children:["Page ",r.page," of ",r.pages]}),e.jsx("button",{onClick:()=>n("page",r.page+1),disabled:r.page>=r.pages,className:"btn-secondary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(q,{className:"w-4 h-4"})})]})]})]})]})}export{Y as default};
