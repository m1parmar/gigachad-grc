import{u as k,r as u,b as G,c as y,j as e,M as P,J as A,aA as F,h as E,m as M,f as S}from"./vendor-CWk44mA8.js";import{I as x}from"./index-CiJwl-Bo.js";import{d as R}from"./Skeleton-DVOICtGK.js";import{E as q}from"./EmptyState-DqJSE5Oy.js";import"./vendor-http-B9ygI19o.js";import"./vendor-date-CWdg4M78.js";const $=[{id:"controls",label:"Controls",description:"Security and compliance controls"},{id:"evidence",label:"Evidence",description:"Evidence artifacts and documents"},{id:"policies",label:"Policies",description:"Policy documents and lifecycle"},{id:"frameworks",label:"Frameworks",description:"Compliance frameworks"},{id:"integrations",label:"Integrations",description:"Third-party integrations"},{id:"audit_logs",label:"Audit Logs",description:"System audit logs"},{id:"users",label:"Users",description:"User management"},{id:"permissions",label:"Permissions",description:"Roles and permissions"},{id:"settings",label:"Settings",description:"System settings"},{id:"dashboard",label:"Dashboard",description:"Dashboard and analytics"}],f=["read","create","update","delete","assign","approve","export"];function J(){const a=k(),[o,l]=u.useState(!1),[c,i]=u.useState(null),[m,b]=u.useState(null),{data:h,isLoading:j}=G({queryKey:["permission-groups"],queryFn:()=>x.listGroups().then(t=>t.data)}),g=y({mutationFn:t=>x.deleteGroup(t),onSuccess:()=>{a.invalidateQueries({queryKey:["permission-groups"]})}}),p=y({mutationFn:()=>x.seedDefaults(),onSuccess:()=>{a.invalidateQueries({queryKey:["permission-groups"]})}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Permission Groups"}),e.jsx("p",{className:"text-surface-400 mt-1",children:"Define roles and their access levels"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p.mutate(),className:"px-4 py-2 bg-surface-700 text-white rounded-lg hover:bg-surface-600 transition-colors",children:"Seed Defaults"}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),"Create Group"]})]})]}),j?e.jsx(R,{count:6}):h?.length===0?e.jsx(q,{variant:"users",title:"No Permission Groups",description:"Create your first permission group or seed the defaults to get started.",action:{label:"Seed Default Groups",onClick:()=>p.mutate()},secondaryAction:{label:"Create Custom Group",onClick:()=>l(!0)}}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:h?.map(t=>e.jsxs("div",{className:"bg-surface-800 rounded-lg border border-surface-700 p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.name}),t.isSystem&&e.jsx("span",{className:"text-xs bg-surface-600 text-surface-300 px-2 py-0.5 rounded",children:"System"})]}),e.jsx("p",{className:"text-surface-400 text-sm mt-1",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>b(t),className:"p-2 text-surface-400 hover:text-white hover:bg-surface-700 rounded-lg",title:"View Members",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>i(t),className:"p-2 text-surface-400 hover:text-white hover:bg-surface-700 rounded-lg",title:"Edit Group",children:e.jsx(F,{className:"w-5 h-5"})}),!t.isSystem&&e.jsx("button",{onClick:()=>{confirm(`Delete permission group "${t.name}"?`)&&g.mutate(t.id)},className:"p-2 text-surface-400 hover:text-red-400 hover:bg-surface-700 rounded-lg",title:"Delete Group",children:e.jsx(E,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-surface-500 uppercase tracking-wider",children:"Permissions"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.permissions.slice(0,6).map((N,w)=>e.jsxs("span",{className:"px-2 py-1 bg-surface-700 rounded text-xs text-surface-200",children:[N.resource,": ",N.actions.length," actions"]},w)),t.permissions.length>6&&e.jsxs("span",{className:"px-2 py-1 text-xs text-surface-400",children:["+",t.permissions.length-6," more"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-700 flex items-center justify-between text-sm text-surface-400",children:[e.jsxs("span",{children:[t.memberCount," member",t.memberCount!==1?"s":""]}),e.jsxs("span",{children:["Updated ",new Date(t.updatedAt).toLocaleDateString()]})]})]},t.id))}),(o||c)&&e.jsx(L,{group:c,onClose:()=>{l(!1),i(null)}}),m&&e.jsx(K,{group:m,onClose:()=>b(null)})]})}function L({group:a,onClose:o}){const l=k(),[c,i]=u.useState(a?.name||""),[m,b]=u.useState(a?.description||""),[h,j]=u.useState(a?.permissions.reduce((s,r)=>({...s,[r.resource]:r.actions}),{})||{}),g=y({mutationFn:s=>x.createGroup(s),onSuccess:()=>{l.invalidateQueries({queryKey:["permission-groups"]}),o()}}),p=y({mutationFn:s=>x.updateGroup(a.id,s),onSuccess:()=>{l.invalidateQueries({queryKey:["permission-groups"]}),o()}}),t=(s,r)=>{j(n=>{const d=n[s]||[];if(d.includes(r)){const v=d.filter(C=>C!==r);if(v.length===0){const{[s]:C,...D}=n;return D}return{...n,[s]:v}}return{...n,[s]:[...d,r]}})},N=s=>{j(r=>{if((r[s]||[]).length===f.length){const{[s]:d,...v}=r;return v}return{...r,[s]:[...f]}})},w=()=>{const s=Object.entries(h).filter(([r,n])=>n.length>0).map(([r,n])=>({resource:r,actions:n,scope:{ownership:"all"}}));a?p.mutate({name:c,description:m,permissions:s}):g.mutate({name:c,description:m,permissions:s})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:a?"Edit Permission Group":"Create Permission Group"}),e.jsx("button",{onClick:o,className:"p-1 text-surface-400 hover:text-white",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"Group Name"}),e.jsx("input",{type:"text",value:c,onChange:s=>i(s.target.value),className:"w-full bg-surface-900 border border-surface-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"e.g., Compliance Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:m,onChange:s=>b(s.target.value),className:"w-full bg-surface-900 border border-surface-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"Brief description of this role"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-surface-400 mb-3",children:"Permission Matrix"}),e.jsx("div",{className:"bg-surface-900 rounded-lg border border-surface-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-surface-800",children:[e.jsx("th",{className:"text-left text-surface-400 font-medium px-4 py-3 w-48",children:"Resource"}),f.map(s=>e.jsx("th",{className:"text-center text-surface-400 font-medium px-2 py-3 text-xs uppercase",children:s},s)),e.jsx("th",{className:"text-center text-surface-400 font-medium px-2 py-3 text-xs uppercase",children:"All"})]})}),e.jsx("tbody",{className:"divide-y divide-surface-700",children:$.map(s=>{const r=h[s.id]||[],n=r.length===f.length;return e.jsxs("tr",{className:"hover:bg-surface-800/50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:s.label}),e.jsx("div",{className:"text-surface-500 text-xs",children:s.description})]}),f.map(d=>e.jsx("td",{className:"text-center px-2 py-3",children:e.jsx("button",{onClick:()=>t(s.id,d),className:`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${r.includes(d)?"bg-brand-500 border-brand-500":"border-surface-600 hover:border-surface-500"}`,children:r.includes(d)&&e.jsx(S,{className:"w-4 h-4 text-white"})})},d)),e.jsx("td",{className:"text-center px-2 py-3",children:e.jsx("button",{onClick:()=>N(s.id),className:`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${n?"bg-emerald-500 border-emerald-500":"border-surface-600 hover:border-surface-500"}`,children:n&&e.jsx(S,{className:"w-4 h-4 text-white"})})})]},s.id)})})]})})]})]}),e.jsxs("div",{className:"p-4 border-t border-surface-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-surface-700 text-white rounded-lg hover:bg-surface-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:!c.trim()||g.isPending||p.isPending,className:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Save Changes":"Create Group"})]})]})})}function K({group:a,onClose:o}){const{data:l,isLoading:c}=G({queryKey:["group-members",a.id],queryFn:()=>x.getGroupMembers(a.id).then(i=>i.data)});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-surface-800 rounded-lg w-full max-w-lg mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-surface-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white",children:["Members of ",a.name]}),e.jsx("button",{onClick:o,className:"p-1 text-surface-400 hover:text-white",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[60vh]",children:c?e.jsx("div",{className:"text-center text-surface-400 py-8",children:"Loading members..."}):l?.length===0?e.jsx("div",{className:"text-center text-surface-400 py-8",children:"No members in this group"}):e.jsx("div",{className:"space-y-2",children:l?.map(i=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-700 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-500/20 flex items-center justify-center text-brand-400 font-medium",children:i.displayName.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:i.displayName}),e.jsx("div",{className:"text-surface-400 text-sm",children:i.email})]}),e.jsxs("div",{className:"text-surface-500 text-xs",children:["Joined ",new Date(i.joinedAt).toLocaleDateString()]})]},i.id))})})]})})}export{J as default};
